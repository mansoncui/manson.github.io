<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Apollo 运维之路</title>
  
  <subtitle>Apollo 博客</subtitle>
  <link href="https://github.mansoncui.com/atom.xml" rel="self"/>
  
  <link href="https://github.mansoncui.com/"/>
  <updated>2021-11-04T08:41:21.845Z</updated>
  <id>https://github.mansoncui.com/</id>
  
  <author>
    <name>Apollo</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>home 目录不能重命名</title>
    <link href="https://github.mansoncui.com/2021/11/04/linux/device_resource_busy/"/>
    <id>https://github.mansoncui.com/2021/11/04/linux/device_resource_busy/</id>
    <published>2021-11-04T15:44:00.000Z</published>
    <updated>2021-11-04T08:41:21.845Z</updated>
    
    <content type="html"><![CDATA[<h2 id="给home-做软连接出现问题"><a href="#给home-做软连接出现问题" class="headerlink" title="给home 做软连接出现问题"></a>给home 做软连接出现问题</h2><h3 id="问题现象"><a href="#问题现象" class="headerlink" title="问题现象"></a>问题现象</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需求: home 目录需要做软链接，把 /home 进行重命名失败</span><br><span class="line">现象如下图:</span><br></pre></td></tr></table></figure><img src="/images/linux/home_device_resource_busy.jpg" width="100%" height="20%" align="left/"><h3 id="查找原因"><a href="#查找原因" class="headerlink" title="查找原因"></a>查找原因</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lsof +d /home   #查看是哪个进程占用该目录</span><br><span class="line"></span><br><span class="line">kill -9 pid  #把该进程停掉</span><br><span class="line"></span><br><span class="line">grep -h home /proc/*/task/*/mountinfo | sort -u</span><br></pre></td></tr></table></figure><img src="/images/linux/home_process.jpg" width="100%" height="20%" align="left/"><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service NetworkManager stop</span><br><span class="line"></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;给home-做软连接出现问题&quot;&gt;&lt;a href=&quot;#给home-做软连接出现问题&quot; class=&quot;headerlink&quot; title=&quot;给home 做软连接出现问题&quot;&gt;&lt;/a&gt;给home 做软连接出现问题&lt;/h2&gt;&lt;h3 id=&quot;问题现象&quot;&gt;&lt;a href=&quot;#问题现象&quot; class=&quot;headerlink&quot; title=&quot;问题现象&quot;&gt;&lt;/a&gt;问题现象&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;需求: home 目录需要做软链接，把 /home 进行重命名失败&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;现象如下图:&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;img src=&quot;/images/linux/home_device_resource_busy.jpg&quot; width=&quot;100%&quot; height=&quot;20%&quot; align=&quot;left/&quot;&gt;

&lt;h3 id=&quot;查找原因&quot;&gt;&lt;a href=&quot;#查找原因&quot; class=&quot;headerlink&quot; title=&quot;查找原因&quot;&gt;&lt;/a&gt;查找原因&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;lsof +d /home   #查看是哪个进程占用该目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kill -9 pid  #把该进程停掉&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;grep -h home /proc/*/task/*/mountinfo | sort -u&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;img src=&quot;/images/linux/home_process.jpg&quot; width=&quot;100%&quot; height=&quot;20%&quot; align=&quot;left/&quot;&gt;

&lt;h2 id=&quot;解决方法&quot;&gt;&lt;a href=&quot;#解决方法&quot; class=&quot;headerlink&quot; title=&quot;解决方法&quot;&gt;&lt;/a&gt;解决方法&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;service NetworkManager stop&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/spoiler.css&quot; type=&quot;text/css&quot;&gt;</summary>
    
    
    
    <category term="Device or resource busy" scheme="https://github.mansoncui.com/categories/Device-or-resource-busy/"/>
    
    
    <category term="mv" scheme="https://github.mansoncui.com/tags/mv/"/>
    
    <category term="Device or resource busy" scheme="https://github.mansoncui.com/tags/Device-or-resource-busy/"/>
    
  </entry>
  
  <entry>
    <title>zabbix 自动发现IP监控</title>
    <link href="https://github.mansoncui.com/2021/08/19/monitor/zabbix-ping/"/>
    <id>https://github.mansoncui.com/2021/08/19/monitor/zabbix-ping/</id>
    <published>2021-08-18T17:36:16.000Z</published>
    <updated>2021-08-18T09:21:58.268Z</updated>
    
    <content type="html"><![CDATA[<h2 id="zabbix和服务器相关配置"><a href="#zabbix和服务器相关配置" class="headerlink" title="zabbix和服务器相关配置"></a>zabbix和服务器相关配置</h2><h3 id="监控脚本"><a href="#监控脚本" class="headerlink" title="监控脚本"></a>监控脚本</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost zabbix]# cat /etc/zabbix/scripts/ip_check.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"># function:monitor tcp connect status from zabbix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">web_ip_discovery () &#123;</span><br><span class="line">WEB_IP=($(cat /etc/zabbix/scripts/ip_list.txt | grep -v &quot;^#&quot;))</span><br><span class="line">        printf &#x27;&#123;\n&#x27;</span><br><span class="line">        printf &#x27;\t&quot;data&quot;:[\n&#x27;</span><br><span class="line">for((i=0;i&lt;$&#123;#WEB_IP[@]&#125;;++i))</span><br><span class="line">&#123;</span><br><span class="line">num=$(echo $(($&#123;#WEB_IP[@]&#125;-1)))</span><br><span class="line">        if [ &quot;$i&quot; != $&#123;num&#125; ];</span><br><span class="line">                then</span><br><span class="line">        printf &quot;\t\t&#123; \n&quot;</span><br><span class="line">        printf &quot;\t\t\t\&quot;&#123;#SITENAME&#125;\&quot;:\&quot;$&#123;WEB_IP[$i]&#125;\&quot;&#125;,\n&quot;</span><br><span class="line">                else</span><br><span class="line">                        printf  &quot;\t\t&#123; \n&quot;</span><br><span class="line">                        printf  &quot;\t\t\t\&quot;&#123;#SITENAME&#125;\&quot;:\&quot;$&#123;WEB_IP[$num]&#125;\&quot;&#125;]&#125;\n&quot;</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">web_site_code () &#123;</span><br><span class="line">ip=`echo $1|awk -F &#x27;:&#x27; &#x27;&#123;print $1&#125;&#x27;`</span><br><span class="line">#echo $ip</span><br><span class="line">/usr/sbin/fping $&#123;ip&#125; 2&gt; /dev/null |grep -c &#x27;alive&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">web_ip_discovery)</span><br><span class="line">web_ip_discovery</span><br><span class="line">;;</span><br><span class="line">web_site_code)</span><br><span class="line">web_site_code $2</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line"></span><br><span class="line">echo &quot;Usage:$0 &#123;web_ip_discovery|web_site_code [URL]&#125;&quot;</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><h3 id="zabbix-conf配置"><a href="#zabbix-conf配置" class="headerlink" title="zabbix conf配置"></a>zabbix conf配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/zabbix/zabbix_agentd.d/ip_check.conf</span><br><span class="line">UserParameter=web.ip.discovery,/etc/zabbix/scripts/ip_check.sh web_ip_discovery</span><br><span class="line">UserParameter=web.ip.code[*],/etc/zabbix/scripts/ip_check.sh web_site_code $1</span><br></pre></td></tr></table></figure><h3 id="zabbix-存储IP文件"><a href="#zabbix-存储IP文件" class="headerlink" title="zabbix 存储IP文件"></a>zabbix 存储IP文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost zabbix]# cat /etc/zabbix/scripts/ip_list.txt          </span><br><span class="line">10.144.24.1:6_gateway</span><br><span class="line">10.144.24.2:9_route</span><br></pre></td></tr></table></figure><h3 id="zabbix-自动发现模板-导入模板并关联主机"><a href="#zabbix-自动发现模板-导入模板并关联主机" class="headerlink" title="zabbix 自动发现模板(导入模板并关联主机)"></a>zabbix 自动发现模板(导入模板并关联主机)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;zabbix_export&gt;</span><br><span class="line">    &lt;version&gt;5.0&lt;/version&gt;</span><br><span class="line">    &lt;date&gt;2021-08-18T08:15:04Z&lt;/date&gt;</span><br><span class="line">    &lt;groups&gt;</span><br><span class="line">        &lt;group&gt;</span><br><span class="line">            &lt;name&gt;Ping&lt;/name&gt;</span><br><span class="line">        &lt;/group&gt;</span><br><span class="line">    &lt;/groups&gt;</span><br><span class="line">    &lt;templates&gt;</span><br><span class="line">        &lt;template&gt;</span><br><span class="line">            &lt;template&gt;Template ICMP Ping&lt;/template&gt;</span><br><span class="line">            &lt;name&gt;Template ICMP Ping&lt;/name&gt;</span><br><span class="line">            &lt;groups&gt;</span><br><span class="line">                &lt;group&gt;</span><br><span class="line">                    &lt;name&gt;Ping&lt;/name&gt;</span><br><span class="line">                &lt;/group&gt;</span><br><span class="line">            &lt;/groups&gt;</span><br><span class="line">            &lt;applications&gt;</span><br><span class="line">                &lt;application&gt;</span><br><span class="line">                    &lt;name&gt;IP_PING&lt;/name&gt;</span><br><span class="line">                &lt;/application&gt;</span><br><span class="line">            &lt;/applications&gt;</span><br><span class="line">            &lt;discovery_rules&gt;</span><br><span class="line">                &lt;discovery_rule&gt;</span><br><span class="line">                    &lt;name&gt;web.ip.discovery&lt;/name&gt;</span><br><span class="line">                    &lt;key&gt;web.ip.discovery&lt;/key&gt;</span><br><span class="line">                    &lt;delay&gt;30s&lt;/delay&gt;</span><br><span class="line">                    &lt;lifetime&gt;0&lt;/lifetime&gt;</span><br><span class="line">                    &lt;item_prototypes&gt;</span><br><span class="line">                        &lt;item_prototype&gt;</span><br><span class="line">                            &lt;name&gt;IP Code ON $1 Alive&lt;/name&gt;</span><br><span class="line">                            &lt;key&gt;web.ip.code[&#123;#SITENAME&#125;,]&lt;/key&gt;</span><br><span class="line">                            &lt;applications&gt;</span><br><span class="line">                                &lt;application&gt;</span><br><span class="line">                                    &lt;name&gt;IP_PING&lt;/name&gt;</span><br><span class="line">                                &lt;/application&gt;</span><br><span class="line">                            &lt;/applications&gt;</span><br><span class="line">                            &lt;trigger_prototypes&gt;</span><br><span class="line">                                &lt;trigger_prototype&gt;</span><br><span class="line">                                    &lt;expression&gt;&#123;max(#3)&#125;&amp;lt;&amp;gt;1&lt;/expression&gt;</span><br><span class="line">                                    &lt;name&gt;IP &#123;#SITENAME&#125; host is not alive&lt;/name&gt;</span><br><span class="line">                                    &lt;priority&gt;HIGH&lt;/priority&gt;</span><br><span class="line">                                &lt;/trigger_prototype&gt;</span><br><span class="line">                            &lt;/trigger_prototypes&gt;</span><br><span class="line">                        &lt;/item_prototype&gt;</span><br><span class="line">                    &lt;/item_prototypes&gt;</span><br><span class="line">                    &lt;graph_prototypes&gt;</span><br><span class="line">                        &lt;graph_prototype&gt;</span><br><span class="line">                            &lt;name&gt;IP PING&lt;/name&gt;</span><br><span class="line">                            &lt;graph_items&gt;</span><br><span class="line">                                &lt;graph_item&gt;</span><br><span class="line">                                    &lt;sortorder&gt;1&lt;/sortorder&gt;</span><br><span class="line">                                    &lt;color&gt;1A7C11&lt;/color&gt;</span><br><span class="line">                                    &lt;item&gt;</span><br><span class="line">                                        &lt;host&gt;Template ICMP Ping&lt;/host&gt;</span><br><span class="line">                                        &lt;key&gt;web.ip.code[&#123;#SITENAME&#125;,]&lt;/key&gt;</span><br><span class="line">                                    &lt;/item&gt;</span><br><span class="line">                                &lt;/graph_item&gt;</span><br><span class="line">                            &lt;/graph_items&gt;</span><br><span class="line">                        &lt;/graph_prototype&gt;</span><br><span class="line">                    &lt;/graph_prototypes&gt;</span><br><span class="line">                &lt;/discovery_rule&gt;</span><br><span class="line">            &lt;/discovery_rules&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">    &lt;/templates&gt;</span><br><span class="line">&lt;/zabbix_export&gt;</span><br></pre></td></tr></table></figure><h2 id="告警相关配置"><a href="#告警相关配置" class="headerlink" title="告警相关配置"></a>告警相关配置</h2><h3 id="钉钉告警脚本-python3运行"><a href="#钉钉告警脚本-python3运行" class="headerlink" title="钉钉告警脚本(python3运行)"></a>钉钉告警脚本(python3运行)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server ~]# cat /usr/lib/zabbix/alertscripts/dingding.py</span><br><span class="line">#!/usr/bin/python</span><br><span class="line"># _*_coding: utf-8 _*_</span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">url = &quot;https://oapi.dingtalk.com/robot/send?access_token=825207be6f4d5818d78bc192fde043d0a339a5a6ae5e025b13bdef175dc4793b&quot;</span><br><span class="line"></span><br><span class="line">def send_msg(msg):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    发送消息的函数，这里使用阿里的钉钉</span><br><span class="line">    :param msg: 要发送的消息</span><br><span class="line">    :return: 200 or False</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    program = &#123;&quot;msgtype&quot;: &quot;text&quot;, &quot;text&quot;: &#123;&quot;content&quot;: msg&#125;, &#125;</span><br><span class="line">    headers = &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;</span><br><span class="line">    try:</span><br><span class="line">        f = requests.post(url, data=json.dumps(program), headers=headers,verify=False)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        return False</span><br><span class="line">    return f.status_code</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    msg = sys.argv[1]</span><br><span class="line">    send_msg(msg)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h3 id="zabbix创建用户和用户组"><a href="#zabbix创建用户和用户组" class="headerlink" title="zabbix创建用户和用户组"></a>zabbix创建用户和用户组</h3><img src="/images/monitor/zabbix-group.jpg" width="100%" height="10%" align="left/"><img src="/images/monitor/zabbix-user.jpg" width="100%" height="10%" align="left/"><img src="/images/monitor/zabbix-user-1.jpg" width="100%" height="10%" align="left/"><img src="/images/monitor/zabbix-user-2.jpg" width="100%" height="10%" align="left/"><h3 id="报警媒介设置"><a href="#报警媒介设置" class="headerlink" title="报警媒介设置"></a>报警媒介设置</h3><img src="/images/monitor/zabbix-报警媒介.jpg" width="100%" height="10%" align="left/"><img src="/images/monitor/zabbix-报警.jpg" width="100%" height="10%" align="left/">### 配置动作设置<img src="/images/monitor/zabbix-动作.jpg" width="100%" height="10%" align="left/"><img src="/images/monitor/zabbix-操作.jpg" width="100%" height="10%" align="left/"><img src="/images/monitor/zabbix-操作细节.jpg" width="100%" height="10%" align="left/"><img src="/images/monitor/zabbix-恢复操作.jpg" width="100%" height="10%" align="left/"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;zabbix和服务器相关配置&quot;&gt;&lt;a href=&quot;#zabbix和服务器相关配置&quot; class=&quot;headerlink&quot; title=&quot;zabbix和服务器相关配置&quot;&gt;&lt;/a&gt;zabbix和服务器相关配置&lt;/h2&gt;&lt;h3 id=&quot;监控脚本&quot;&gt;&lt;a href=&quot;#监控脚本&quot; class=&quot;headerlink&quot; title=&quot;监控脚本&quot;&gt;&lt;/a&gt;监控脚本&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost zabbix]# cat /etc/zabbix/scripts/ip_check.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# function:monitor tcp connect status from zabbix&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;web_ip_discovery () &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;WEB_IP=($(cat /etc/zabbix/scripts/ip_list.txt | grep -v &amp;quot;^#&amp;quot;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        printf &amp;#x27;&amp;#123;\n&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        printf &amp;#x27;\t&amp;quot;data&amp;quot;:[\n&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;for((i=0;i&amp;lt;$&amp;#123;#WEB_IP[@]&amp;#125;;++i))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;num=$(echo $(($&amp;#123;#WEB_IP[@]&amp;#125;-1)))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if [ &amp;quot;$i&amp;quot; != $&amp;#123;num&amp;#125; ];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        printf &amp;quot;\t\t&amp;#123; \n&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        printf &amp;quot;\t\t\t\&amp;quot;&amp;#123;#SITENAME&amp;#125;\&amp;quot;:\&amp;quot;$&amp;#123;WEB_IP[$i]&amp;#125;\&amp;quot;&amp;#125;,\n&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        printf  &amp;quot;\t\t&amp;#123; \n&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        printf  &amp;quot;\t\t\t\&amp;quot;&amp;#123;#SITENAME&amp;#125;\&amp;quot;:\&amp;quot;$&amp;#123;WEB_IP[$num]&amp;#125;\&amp;quot;&amp;#125;]&amp;#125;\n&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        fi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;web_site_code () &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ip=`echo $1|awk -F &amp;#x27;:&amp;#x27; &amp;#x27;&amp;#123;print $1&amp;#125;&amp;#x27;`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#echo $ip&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/sbin/fping $&amp;#123;ip&amp;#125; 2&amp;gt; /dev/null |grep -c &amp;#x27;alive&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;case &amp;quot;$1&amp;quot; in&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;web_ip_discovery)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;web_ip_discovery&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;web_site_code)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;web_site_code $2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;*)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo &amp;quot;Usage:$0 &amp;#123;web_ip_discovery|web_site_code [URL]&amp;#125;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;esac&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;zabbix-conf配置&quot;&gt;&lt;a href=&quot;#zabbix-conf配置&quot; class=&quot;headerlink&quot; title=&quot;zabbix conf配置&quot;&gt;&lt;/a&gt;zabbix conf配置&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cat /etc/zabbix/zabbix_agentd.d/ip_check.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;UserParameter=web.ip.discovery,/etc/zabbix/scripts/ip_check.sh web_ip_discovery&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;UserParameter=web.ip.code[*],/etc/zabbix/scripts/ip_check.sh web_site_code $1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;zabbix-存储IP文件&quot;&gt;&lt;a href=&quot;#zabbix-存储IP文件&quot; class=&quot;headerlink&quot; title=&quot;zabbix 存储IP文件&quot;&gt;&lt;/a&gt;zabbix 存储IP文件&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost zabbix]# cat /etc/zabbix/scripts/ip_list.txt          &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.144.24.1:6_gateway&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.144.24.2:9_route&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;zabbix-自动发现模板-导入模板并关联主机&quot;&gt;&lt;a href=&quot;#zabbix-自动发现模板-导入模板并关联主机&quot; class=&quot;headerlink&quot; title=&quot;zabbix 自动发现模板(导入模板并关联主机)&quot;&gt;&lt;/a&gt;zabbix 自动发现模板(导入模板并关联主机)&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;zabbix_export&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;version&amp;gt;5.0&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;date&amp;gt;2021-08-18T08:15:04Z&amp;lt;/date&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groups&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;group&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;lt;name&amp;gt;Ping&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;/group&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;/groups&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;templates&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;template&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;lt;template&amp;gt;Template ICMP Ping&amp;lt;/template&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;lt;name&amp;gt;Template ICMP Ping&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;lt;groups&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;lt;group&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;name&amp;gt;Ping&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;lt;/group&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;lt;/groups&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;lt;applications&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;lt;application&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;name&amp;gt;IP_PING&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;lt;/application&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;lt;/applications&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;lt;discovery_rules&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;lt;discovery_rule&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;name&amp;gt;web.ip.discovery&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;key&amp;gt;web.ip.discovery&amp;lt;/key&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;delay&amp;gt;30s&amp;lt;/delay&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;lifetime&amp;gt;0&amp;lt;/lifetime&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;item_prototypes&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;lt;item_prototype&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;lt;name&amp;gt;IP Code ON $1 Alive&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;lt;key&amp;gt;web.ip.code[&amp;#123;#SITENAME&amp;#125;,]&amp;lt;/key&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;lt;applications&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &amp;lt;application&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;lt;name&amp;gt;IP_PING&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &amp;lt;/application&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;lt;/applications&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;lt;trigger_prototypes&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;lt;expression&amp;gt;&amp;#123;max(#3)&amp;#125;&amp;amp;lt;&amp;amp;gt;1&amp;lt;/expression&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;lt;name&amp;gt;IP &amp;#123;#SITENAME&amp;#125; host is not alive&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;lt;priority&amp;gt;HIGH&amp;lt;/priority&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;lt;/trigger_prototypes&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;lt;/item_prototype&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;/item_prototypes&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;graph_prototypes&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;lt;graph_prototype&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;lt;name&amp;gt;IP PING&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;lt;graph_items&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &amp;lt;graph_item&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;lt;sortorder&amp;gt;1&amp;lt;/sortorder&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;lt;color&amp;gt;1A7C11&amp;lt;/color&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;lt;item&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        &amp;lt;host&amp;gt;Template ICMP Ping&amp;lt;/host&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        &amp;lt;key&amp;gt;web.ip.code[&amp;#123;#SITENAME&amp;#125;,]&amp;lt;/key&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;lt;/item&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &amp;lt;/graph_item&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;lt;/graph_items&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;lt;/graph_prototype&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;/graph_prototypes&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;lt;/discovery_rule&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;lt;/discovery_rules&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;/template&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;/templates&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/zabbix_export&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;告警相关配置&quot;&gt;&lt;a href=&quot;#告警相关配置&quot; class=&quot;headerlink&quot; title=&quot;告警相关配置&quot;&gt;&lt;/a&gt;告警相关配置&lt;/h2&gt;</summary>
    
    
    
    <category term="monitor" scheme="https://github.mansoncui.com/categories/monitor/"/>
    
    
    <category term="zabbix" scheme="https://github.mansoncui.com/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>容器应用优雅关闭</title>
    <link href="https://github.mansoncui.com/2021/08/05/kubernetes/%E5%AE%B9%E5%99%A8%E5%BA%94%E7%94%A8%E4%BC%98%E9%9B%85%E5%85%B3%E9%97%AD/"/>
    <id>https://github.mansoncui.com/2021/08/05/kubernetes/%E5%AE%B9%E5%99%A8%E5%BA%94%E7%94%A8%E4%BC%98%E9%9B%85%E5%85%B3%E9%97%AD/</id>
    <published>2021-08-05T15:00:00.000Z</published>
    <updated>2021-08-05T07:57:04.411Z</updated>
    
    <content type="html"><![CDATA[<h2 id="通过Prestop参数调用"><a href="#通过Prestop参数调用" class="headerlink" title="通过Prestop参数调用"></a>通过Prestop参数调用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">定义一个优雅关闭的脚本，通过 k8s-prestop 在关闭 POD 前调用优雅关闭脚本，实现 pod 优雅关闭。</span><br></pre></td></tr></table></figure><img src="/images/k8s/cmd/cmd-prestop.jpg" width="100%" height="10%" align="left/"><img src="/images/k8s/cmd/cmd-start.jpg" width="100%" height="10%" align="left/"><img src="/images/k8s/cmd/lifecycle-stop.jpg" width="100%" height="10%" align="left/"><h2 id="shell脚本修改为exec执行"><a href="#shell脚本修改为exec执行" class="headerlink" title="shell脚本修改为exec执行"></a>shell脚本修改为exec执行</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell 中添加一个 exec 即可让应用进程替代当前 shell 进程,可将 SIGTERM 信号传递到业务层，让业务实现优雅关闭</span><br></pre></td></tr></table></figure><img src="/images/k8s/cmd/容器优雅关闭.jpg" width="100%" height="10%" align="left/"><h2 id="通过init工具启动"><a href="#通过init工具启动" class="headerlink" title="通过init工具启动"></a>通过init工具启动</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">使用 dump-init 或 tini 做为容器的主进程，在收到退出信号的时候，会将退出信号转发给进程组所有进程。，主要适用应用本身无关闭信号处理的场景。docker –init 本身也是集成的 tini</span><br><span class="line">使用 tini 或 dump-init 做为应用启动的主进程。tini 和 dumb-init 会将关闭信号向子进程传递，但不会等待子进程完全退出后自己在退出。而是传递完后直接就退出了。</span><br></pre></td></tr></table></figure><img src="/images/k8s/cmd/cmd-tini.jpg" width="100%" height="10%" align="left/"><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">对于容器化应用启动命令建议使用 EXEC 模式。</span><br><span class="line">对于应用本身代码层面已经实现了优雅关闭的业务，但有 shell 启动脚本，容器化后部署到 k8s 上建议使方案一和方案二。</span><br><span class="line">对于应用本身代码层面没有实现优雅关闭的业务，建议使用方案三。</span><br></pre></td></tr></table></figure><p>参考地址:<br><a href="https://mp.weixin.qq.com/s/C5BIEIetZKthVPgbmFhaAw">https://mp.weixin.qq.com/s/C5BIEIetZKthVPgbmFhaAw</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;通过Prestop参数调用&quot;&gt;&lt;a href=&quot;#通过Prestop参数调用&quot; class=&quot;headerlink&quot; title=&quot;通过Prestop参数调用&quot;&gt;&lt;/a&gt;通过Prestop参数调用&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;定义一个优雅关闭的脚本，通过 k8s-prestop 在关闭 POD 前调用优雅关闭脚本，实现 pod 优雅关闭。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;img src=&quot;/images/k8s/cmd/cmd-prestop.jpg&quot; width=&quot;100%&quot; height=&quot;10%&quot; align=&quot;left/&quot;&gt;
&lt;img src=&quot;/images/k8s/cmd/cmd-start.jpg&quot; width=&quot;100%&quot; height=&quot;10%&quot; align=&quot;left/&quot;&gt;
&lt;img src=&quot;/images/k8s/cmd/lifecycle-stop.jpg&quot; width=&quot;100%&quot; height=&quot;10%&quot; align=&quot;left/&quot;&gt;

&lt;h2 id=&quot;shell脚本修改为exec执行&quot;&gt;&lt;a href=&quot;#shell脚本修改为exec执行&quot; class=&quot;headerlink&quot; title=&quot;shell脚本修改为exec执行&quot;&gt;&lt;/a&gt;shell脚本修改为exec执行&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;shell 中添加一个 exec 即可让应用进程替代当前 shell 进程,可将 SIGTERM 信号传递到业务层，让业务实现优雅关闭&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;img src=&quot;/images/k8s/cmd/容器优雅关闭.jpg&quot; width=&quot;100%&quot; height=&quot;10%&quot; align=&quot;left/&quot;&gt;

&lt;h2 id=&quot;通过init工具启动&quot;&gt;&lt;a href=&quot;#通过init工具启动&quot; class=&quot;headerlink&quot; title=&quot;通过init工具启动&quot;&gt;&lt;/a&gt;通过init工具启动&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;使用 dump-init 或 tini 做为容器的主进程，在收到退出信号的时候，会将退出信号转发给进程组所有进程。，主要适用应用本身无关闭信号处理的场景。docker –init 本身也是集成的 tini&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;使用 tini 或 dump-init 做为应用启动的主进程。tini 和 dumb-init 会将关闭信号向子进程传递，但不会等待子进程完全退出后自己在退出。而是传递完后直接就退出了。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="kubernetes" scheme="https://github.mansoncui.com/categories/kubernetes/"/>
    
    
    <category term="docker" scheme="https://github.mansoncui.com/tags/docker/"/>
    
    <category term="kubernetes" scheme="https://github.mansoncui.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>docker 参数详解</title>
    <link href="https://github.mansoncui.com/2021/08/04/kubernetes/docker/"/>
    <id>https://github.mansoncui.com/2021/08/04/kubernetes/docker/</id>
    <published>2021-08-03T16:42:04.000Z</published>
    <updated>2021-08-03T10:22:31.273Z</updated>
    
    <content type="html"><![CDATA[<h2 id="docker-参数详解"><a href="#docker-参数详解" class="headerlink" title="docker 参数详解"></a>docker 参数详解</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">docker-daemon.json各配置详解</span><br><span class="line">&#123;</span><br><span class="line">“api-cors-header”:&quot;&quot;, ——————在引擎API中设置CORS标头</span><br><span class="line">“authorization-plugins”:[], ——————要加载的授权插件</span><br><span class="line">“bridge”:&quot;&quot;, ————将容器附加到网桥</span><br><span class="line">“cgroup-parent”:&quot;&quot;, ——————为所有容器设置父cgroup</span><br><span class="line">“cluster-store”:&quot;&quot;, ——————分布式存储后端的URL</span><br><span class="line">“cluster-store-opts”:&#123;&#125;, ————————设置集群存储选项（默认map []）</span><br><span class="line">“cluster-advertise”:&quot;&quot;, ————————要通告的地址或接口名称</span><br><span class="line">“debug”: true, ————————启用调试模式，启用后，可以看到很多的启动信息。默认false</span><br><span class="line">“default-gateway”:&quot;&quot;, ——————容器默认网关IPv4地址</span><br><span class="line">“default-gateway-v6”:&quot;&quot;, ——————容器默认网关IPv6地址</span><br><span class="line">“default-runtime”:“runc”, ————————容器的默认OCI运行时（默认为“ runc”）</span><br><span class="line">“default-ulimits”:&#123;&#125;, ——————容器的默认ulimit（默认[]）</span><br><span class="line">“dns”: [“192.168.1.1”], ——————设定容器DNS的地址，在容器的 /etc/resolv.conf文件中可查看。</span><br><span class="line">“dns-opts”: [], ————————容器 /etc/resolv.conf 文件，其他设置</span><br><span class="line">“dns-search”: [], ————————设定容器的搜索域，当设定搜索域为 .example.com 时，在搜索一个名为 host 的 主机时，DNS不仅搜索host，还会搜</span><br><span class="line">索host.example.com 。 注意：如果不设置， Docker 会默认用主机上的 /etc/resolv.conf 来配置容器。</span><br><span class="line">“exec-opts”: [], ————————运行时执行选项</span><br><span class="line">“exec-root”:&quot;&quot;, ————————执行状态文件的根目录（默认为’/var/run/docker‘）</span><br><span class="line">“fixed-cidr”:&quot;&quot;, ————————固定IP的IPv4子网</span><br><span class="line">“fixed-cidr-v6”:&quot;&quot;, ————————固定IP的IPv6子网</span><br><span class="line">“data-root”:&quot;/var/lib/docker&quot;, ————-Docker运行时使用的根路径，默认/var/lib/docker</span><br><span class="line">“group”: “”, ——————UNIX套接字的组（默认为“docker”）</span><br><span class="line">“hosts”: [], ——————设置容器hosts</span><br><span class="line">“icc”: false, ——————启用容器间通信（默认为true）</span><br><span class="line">“ip”:“0.0.0.0”, ————————绑定容器端口时的默认IP（默认0.0.0.0）</span><br><span class="line">“iptables”: false, ———————启用iptables规则添加（默认为true）</span><br><span class="line">“ipv6”: false, ——————启用IPv6网络</span><br><span class="line">“ip-forward”: false, ————————默认true, 启用 net.ipv4.ip_forward ,进入容器后使用 sysctl -a | grepnet.ipv4.ip_forward 查看</span><br><span class="line">“ip-masq”:false, ——————启用IP伪装（默认为true）</span><br><span class="line">“labels”:[“nodeName=node-121”], ————————docker主机的标签，很实用的功能,例如定义：–label nodeName=host-121</span><br><span class="line">“live-restore”: true, ——————在容器仍在运行时启用docker的实时还原</span><br><span class="line">“log-driver”:&quot;&quot;, ——————容器日志的默认驱动程序（默认为“ json-file”）</span><br><span class="line">“log-level”:&quot;&quot;, ——————设置日志记录级别（“调试”，“信息”，“警告”，“错误”，“致命”）（默认为“信息”）</span><br><span class="line">“max-concurrent-downloads”:3, ——————设置每个请求的最大并发下载量（默认为3）</span><br><span class="line">“max-concurrent-uploads”:5, ——————设置每次推送的最大同时上传数（默认为5）</span><br><span class="line">“mtu”: 0, ——————设置容器网络MTU</span><br><span class="line">“oom-score-adjust”:-500, ——————设置守护程序的oom_score_adj（默认值为-500）</span><br><span class="line">“pidfile”: “”, ——————Docker守护进程的PID文件</span><br><span class="line">“raw-logs”: false, ——————全时间戳机制</span><br><span class="line">“selinux-enabled”: false, ——————默认 false，启用selinux支持</span><br><span class="line">“storage-driver”:&quot;&quot;, ——————要使用的存储驱动程序</span><br><span class="line">“swarm-default-advertise-addr”:&quot;&quot;, ——————设置默认地址或群集广告地址的接口</span><br><span class="line">“tls”: true, ————————默认 false, 启动TLS认证开关</span><br><span class="line">“tlscacert”: “”, ——————默认 ~/.docker/ca.pem，通过CA认证过的的certificate文件路径</span><br><span class="line">“tlscert”: “”, ————————默认 ~/.docker/cert.pem ，TLS的certificate文件路径</span><br><span class="line">“tlskey”: “”, ————————默认~/.docker/key.pem，TLS的key文件路径</span><br><span class="line">“tlsverify”: true, ————————默认false，使用TLS并做后台进程与客户端通讯的验证</span><br><span class="line">“userland-proxy”:false, ——————使用userland代理进行环回流量（默认为true）</span><br><span class="line">“userns-remap”:&quot;&quot;, ————————用户名称空间的用户/组设置</span><br><span class="line">“bip”:“192.168.88.0/22”, ——————————指定网桥IP</span><br><span class="line">“registry-mirrors”: [“https://192.498.89.232:89”], ————————设置镜像加速</span><br><span class="line">“insecure-registries”: [“120.123.122.123:12312”], ———————设置私有仓库地址可以设为http</span><br><span class="line">“storage-opts”: [</span><br><span class="line">“overlay2.override_kernel_check=true”,</span><br><span class="line">“overlay2.size=15G”</span><br><span class="line">], ————————存储驱动程序选项</span><br><span class="line">“log-opts”: &#123;</span><br><span class="line">“max-file”: “3”,</span><br><span class="line">“max-size”: “10m”,</span><br><span class="line">&#125;, ————————容器默认日志驱动程序选项</span><br><span class="line">“iptables”: false ————————启用iptables规则添加（默认为true）</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;docker-参数详解&quot;&gt;&lt;a href=&quot;#docker-参数详解&quot; class=&quot;headerlink&quot; title=&quot;docker 参数详解&quot;&gt;&lt;/a&gt;docker 参数详解&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker-daemon.json各配置详解&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“api-cors-header”:&amp;quot;&amp;quot;, ——————在引擎API中设置CORS标头&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“authorization-plugins”:[], ——————要加载的授权插件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“bridge”:&amp;quot;&amp;quot;, ————将容器附加到网桥&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“cgroup-parent”:&amp;quot;&amp;quot;, ——————为所有容器设置父cgroup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“cluster-store”:&amp;quot;&amp;quot;, ——————分布式存储后端的URL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“cluster-store-opts”:&amp;#123;&amp;#125;, ————————设置集群存储选项（默认map []）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“cluster-advertise”:&amp;quot;&amp;quot;, ————————要通告的地址或接口名称&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“debug”: true, ————————启用调试模式，启用后，可以看到很多的启动信息。默认false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“default-gateway”:&amp;quot;&amp;quot;, ——————容器默认网关IPv4地址&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“default-gateway-v6”:&amp;quot;&amp;quot;, ——————容器默认网关IPv6地址&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“default-runtime”:“runc”, ————————容器的默认OCI运行时（默认为“ runc”）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“default-ulimits”:&amp;#123;&amp;#125;, ——————容器的默认ulimit（默认[]）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“dns”: [“192.168.1.1”], ——————设定容器DNS的地址，在容器的 /etc/resolv.conf文件中可查看。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“dns-opts”: [], ————————容器 /etc/resolv.conf 文件，其他设置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“dns-search”: [], ————————设定容器的搜索域，当设定搜索域为 .example.com 时，在搜索一个名为 host 的 主机时，DNS不仅搜索host，还会搜&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;索host.example.com 。 注意：如果不设置， Docker 会默认用主机上的 /etc/resolv.conf 来配置容器。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“exec-opts”: [], ————————运行时执行选项&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“exec-root”:&amp;quot;&amp;quot;, ————————执行状态文件的根目录（默认为’/var/run/docker‘）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“fixed-cidr”:&amp;quot;&amp;quot;, ————————固定IP的IPv4子网&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“fixed-cidr-v6”:&amp;quot;&amp;quot;, ————————固定IP的IPv6子网&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“data-root”:&amp;quot;/var/lib/docker&amp;quot;, ————-Docker运行时使用的根路径，默认/var/lib/docker&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“group”: “”, ——————UNIX套接字的组（默认为“docker”）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“hosts”: [], ——————设置容器hosts&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“icc”: false, ——————启用容器间通信（默认为true）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“ip”:“0.0.0.0”, ————————绑定容器端口时的默认IP（默认0.0.0.0）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“iptables”: false, ———————启用iptables规则添加（默认为true）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“ipv6”: false, ——————启用IPv6网络&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“ip-forward”: false, ————————默认true, 启用 net.ipv4.ip_forward ,进入容器后使用 sysctl -a | grepnet.ipv4.ip_forward 查看&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“ip-masq”:false, ——————启用IP伪装（默认为true）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“labels”:[“nodeName=node-121”], ————————docker主机的标签，很实用的功能,例如定义：–label nodeName=host-121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“live-restore”: true, ——————在容器仍在运行时启用docker的实时还原&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“log-driver”:&amp;quot;&amp;quot;, ——————容器日志的默认驱动程序（默认为“ json-file”）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“log-level”:&amp;quot;&amp;quot;, ——————设置日志记录级别（“调试”，“信息”，“警告”，“错误”，“致命”）（默认为“信息”）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“max-concurrent-downloads”:3, ——————设置每个请求的最大并发下载量（默认为3）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“max-concurrent-uploads”:5, ——————设置每次推送的最大同时上传数（默认为5）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“mtu”: 0, ——————设置容器网络MTU&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“oom-score-adjust”:-500, ——————设置守护程序的oom_score_adj（默认值为-500）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“pidfile”: “”, ——————Docker守护进程的PID文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“raw-logs”: false, ——————全时间戳机制&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“selinux-enabled”: false, ——————默认 false，启用selinux支持&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“storage-driver”:&amp;quot;&amp;quot;, ——————要使用的存储驱动程序&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“swarm-default-advertise-addr”:&amp;quot;&amp;quot;, ——————设置默认地址或群集广告地址的接口&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“tls”: true, ————————默认 false, 启动TLS认证开关&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“tlscacert”: “”, ——————默认 ~/.docker/ca.pem，通过CA认证过的的certificate文件路径&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“tlscert”: “”, ————————默认 ~/.docker/cert.pem ，TLS的certificate文件路径&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“tlskey”: “”, ————————默认~/.docker/key.pem，TLS的key文件路径&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“tlsverify”: true, ————————默认false，使用TLS并做后台进程与客户端通讯的验证&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“userland-proxy”:false, ——————使用userland代理进行环回流量（默认为true）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“userns-remap”:&amp;quot;&amp;quot;, ————————用户名称空间的用户/组设置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“bip”:“192.168.88.0/22”, ——————————指定网桥IP&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“registry-mirrors”: [“https://192.498.89.232:89”], ————————设置镜像加速&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“insecure-registries”: [“120.123.122.123:12312”], ———————设置私有仓库地址可以设为http&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“storage-opts”: [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“overlay2.override_kernel_check=true”,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“overlay2.size=15G”&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;], ————————存储驱动程序选项&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“log-opts”: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“max-file”: “3”,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“max-size”: “10m”,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;, ————————容器默认日志驱动程序选项&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“iptables”: false ————————启用iptables规则添加（默认为true）&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/spoiler.css&quot; type=&quot;text/css&quot;&gt;&lt;script src=&quot;/js/spoiler.js&quot; type=&quot;text/javascript&quot; async&gt;&lt;/script&gt;</summary>
    
    
    
    <category term="docker" scheme="https://github.mansoncui.com/categories/docker/"/>
    
    
    <category term="docker" scheme="https://github.mansoncui.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>守护进程的文件数量限制</title>
    <link href="https://github.mansoncui.com/2021/08/04/problem/problem/"/>
    <id>https://github.mansoncui.com/2021/08/04/problem/problem/</id>
    <published>2021-08-03T16:00:00.000Z</published>
    <updated>2021-08-03T10:19:39.399Z</updated>
    
    <content type="html"><![CDATA[<h2 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h2><p>故障现象</p><p>c++开发终端服务 进行并发压测，抓包报如下错误:<br><img src="/images/problem/system-fd.png" width="100%" height="50%" align="left/"><br><img src="/images/problem/system-压测.png" width="100%" height="50%" align="left/"></p><h2 id="处理过程"><a href="#处理过程" class="headerlink" title="处理过程"></a>处理过程</h2><p>修改 c++ 终端服务 systemd 启动脚本，添加如下两行:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DefaultLimitNOFILE=10240000 # 修改文件句柄的限制</span><br><span class="line">DefaultLimitNPROC=10240000 # 修改进程树的限制</span><br></pre></td></tr></table></figure><h2 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload </span><br><span class="line">systemctl restart edxxxx-xxp</span><br></pre></td></tr></table></figure><p>systemctl show edxxxx-xxp | grep -i limit<br><img src="/images/problem/system-open-file.png" width="100%" height="50%" align="left/"></p><h2 id="重新压测正常"><a href="#重新压测正常" class="headerlink" title="重新压测正常"></a>重新压测正常</h2><img src="/images/problem/system-并发压测.png" width="100%" height="50%" align="left/"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;故障现象&quot;&gt;&lt;a href=&quot;#故障现象&quot; class=&quot;headerlink&quot; title=&quot;故障现象&quot;&gt;&lt;/a&gt;故障现象&lt;/h2&gt;&lt;p&gt;故障现象&lt;/p&gt;
&lt;p&gt;c++开发终端服务 进行并发压测，抓包报如下错误:&lt;br&gt;&lt;img src=&quot;/images/problem/system-fd.png&quot; width=&quot;100%&quot; height=&quot;50%&quot; align=&quot;left/&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/problem/system-压测.png&quot; width=&quot;100%&quot; height=&quot;50%&quot; align=&quot;left/&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;处理过程&quot;&gt;&lt;a href=&quot;#处理过程&quot; class=&quot;headerlink&quot; title=&quot;处理过程&quot;&gt;&lt;/a&gt;处理过程&lt;/h2&gt;&lt;p&gt;修改 c++ 终端服务 systemd 启动脚本，添加如下两行:&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;DefaultLimitNOFILE=10240000 # 修改文件句柄的限制&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DefaultLimitNPROC=10240000 # 修改进程树的限制&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;重启服务&quot;&gt;&lt;a href=&quot;#重启服务&quot; class=&quot;headerlink&quot; title=&quot;重启服务&quot;&gt;&lt;/a&gt;重启服务&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;systemctl daemon-reload &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl restart edxxxx-xxp&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;systemctl show edxxxx-xxp | grep -i limit&lt;br&gt;&lt;img src=&quot;/images/problem/system-open-file.png&quot; width=&quot;100%&quot; height=&quot;50%&quot; align=&quot;left/&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;重新压测正常&quot;&gt;&lt;a href=&quot;#重新压测正常&quot; class=&quot;headerlink&quot; title=&quot;重新压测正常&quot;&gt;&lt;/a&gt;重新压测正常&lt;/h2&gt;</summary>
    
    
    
    <category term="problem" scheme="https://github.mansoncui.com/categories/problem/"/>
    
    
    <category term="systemd" scheme="https://github.mansoncui.com/tags/systemd/"/>
    
  </entry>
  
  <entry>
    <title>nginx 部署 stream</title>
    <link href="https://github.mansoncui.com/2021/07/23/services/nginx-stream/"/>
    <id>https://github.mansoncui.com/2021/07/23/services/nginx-stream/</id>
    <published>2021-07-22T18:00:00.000Z</published>
    <updated>2021-07-29T06:14:40.155Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">操作系统: centos 7.9</span><br><span class="line">nginx version: nginx/1.20.1</span><br></pre></td></tr></table></figure><h2 id="nginx-install"><a href="#nginx-install" class="headerlink" title="nginx install"></a>nginx install</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nginx</span><br><span class="line">systemctl start nginx &amp;&amp; systemctl enable nginx </span><br></pre></td></tr></table></figure><h2 id="nginx-安装stream模块"><a href="#nginx-安装stream模块" class="headerlink" title="nginx 安装stream模块"></a>nginx 安装stream模块</h2><h3 id="nginx-stream-描述"><a href="#nginx-stream-描述" class="headerlink" title="nginx stream 描述"></a>nginx stream 描述</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Nginx 的 TCP/UDP 负载均衡是应用 Stream 代理模块（ngx_stream_proxy_module）和 Stream 上游模块（ngx_stream_upstream_module）实现的。Nginx 的 TCP 负载均衡与 LVS 都是四层负载均衡的应用，所不同的是，LVS 是被置于 Linux 内核中的，而 Nginx 是运行于用户层的，基于 Nginx 的 TCP 负载可以实现更灵活的用户访问管理和控制。</span><br></pre></td></tr></table></figure><h3 id="安装nginx-stream"><a href="#安装nginx-stream" class="headerlink" title="安装nginx stream"></a>安装nginx stream</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nginx-mod-stream</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line"></span><br><span class="line">    log_format proxy &#x27;$remote_addr [$time_local] &#x27;</span><br><span class="line">                 &#x27;$protocol $status $bytes_sent $bytes_received &#x27;</span><br><span class="line">                 &#x27;$session_time &quot;$upstream_addr&quot; &#x27;</span><br><span class="line">                 &#x27;&quot;$upstream_bytes_sent&quot; &quot;$upstream_bytes_received&quot; &quot;$upstream_connect_time&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log /var/log/nginx/tcp-access.log proxy ;</span><br><span class="line"></span><br><span class="line">upstream tcp_9093 &#123;</span><br><span class="line">server 192.168.3.105:8000;</span><br><span class="line">server 192.168.3.114:8000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 9093;</span><br><span class="line">        proxy_pass tcp_9093;</span><br><span class="line">        allow 192.168.7.0/24;</span><br><span class="line">        deny   all;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 9095;</span><br><span class="line">        proxy_pass 192.168.7.219:9098;</span><br><span class="line">        allow 192.168.7.0/24;</span><br><span class="line">        deny   all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="重启nginx"><a href="#重启nginx" class="headerlink" title="重启nginx"></a>重启nginx</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nginx -t  #检查配置文件是否有语法错误</span><br><span class="line">nginx -s reload 或 systemctl reload nginx </span><br><span class="line"></span><br><span class="line">参考地址: </span><br><span class="line">https://pkgs.org/download/nginx-mod-stream</span><br><span class="line">https://centos.pkgs.org/7/epel-x86_64/nginx-mod-stream-1.20.1-2.el7.x86_64.rpm.html</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;h2 id=&quot;系统环境&quot;&gt;&lt;a href=&quot;#系统环境&quot; class=&quot;headerlink&quot; title=&quot;系统环境&quot;&gt;&lt;/a&gt;系统环境&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;操作系统: centos 7.9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nginx version: nginx/1.20.1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;nginx-install&quot;&gt;&lt;a href=&quot;#nginx-install&quot; class=&quot;headerlink&quot; title=&quot;nginx install&quot;&gt;&lt;/a&gt;nginx install&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum -y install nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl start nginx &amp;amp;&amp;amp; systemctl enable nginx &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;nginx-安装stream模块&quot;&gt;&lt;a href=&quot;#nginx-安装stream模块&quot; class=&quot;headerlink&quot; title=&quot;nginx 安装stream模块&quot;&gt;&lt;/a&gt;nginx 安装stream模块&lt;/h2&gt;&lt;h3 id=&quot;nginx-stream-描述&quot;&gt;&lt;a href=&quot;#nginx-stream-描述&quot; class=&quot;headerlink&quot; title=&quot;nginx stream 描述&quot;&gt;&lt;/a&gt;nginx stream 描述&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Nginx 的 TCP/UDP 负载均衡是应用 Stream 代理模块（ngx_stream_proxy_module）和 Stream 上游模块（ngx_stream_upstream_module）实现的。Nginx 的 TCP 负载均衡与 LVS 都是四层负载均衡的应用，所不同的是，LVS 是被置于 Linux 内核中的，而 Nginx 是运行于用户层的，基于 Nginx 的 TCP 负载可以实现更灵活的用户访问管理和控制。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;安装nginx-stream&quot;&gt;&lt;a href=&quot;#安装nginx-stream&quot; class=&quot;headerlink&quot; title=&quot;安装nginx stream&quot;&gt;&lt;/a&gt;安装nginx stream&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum -y install nginx-mod-stream&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;stream &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    log_format proxy &amp;#x27;$remote_addr [$time_local] &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 &amp;#x27;$protocol $status $bytes_sent $bytes_received &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 &amp;#x27;$session_time &amp;quot;$upstream_addr&amp;quot; &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 &amp;#x27;&amp;quot;$upstream_bytes_sent&amp;quot; &amp;quot;$upstream_bytes_received&amp;quot; &amp;quot;$upstream_connect_time&amp;quot;&amp;#x27;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    access_log /var/log/nginx/tcp-access.log proxy ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;upstream tcp_9093 &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server 192.168.3.105:8000;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server 192.168.3.114:8000;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        listen 9093;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        proxy_pass tcp_9093;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        allow 192.168.7.0/24;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        deny   all;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        listen 9095;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        proxy_pass 192.168.7.219:9098;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        allow 192.168.7.0/24;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        deny   all;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="services" scheme="https://github.mansoncui.com/categories/services/"/>
    
    
    <category term="nginx" scheme="https://github.mansoncui.com/tags/nginx/"/>
    
    <category term="stream" scheme="https://github.mansoncui.com/tags/stream/"/>
    
  </entry>
  
  <entry>
    <title>zabbix 监控SSL证书过期时间</title>
    <link href="https://github.mansoncui.com/2021/07/19/zabbix/zabbix/"/>
    <id>https://github.mansoncui.com/2021/07/19/zabbix/zabbix/</id>
    <published>2021-07-19T14:37:00.000Z</published>
    <updated>2021-07-19T07:32:35.607Z</updated>
    
    <content type="html"><![CDATA[<h2 id="zabbix-监控ssl证书"><a href="#zabbix-监控ssl证书" class="headerlink" title="zabbix 监控ssl证书"></a>zabbix 监控ssl证书</h2><p>1.编写获取域名和443端口脚本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/zabbix/scripts/ssl_discovery.py    </span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">#coding:utf-8</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">#这个函数主要是构造出一个特定格式的字典，用于zabbix</span><br><span class="line">def ssl_cert_discovery():</span><br><span class="line">    web_list=[]</span><br><span class="line">    web_dict=&#123;&quot;data&quot;:None&#125;</span><br><span class="line">    with open(&quot;/etc/zabbix/scripts/ssl_cert_list&quot;,&quot;r&quot;) as f:</span><br><span class="line">        for sslcert in f:</span><br><span class="line">            dict=&#123;&#125;</span><br><span class="line">            dict[&quot;&#123;#DOMAINNAME&#125;&quot;]=sslcert.strip().split()[0]</span><br><span class="line">            dict[&quot;&#123;#PORT&#125;&quot;]=sslcert.strip().split()[1]</span><br><span class="line">            web_list.append(dict)</span><br><span class="line">    web_dict[&quot;data&quot;]=web_list</span><br><span class="line">    jsonStr = json.dumps(web_dict,indent=4)</span><br><span class="line">    return jsonStr</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    print ssl_cert_discovery()</span><br></pre></td></tr></table></figure><p>2.检查证书过期时间</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/zabbix/scripts/check-ssl-expire.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">host=$1</span><br><span class="line">port=$2</span><br><span class="line">end_date=`/usr/bin/openssl s_client -servername $host -host $host -port $port -showcerts &lt;/dev/null 2&gt;/dev/null |</span><br><span class="line">  sed -n &#x27;/BEGIN CERTIFICATE/,/END CERT/p&#x27; |</span><br><span class="line">  /usr/bin/openssl  x509 -text 2&gt;/dev/null |</span><br><span class="line">  sed -n &#x27;s/ *Not After : *//p&#x27;`</span><br><span class="line"># openssl 检验和验证SSL证书。</span><br><span class="line"># -servername $host 因一台主机存在多个证书，利用SNI特性检查</span><br><span class="line"># &lt;/dev/null 定向标准输入，防止交互式程序。从/dev/null 读时，直接读出0 。</span><br><span class="line"># sed -n 和p 一起使用，仅显示匹配到的部分。 //,// 区间匹配。</span><br><span class="line"># openssl x509 -text 解码证书信息，包含证书的有效期。</span><br><span class="line"></span><br><span class="line">if [ -n &quot;$end_date&quot; ]</span><br><span class="line">then</span><br><span class="line">    end_date_seconds=`date &#x27;+%s&#x27; --date &quot;$end_date&quot;`</span><br><span class="line">    now_seconds=`date &#x27;+%s&#x27;`</span><br><span class="line">    echo &quot;($end_date_seconds-$now_seconds)/24/3600&quot; | bc</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>3.域名和端口存放文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/zabbix/scripts/ssl_cert_list</span><br><span class="line">test.xxxxxx.com 443</span><br><span class="line">test1.xxxxxx.com 443</span><br></pre></td></tr></table></figure><h2 id="配置zabbix"><a href="#配置zabbix" class="headerlink" title="配置zabbix"></a>配置zabbix</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">把脚本上传:/etc/zabbix/scripts/下</span><br><span class="line">cat /etc/zabbix/zabbix_agentd.d/sslcert.conf </span><br><span class="line">UserParameter=sslcert_discovery,/usr/bin/python  /etc/zabbix/scripts/ssl_discovery.py</span><br><span class="line">UserParameter=sslcert.info[*],/bin/bash /etc/zabbix/scripts/check-ssl-expire.sh $1 $2</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">重启agent和proxy</span><br><span class="line">systemctl restart zabbix-agent </span><br><span class="line">systemctl restart zabbix-proxy</span><br><span class="line">测试</span><br><span class="line">/etc/zabbix/scripts/check-ssl-expire.sh api.xxxxxx.com 443</span><br></pre></td></tr></table></figure><p><img src="/images/zabbix/zabbix_agent_ssl.jpg"></p><h2 id="导入模板-下载链接"><a href="#导入模板-下载链接" class="headerlink" title="导入模板(下载链接)"></a>导入模板(下载链接)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">模板下载地址: https://www.aliyundrive.com/s/WFfnahYBeTC</span><br></pre></td></tr></table></figure><h2 id="告警结果"><a href="#告警结果" class="headerlink" title="告警结果"></a>告警结果</h2><p><img src="/images/zabbix/ssl_warn_info.jpg"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;zabbix-监控ssl证书&quot;&gt;&lt;a href=&quot;#zabbix-监控ssl证书&quot; class=&quot;headerlink&quot; title=&quot;zabbix 监控ssl证书&quot;&gt;&lt;/a&gt;zabbix 监控ssl证书&lt;/h2&gt;&lt;p&gt;1.编写获取域名和443端口脚本&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cat /etc/zabbix/scripts/ssl_discovery.py    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#coding:utf-8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import os&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import sys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#这个函数主要是构造出一个特定格式的字典，用于zabbix&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;def ssl_cert_discovery():&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    web_list=[]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    web_dict=&amp;#123;&amp;quot;data&amp;quot;:None&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    with open(&amp;quot;/etc/zabbix/scripts/ssl_cert_list&amp;quot;,&amp;quot;r&amp;quot;) as f:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        for sslcert in f:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            dict=&amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            dict[&amp;quot;&amp;#123;#DOMAINNAME&amp;#125;&amp;quot;]=sslcert.strip().split()[0]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            dict[&amp;quot;&amp;#123;#PORT&amp;#125;&amp;quot;]=sslcert.strip().split()[1]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            web_list.append(dict)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    web_dict[&amp;quot;data&amp;quot;]=web_list&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    jsonStr = json.dumps(web_dict,indent=4)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return jsonStr&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if __name__ == &amp;quot;__main__&amp;quot;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    print ssl_cert_discovery()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2.检查证书过期时间&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cat /etc/zabbix/scripts/check-ssl-expire.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;host=$1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;port=$2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;end_date=`/usr/bin/openssl s_client -servername $host -host $host -port $port -showcerts &amp;lt;/dev/null 2&amp;gt;/dev/null |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  sed -n &amp;#x27;/BEGIN CERTIFICATE/,/END CERT/p&amp;#x27; |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  /usr/bin/openssl  x509 -text 2&amp;gt;/dev/null |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  sed -n &amp;#x27;s/ *Not After : *//p&amp;#x27;`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# openssl 检验和验证SSL证书。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# -servername $host 因一台主机存在多个证书，利用SNI特性检查&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# &amp;lt;/dev/null 定向标准输入，防止交互式程序。从/dev/null 读时，直接读出0 。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# sed -n 和p 一起使用，仅显示匹配到的部分。 //,// 区间匹配。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# openssl x509 -text 解码证书信息，包含证书的有效期。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if [ -n &amp;quot;$end_date&amp;quot; ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    end_date_seconds=`date &amp;#x27;+%s&amp;#x27; --date &amp;quot;$end_date&amp;quot;`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    now_seconds=`date &amp;#x27;+%s&amp;#x27;`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    echo &amp;quot;($end_date_seconds-$now_seconds)/24/3600&amp;quot; | bc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fi&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3.域名和端口存放文件&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cat /etc/zabbix/scripts/ssl_cert_list&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;test.xxxxxx.com 443&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;test1.xxxxxx.com 443&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;配置zabbix&quot;&gt;&lt;a href=&quot;#配置zabbix&quot; class=&quot;headerlink&quot; title=&quot;配置zabbix&quot;&gt;&lt;/a&gt;配置zabbix&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;把脚本上传:/etc/zabbix/scripts/下&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cat /etc/zabbix/zabbix_agentd.d/sslcert.conf &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;UserParameter=sslcert_discovery,/usr/bin/python  /etc/zabbix/scripts/ssl_discovery.py&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;UserParameter=sslcert.info[*],/bin/bash /etc/zabbix/scripts/check-ssl-expire.sh $1 $2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;重启agent和proxy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl restart zabbix-agent &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl restart zabbix-proxy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;测试&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/etc/zabbix/scripts/check-ssl-expire.sh api.xxxxxx.com 443&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="zabbix" scheme="https://github.mansoncui.com/categories/zabbix/"/>
    
    
    <category term="zabbix" scheme="https://github.mansoncui.com/tags/zabbix/"/>
    
    <category term="zabbix监控ssl" scheme="https://github.mansoncui.com/tags/zabbix%E7%9B%91%E6%8E%A7ssl/"/>
    
  </entry>
  
  <entry>
    <title>kubernetes 二进制部署</title>
    <link href="https://github.mansoncui.com/2021/06/29/kubernetes/k8s%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2/"/>
    <id>https://github.mansoncui.com/2021/06/29/kubernetes/k8s%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2/</id>
    <published>2021-06-28T22:20:00.000Z</published>
    <updated>2021-07-16T02:50:50.323Z</updated>
    
    <content type="html"><![CDATA[<h2 id="kubernetes二进制部署"><a href="#kubernetes二进制部署" class="headerlink" title="kubernetes二进制部署"></a>kubernetes二进制部署</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">说明:</span><br><span class="line">使用ipvs需要安装相应的工具来处理”yum install ipset ipvsadm -y“</span><br><span class="line">确保 ipvs已经加载内核模块， ip_vs、ip_vs_rr、ip_vs_wrr、ip_vs_sh、</span><br><span class="line">nf_conntrack_ipv4。如果这些内核模块不加载，当kube-proxy启动后，会退回到iptables模式。</span><br><span class="line"></span><br><span class="line">##基础环境初始化:</span><br><span class="line">yum -y install vim telnet iotop openssh-clients openssh-server ntp net-tools.x86_64 wget</span><br><span class="line"></span><br><span class="line">sed -i &#x27;/*          soft    nproc     4096/d&#x27; /etc/security/limits.d/20-nproc.conf</span><br><span class="line">echo &#x27;*  -  nofile  65536&#x27; &gt;&gt; /etc/security/limits.conf</span><br><span class="line">echo &#x27;*       soft    nofile  65535&#x27; &gt;&gt; /etc/security/limits.conf</span><br><span class="line">echo &#x27;*       hard    nofile  65535&#x27; &gt;&gt; /etc/security/limits.conf</span><br><span class="line">echo &#x27;fs.file-max = 65536&#x27; &gt;&gt; /etc/sysctl.conf</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">ssh-copy-id -p52000 -i /root/.ssh/id_rsa.pub root@192.168.3.136 </span><br><span class="line">ssh-copy-id -p52000 -i /root/.ssh/id_rsa.pub root@192.168.3.137</span><br><span class="line"></span><br><span class="line">1.部署etcd</span><br><span class="line">cd /home/k8s_install/Deploy/ssl_etcd</span><br><span class="line">chmod +x cfssl.sh</span><br><span class="line"> ./cfssl.sh</span><br><span class="line"></span><br><span class="line">cat cfssl.sh </span><br><span class="line">curl -L https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 -o /usr/local/bin/cfssl</span><br><span class="line">curl -L https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 -o /usr/local/bin/cfssljson</span><br><span class="line">curl -L https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 -o /usr/local/bin/cfssl-certinfo</span><br><span class="line">chmod +x /usr/local/bin/cfssl /usr/local/bin/cfssljson /usr/local/bin/cfssl-certinfo</span><br><span class="line"></span><br><span class="line">mkdir /home/k8s_install/ssl_etcd/ &amp;&amp; cd /home/k8s_install/ssl_etcd/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir /home/k8s_install/etcd/&#123;cfg,bin,ssl&#125; -p</span><br><span class="line">cp &#123;ca,server-key,server&#125;.pem /home/k8s_install/etcd/ssl/</span><br><span class="line"></span><br><span class="line">wget https://github.com/etcd-io/etcd/releases/download/v3.2.12/etcd-v3.2.12-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxvf etcd-v3.2.12-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">cp -p  etcd-v3.2.12-linux-amd64/etcd* /home/k8s_install/etcd/bin/</span><br><span class="line"></span><br><span class="line">[root@k8s-dev-master bin]# cat /usr/lib/systemd/system/etcd.service   </span><br><span class="line">[Unit]</span><br><span class="line">Description=Etcd Server</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">EnvironmentFile=/home/k8s_install/etcd/cfg/etcd</span><br><span class="line">ExecStart=/home/k8s_install/etcd/bin/etcd \</span><br><span class="line">--name=$&#123;ETCD_NAME&#125; \</span><br><span class="line">--data-dir=$&#123;ETCD_DATA_DIR&#125; \</span><br><span class="line">--listen-peer-urls=$&#123;ETCD_LISTEN_PEER_URLS&#125; \</span><br><span class="line">--listen-client-urls=$&#123;ETCD_LISTEN_CLIENT_URLS&#125;,http://127.0.0.1:2379 \</span><br><span class="line">--advertise-client-urls=$&#123;ETCD_ADVERTISE_CLIENT_URLS&#125; \</span><br><span class="line">--initial-advertise-peer-urls=$&#123;ETCD_INITIAL_ADVERTISE_PEER_URLS&#125; \</span><br><span class="line">--initial-cluster=$&#123;ETCD_INITIAL_CLUSTER&#125; \</span><br><span class="line">--initial-cluster-token=$&#123;ETCD_INITIAL_CLUSTER_TOKEN&#125; \</span><br><span class="line">--initial-cluster-state=new \</span><br><span class="line">--cert-file=/home/k8s_install/etcd/ssl/server.pem \</span><br><span class="line">--key-file=/home/k8s_install/etcd/ssl/server-key.pem \</span><br><span class="line">--peer-cert-file=/home/k8s_install/etcd/ssl/server.pem \</span><br><span class="line">--peer-key-file=/home/k8s_install/etcd/ssl/server-key.pem \</span><br><span class="line">--trusted-ca-file=/home/k8s_install/etcd/ssl/ca.pem \</span><br><span class="line">--peer-trusted-ca-file=/home/k8s_install/etcd/ssl/ca.pem</span><br><span class="line">Restart=on-failure</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@k8s-dev-master bin]# cat /home/k8s_install/</span><br><span class="line">etcd/     ssl_etcd/ </span><br><span class="line">[root@k8s-dev-master bin]# cat /home/k8s_install/etcd/</span><br><span class="line">bin/ cfg/ ssl/ </span><br><span class="line">[root@k8s-dev-master bin]# cat /home/k8s_install/etcd/cfg/etcd </span><br><span class="line">#[Member]</span><br><span class="line">ETCD_NAME=&quot;etcd01&quot;</span><br><span class="line">ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;</span><br><span class="line">ETCD_LISTEN_PEER_URLS=&quot;https://192.168.3.135:2380&quot;</span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.3.135:2379&quot;</span><br><span class="line"></span><br><span class="line">#[Clustering]</span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.3.135:2380&quot;</span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.3.135:2379&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER=&quot;etcd01=https://192.168.3.135:2380,etcd02=https://192.168.3.136:2380,etcd03=https://192.168.3.137:2380&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##同步到其它etcd节点</span><br><span class="line">scp -rp -P52000 /home/k8s_install/etcd/&#123;bin,cfg,ssl&#125; root@192.168.3.136:/home/k8s_install/etcd/</span><br><span class="line">scp -rp -P52000 /home/k8s_install/etcd/&#123;bin,cfg,ssl&#125; root@192.168.3.137:/home/k8s_install/etcd/</span><br><span class="line"></span><br><span class="line">scp -rp -P52000 /usr/lib/systemd/system/etcd.service root@192.168.3.136:/usr/lib/systemd/system/</span><br><span class="line">scp -rp -P52000 /usr/lib/systemd/system/etcd.service root@192.168.3.137:/usr/lib/systemd/system/</span><br><span class="line"></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;kubernetes二进制部署&quot;&gt;&lt;a href=&quot;#kubernetes二进制部署&quot; class=&quot;headerlink&quot; title=&quot;kubernetes二进制部署&quot;&gt;&lt;/a&gt;kubernetes二进制部署&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;说明:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;使用ipvs需要安装相应的工具来处理”yum install ipset ipvsadm -y“&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;确保 ipvs已经加载内核模块， ip_vs、ip_vs_rr、ip_vs_wrr、ip_vs_sh、&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nf_conntrack_ipv4。如果这些内核模块不加载，当kube-proxy启动后，会退回到iptables模式。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;##基础环境初始化:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum -y install vim telnet iotop openssh-clients openssh-server ntp net-tools.x86_64 wget&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sed -i &amp;#x27;/*          soft    nproc     4096/d&amp;#x27; /etc/security/limits.d/20-nproc.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo &amp;#x27;*  -  nofile  65536&amp;#x27; &amp;gt;&amp;gt; /etc/security/limits.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo &amp;#x27;*       soft    nofile  65535&amp;#x27; &amp;gt;&amp;gt; /etc/security/limits.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo &amp;#x27;*       hard    nofile  65535&amp;#x27; &amp;gt;&amp;gt; /etc/security/limits.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo &amp;#x27;fs.file-max = 65536&amp;#x27; &amp;gt;&amp;gt; /etc/sysctl.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ssh-keygen -t rsa&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ssh-copy-id -p52000 -i /root/.ssh/id_rsa.pub root@192.168.3.136 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ssh-copy-id -p52000 -i /root/.ssh/id_rsa.pub root@192.168.3.137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1.部署etcd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd /home/k8s_install/Deploy/ssl_etcd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chmod +x cfssl.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; ./cfssl.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cat cfssl.sh &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -L https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 -o /usr/local/bin/cfssl&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -L https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 -o /usr/local/bin/cfssljson&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -L https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 -o /usr/local/bin/cfssl-certinfo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chmod +x /usr/local/bin/cfssl /usr/local/bin/cfssljson /usr/local/bin/cfssl-certinfo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mkdir /home/k8s_install/ssl_etcd/ &amp;amp;&amp;amp; cd /home/k8s_install/ssl_etcd/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mkdir /home/k8s_install/etcd/&amp;#123;cfg,bin,ssl&amp;#125; -p&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp &amp;#123;ca,server-key,server&amp;#125;.pem /home/k8s_install/etcd/ssl/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wget https://github.com/etcd-io/etcd/releases/download/v3.2.12/etcd-v3.2.12-linux-amd64.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf etcd-v3.2.12-linux-amd64.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp -p  etcd-v3.2.12-linux-amd64/etcd* /home/k8s_install/etcd/bin/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@k8s-dev-master bin]# cat /usr/lib/systemd/system/etcd.service   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[Unit]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Description=Etcd Server&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;After=network.target&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;After=network-online.target&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Wants=network-online.target&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[Service]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Type=notify&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;EnvironmentFile=/home/k8s_install/etcd/cfg/etcd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ExecStart=/home/k8s_install/etcd/bin/etcd \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--name=$&amp;#123;ETCD_NAME&amp;#125; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--data-dir=$&amp;#123;ETCD_DATA_DIR&amp;#125; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--listen-peer-urls=$&amp;#123;ETCD_LISTEN_PEER_URLS&amp;#125; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--listen-client-urls=$&amp;#123;ETCD_LISTEN_CLIENT_URLS&amp;#125;,http://127.0.0.1:2379 \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--advertise-client-urls=$&amp;#123;ETCD_ADVERTISE_CLIENT_URLS&amp;#125; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--initial-advertise-peer-urls=$&amp;#123;ETCD_INITIAL_ADVERTISE_PEER_URLS&amp;#125; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--initial-cluster=$&amp;#123;ETCD_INITIAL_CLUSTER&amp;#125; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--initial-cluster-token=$&amp;#123;ETCD_INITIAL_CLUSTER_TOKEN&amp;#125; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--initial-cluster-state=new \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--cert-file=/home/k8s_install/etcd/ssl/server.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--key-file=/home/k8s_install/etcd/ssl/server-key.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--peer-cert-file=/home/k8s_install/etcd/ssl/server.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--peer-key-file=/home/k8s_install/etcd/ssl/server-key.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--trusted-ca-file=/home/k8s_install/etcd/ssl/ca.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--peer-trusted-ca-file=/home/k8s_install/etcd/ssl/ca.pem&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Restart=on-failure&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LimitNOFILE=65536&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[Install]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;WantedBy=multi-user.target&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@k8s-dev-master bin]# cat /home/k8s_install/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;etcd/     ssl_etcd/ &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@k8s-dev-master bin]# cat /home/k8s_install/etcd/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bin/ cfg/ ssl/ &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@k8s-dev-master bin]# cat /home/k8s_install/etcd/cfg/etcd &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#[Member]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ETCD_NAME=&amp;quot;etcd01&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ETCD_DATA_DIR=&amp;quot;/var/lib/etcd/default.etcd&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ETCD_LISTEN_PEER_URLS=&amp;quot;https://192.168.3.135:2380&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ETCD_LISTEN_CLIENT_URLS=&amp;quot;https://192.168.3.135:2379&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#[Clustering]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ETCD_INITIAL_ADVERTISE_PEER_URLS=&amp;quot;https://192.168.3.135:2380&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ETCD_ADVERTISE_CLIENT_URLS=&amp;quot;https://192.168.3.135:2379&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ETCD_INITIAL_CLUSTER=&amp;quot;etcd01=https://192.168.3.135:2380,etcd02=https://192.168.3.136:2380,etcd03=https://192.168.3.137:2380&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ETCD_INITIAL_CLUSTER_TOKEN=&amp;quot;etcd-cluster&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ETCD_INITIAL_CLUSTER_STATE=&amp;quot;new&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;##同步到其它etcd节点&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scp -rp -P52000 /home/k8s_install/etcd/&amp;#123;bin,cfg,ssl&amp;#125; root@192.168.3.136:/home/k8s_install/etcd/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scp -rp -P52000 /home/k8s_install/etcd/&amp;#123;bin,cfg,ssl&amp;#125; root@192.168.3.137:/home/k8s_install/etcd/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scp -rp -P52000 /usr/lib/systemd/system/etcd.service root@192.168.3.136:/usr/lib/systemd/system/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scp -rp -P52000 /usr/lib/systemd/system/etcd.service root@192.168.3.137:/usr/lib/systemd/system/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/spoiler.css&quot; type=&quot;text/css&quot;&gt;&lt;script src=&quot;/js/spoiler.js&quot; type=&quot;text/javascript&quot; async&gt;&lt;/script&gt;</summary>
    
    
    
    <category term="kubernetes" scheme="https://github.mansoncui.com/categories/kubernetes/"/>
    
    
    <category term="kubernetes" scheme="https://github.mansoncui.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>服务器被攻击处理过程</title>
    <link href="https://github.mansoncui.com/2021/06/15/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8/"/>
    <id>https://github.mansoncui.com/2021/06/15/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8/</id>
    <published>2021-06-15T11:00:00.000Z</published>
    <updated>2021-08-03T03:10:32.624Z</updated>
    
    <content type="html"><![CDATA[<h2 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h2><p>服务器故障现象</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xshell登录不了服务器，直接卡死</span><br><span class="line">服务器CPU 负载很高，有一个进程cpu进程达到一千多，top -c 查看异常进程command 是bash, kill 命令杀死进程一会自动拉起, 如下图:</span><br></pre></td></tr></table></figure><img src="/images/安全/top-process.jpg" width="100%" height="50%" align="left/"><h2 id="处理过程"><a href="#处理过程" class="headerlink" title="处理过程"></a>处理过程</h2><p>1.先修改用户密码和ssh端口，计划任务 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">更改服务器ssh端口，和root 普通用户密码</span><br><span class="line">检查当前进程使用root 账户启动，查看root 计划任务(/etc/crontab和crontab -l) 是否有异常计划任务</span><br></pre></td></tr></table></figure><p>2.查看日志 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">内核及公共消息日志：/var/log/messages</span><br><span class="line">计划任务日志：/var/log/cron</span><br><span class="line">系统引导日志：/var/log/dmesg</span><br><span class="line">邮件服务日志：/var/log/maillog</span><br><span class="line">用户登录验证日志：/var/log/secure</span><br><span class="line">最近用户登录日志：/var/log/lastlog</span><br><span class="line">用户登录日志：/var/log/wtmp（该文件是二进制文件，不能用cat、tail等命令访问，而是通过last和lastlog命令来调用）</span><br></pre></td></tr></table></figure><p>3.用systemctl status 查看异常进程，如下图</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用systemctl status 有两个异常进程:phtunnel和pwnrigl 用systemd 管理的，kill该进程自动拉起，如下图:</span><br></pre></td></tr></table></figure><img src="/images/安全/异常进程.jpg" width="100%" height="50%" align="left/"><img src="/images/安全/pwnrigl.jpg" width="100%" height="50%" align="left/"><img src="/images/安全/phtunnel.jpg" width="100%" height="50%" align="left/"><h2 id="攻击脚本内容"><a href="#攻击脚本内容" class="headerlink" title="攻击脚本内容"></a>攻击脚本内容</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">systemctl cat pwnrig.service</span><br><span class="line"># Automatically generated by systemd-sysv-generator</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Documentation=man:systemd-sysv-generator(8)</span><br><span class="line">SourcePath=/etc/rc.d/init.d/pwnrig</span><br><span class="line">Description=SYSV: pwnrig (by pwned)</span><br><span class="line">Before=runlevel2.target</span><br><span class="line">Before=runlevel3.target</span><br><span class="line">Before=runlevel4.target</span><br><span class="line">Before=runlevel5.target</span><br><span class="line">Before=shutdown.target</span><br><span class="line">After=network-online.target</span><br><span class="line">After=network.service</span><br><span class="line">Conflicts=shutdown.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">Restart=no</span><br><span class="line">TimeoutSec=5min</span><br><span class="line">IgnoreSIGPIPE=no</span><br><span class="line">KillMode=process</span><br><span class="line">GuessMainPID=no</span><br><span class="line">RemainAfterExit=yes</span><br><span class="line">ExecStart=/etc/rc.d/init.d/pwnrig start</span><br><span class="line">ExecStop=/etc/rc.d/init.d/pwnrig stop</span><br><span class="line"></span><br><span class="line">cat /tmp/pwnrig</span><br><span class="line">#!/bin/bash</span><br><span class="line">#</span><br><span class="line"># pwnrig          Start/Stop the pwnrig clock daemon.</span><br><span class="line">#</span><br><span class="line"># chkconfig: 2345 90 60</span><br><span class="line"># description: pwnrig (by pwned)</span><br><span class="line">cp -f -r -- /bin/initdr /bin/-bash 2&gt;/dev/null</span><br><span class="line">cd /bin 2&gt;/dev/null</span><br><span class="line">./-bash -c  2&gt;/dev/null</span><br><span class="line">rm -rf -- -bash 2&gt;/dev/null</span><br></pre></td></tr></table></figure><h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">先关闭这两个服务和开机自启动:</span><br><span class="line">systemctl stop pwnrigl &amp;&amp; systemctl disable pwnrigl</span><br><span class="line">把这两个服务从:/usr/lib/systemd/system/下面移除，并执行syetemctl daemon-reload 服务器CPU和负载恢复正常</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="总结pwnrige挖矿病毒"><a href="#总结pwnrige挖矿病毒" class="headerlink" title="总结pwnrige挖矿病毒"></a>总结pwnrige挖矿病毒</h2><h3 id="开机自启动清理"><a href="#开机自启动清理" class="headerlink" title="开机自启动清理"></a>开机自启动清理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rc0.d/    rc1.d/    rc2.d/    rc3.d/    rc4.d/    rc5.d/    rc6.d/    rc.d/     rc.local</span><br></pre></td></tr></table></figure><img src="/images/安全/pwnrigl-rc.jpg" width="100%" height="30%" align="left/">### 计划任务清理<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -name pwnrig   #扫描根目录</span><br><span class="line">cron.d/       cron.daily/   cron.deny     cron.hourly/  cron.monthly/ crontab       cron.weekly/  #查看目录下文件</span><br><span class="line">crontab -l  #查看计划任务</span><br></pre></td></tr></table></figure><img src="/images/安全/pwnrigl-process.jpg" width="100%" height="20%" align="left/"><h3 id="检查环境变量是否病毒脚本"><a href="#检查环境变量是否病毒脚本" class="headerlink" title="检查环境变量是否病毒脚本"></a>检查环境变量是否病毒脚本</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/profile</span><br><span class="line">/etc/profile.d/*</span><br><span class="line">~/.bash_profile</span><br></pre></td></tr></table></figure><h3 id="检查systemd-文件目录"><a href="#检查systemd-文件目录" class="headerlink" title="检查systemd 文件目录"></a>检查systemd 文件目录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/systemd/system/</span><br><span class="line">/run/systemd/</span><br><span class="line">/usr/lib/systemd/system/</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;故障现象&quot;&gt;&lt;a href=&quot;#故障现象&quot; class=&quot;headerlink&quot; title=&quot;故障现象&quot;&gt;&lt;/a&gt;故障现象&lt;/h2&gt;&lt;p&gt;服务器故障现象&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;xshell登录不了服务器，直接卡死&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;服务器CPU 负载很高，有一个进程cpu进程达到一千多，top -c 查看异常进程command 是bash, kill 命令杀死进程一会自动拉起, 如下图:&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;img src=&quot;/images/安全/top-process.jpg&quot; width=&quot;100%&quot; height=&quot;50%&quot; align=&quot;left/&quot;&gt;

&lt;h2 id=&quot;处理过程&quot;&gt;&lt;a href=&quot;#处理过程&quot; class=&quot;headerlink&quot; title=&quot;处理过程&quot;&gt;&lt;/a&gt;处理过程&lt;/h2&gt;&lt;p&gt;1.先修改用户密码和ssh端口，计划任务 &lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;更改服务器ssh端口，和root 普通用户密码&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;检查当前进程使用root 账户启动，查看root 计划任务(/etc/crontab和crontab -l) 是否有异常计划任务&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;2.查看日志 &lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;内核及公共消息日志：/var/log/messages&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;计划任务日志：/var/log/cron&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;系统引导日志：/var/log/dmesg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;邮件服务日志：/var/log/maillog&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;用户登录验证日志：/var/log/secure&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;最近用户登录日志：/var/log/lastlog&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;用户登录日志：/var/log/wtmp（该文件是二进制文件，不能用cat、tail等命令访问，而是通过last和lastlog命令来调用）&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;3.用systemctl status 查看异常进程，如下图&lt;/p&gt;</summary>
    
    
    
    <category term="安全" scheme="https://github.mansoncui.com/categories/%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="cpu异常" scheme="https://github.mansoncui.com/tags/cpu%E5%BC%82%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>kubernetes 创建 secret</title>
    <link href="https://github.mansoncui.com/2021/03/22/kubernetes/k8s-harbor-secret/"/>
    <id>https://github.mansoncui.com/2021/03/22/kubernetes/k8s-harbor-secret/</id>
    <published>2021-03-21T16:30:00.000Z</published>
    <updated>2021-07-21T09:13:44.756Z</updated>
    
    <content type="html"><![CDATA[<h2 id="kubernetes-secret-描述"><a href="#kubernetes-secret-描述" class="headerlink" title="kubernetes secret 描述"></a>kubernetes secret 描述</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">secret 用于存储和管理一些敏感数据，比如密码，token，密钥等敏感信息。它把 Pod 想要访问的加密数据存放到 Etcd 中。然后用户就可以通过在 Pod 的容器里挂载 Volume 的方式或者 环境变量 的方式访问到这些 Secret 里保存的信息</span><br><span class="line"></span><br><span class="line">Secret 有三种类型</span><br><span class="line"></span><br><span class="line">Opaque：base64 编码格式的 Secret，用来存储密码、密钥等；但数据也可以通过base64 –decode解码得到原始数据，所有加密性很弱。</span><br><span class="line"></span><br><span class="line">Service Account：用来访问Kubernetes API，由Kubernetes自动创建，并且会自动挂载到Pod的 /run/secrets/kubernetes.io/serviceaccount 目录中。Service Account 对象的作用，就是 Kubernetes 系统内置的一种“服务账户”，它是 Kubernetes 进行权限分配的对象。比如，Service Account A，可以只被允许对 Kubernetes API 进行 GET 操作，而 Service Account B，则可以有 Kubernetes API 的所有操作权限</span><br><span class="line"></span><br><span class="line">kubernetes.io/dockerconfigjson ： 用来存储私有docker registry的认证信息</span><br></pre></td></tr></table></figure><h2 id="Opaque-Secret-使用"><a href="#Opaque-Secret-使用" class="headerlink" title="Opaque Secret 使用"></a>Opaque Secret 使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# echo -n &quot;admin&quot; | base64</span><br><span class="line">YWRtaW4=</span><br><span class="line">[root@test1 ~]# echo -n &quot;123456&quot; | base64</span><br><span class="line">MTIzNDU2</span><br></pre></td></tr></table></figure><p>创建secret</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim myapp-secret.yaml</span><br><span class="line"></span><br><span class="line"># 内容</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: mysecret</span><br><span class="line">type: Opaque</span><br><span class="line">data:</span><br><span class="line">  username: YWRtaW4=</span><br><span class="line">  password: MTIzNDU2</span><br></pre></td></tr></table></figure><p>将secret导入环境变量</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line"> name: myapp-deploy</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: myapp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: myapp</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: myapp</span><br><span class="line">        image: 192.168.26.160:86/xielong/myapp:v1.0</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">        env:</span><br><span class="line">        - name: MYSQL_SERVICE_USER</span><br><span class="line">          valueFrom:</span><br><span class="line">            secretKeyRef:</span><br><span class="line">              name: mysecret</span><br><span class="line">              key: username</span><br><span class="line">        - name: MYSQL_SERVICE_PASSWORD</span><br><span class="line">          valueFrom:</span><br><span class="line">            secretKeyRef:</span><br><span class="line">              name: mysecret</span><br><span class="line">              key: password</span><br></pre></td></tr></table></figure><p>查看环境变量</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@master1 yaml]# kubectl exec myapp-deploy-5df5dfbb7f-75qql env</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">HOSTNAME=myapp-deploy-5df5dfbb7f-75qql</span><br><span class="line"> </span><br><span class="line"># 成功导入</span><br><span class="line">MYSQL_SERVICE_USER=admin</span><br><span class="line">MYSQL_SERVICE_PASSWORD=123456</span><br><span class="line"> </span><br><span class="line">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class="line">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class="line">KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span><br><span class="line">KUBERNETES_SERVICE_HOST=10.96.0.1</span><br><span class="line">KUBERNETES_SERVICE_PORT=443</span><br><span class="line">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class="line">KUBERNETES_PORT=tcp://10.96.0.1:443</span><br><span class="line">KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span><br><span class="line">NGINX_VERSION=1.19.6</span><br><span class="line">NJS_VERSION=0.5.0</span><br><span class="line">PKG_RELEASE=1~buster</span><br><span class="line">HOME=/root</span><br></pre></td></tr></table></figure><h2 id="k8s通过secret拉取harbor镜像"><a href="#k8s通过secret拉取harbor镜像" class="headerlink" title="k8s通过secret拉取harbor镜像"></a>k8s通过secret拉取harbor镜像</h2><h3 id="创建secret"><a href="#创建secret" class="headerlink" title="创建secret"></a>创建secret</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret docker-registry test-hub-puller --docker-server=http://test-hub.xxxxx.com --docker-username=puller --docker-password=W2xxxxxxIh  --docker-email=puller@xxxx.com -n shxxxxxxiot</span><br><span class="line"></span><br><span class="line">备注:</span><br><span class="line">test-hub-puller #是secret name</span><br><span class="line">--docker-email #邮箱任意写 </span><br><span class="line">--docker-username=puller  #是harbor仓库用户名和密码</span><br><span class="line">--docker-server=http://test-hub.xxxxx.com  #harbor仓库地址</span><br></pre></td></tr></table></figure><h3 id="查看secret和yaml配置"><a href="#查看secret和yaml配置" class="headerlink" title="查看secret和yaml配置"></a>查看secret和yaml配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get secret -n shixxxiot</span><br></pre></td></tr></table></figure><img src="/images/k8s/secret/k8s-secret.jpg" width="100%" height="50%" align="left/"><img src="/images/k8s/secret/k8s-secret-containers.jpg" width="100%" height="50%" align="left/"><p>参考链接: </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://kubernetes.io/zh/docs/tasks/configure-pod-container/pull-image-private-registry/</span><br><span class="line">https://blog.csdn.net/mshxuyi/article/details/110942969</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;kubernetes-secret-描述&quot;&gt;&lt;a href=&quot;#kubernetes-secret-描述&quot; class=&quot;headerlink&quot; title=&quot;kubernetes secret 描述&quot;&gt;&lt;/a&gt;kubernetes secret 描述&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;secret 用于存储和管理一些敏感数据，比如密码，token，密钥等敏感信息。它把 Pod 想要访问的加密数据存放到 Etcd 中。然后用户就可以通过在 Pod 的容器里挂载 Volume 的方式或者 环境变量 的方式访问到这些 Secret 里保存的信息&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Secret 有三种类型&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Opaque：base64 编码格式的 Secret，用来存储密码、密钥等；但数据也可以通过base64 –decode解码得到原始数据，所有加密性很弱。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Service Account：用来访问Kubernetes API，由Kubernetes自动创建，并且会自动挂载到Pod的 /run/secrets/kubernetes.io/serviceaccount 目录中。Service Account 对象的作用，就是 Kubernetes 系统内置的一种“服务账户”，它是 Kubernetes 进行权限分配的对象。比如，Service Account A，可以只被允许对 Kubernetes API 进行 GET 操作，而 Service Account B，则可以有 Kubernetes API 的所有操作权限&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kubernetes.io/dockerconfigjson ： 用来存储私有docker registry的认证信息&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Opaque-Secret-使用&quot;&gt;&lt;a href=&quot;#Opaque-Secret-使用&quot; class=&quot;headerlink&quot; title=&quot;Opaque Secret 使用&quot;&gt;&lt;/a&gt;Opaque Secret 使用&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@test1 ~]# echo -n &amp;quot;admin&amp;quot; | base64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;YWRtaW4=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@test1 ~]# echo -n &amp;quot;123456&amp;quot; | base64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MTIzNDU2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;创建secret&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;vim myapp-secret.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 内容&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kind: Secret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  name: mysecret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;type: Opaque&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;data:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  username: YWRtaW4=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  password: MTIzNDU2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;将secret导入环境变量&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;apiVersion: apps/v1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kind: Deployment&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; name: myapp-deploy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  replicas: 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  selector:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    matchLabels:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      app: myapp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  template:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      labels:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        app: myapp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      containers:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      - name: myapp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        image: 192.168.26.160:86/xielong/myapp:v1.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ports:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        - containerPort: 80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        env:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        - name: MYSQL_SERVICE_USER&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          valueFrom:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            secretKeyRef:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              name: mysecret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              key: username&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        - name: MYSQL_SERVICE_PASSWORD&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          valueFrom:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            secretKeyRef:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              name: mysecret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              key: password&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;查看环境变量&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@master1 yaml]# kubectl exec myapp-deploy-5df5dfbb7f-75qql env&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HOSTNAME=myapp-deploy-5df5dfbb7f-75qql&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 成功导入&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MYSQL_SERVICE_USER=admin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MYSQL_SERVICE_PASSWORD=123456&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;KUBERNETES_PORT_443_TCP_PROTO=tcp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;KUBERNETES_PORT_443_TCP_PORT=443&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;KUBERNETES_SERVICE_HOST=10.96.0.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;KUBERNETES_SERVICE_PORT=443&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;KUBERNETES_SERVICE_PORT_HTTPS=443&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;KUBERNETES_PORT=tcp://10.96.0.1:443&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NGINX_VERSION=1.19.6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NJS_VERSION=0.5.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PKG_RELEASE=1~buster&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HOME=/root&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="kubernetes" scheme="https://github.mansoncui.com/categories/kubernetes/"/>
    
    
    <category term="kubernetes" scheme="https://github.mansoncui.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>shell 脚本总结</title>
    <link href="https://github.mansoncui.com/2019/08/22/shell/shell/"/>
    <id>https://github.mansoncui.com/2019/08/22/shell/shell/</id>
    <published>2019-08-22T10:41:18.000Z</published>
    <updated>2021-07-14T05:03:41.775Z</updated>
    
    <content type="html"><![CDATA[<h4 id="shell-判断当前用户和传参个数"><a href="#shell-判断当前用户和传参个数" class="headerlink" title="shell 判断当前用户和传参个数"></a>shell 判断当前用户和传参个数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">##Judge user root</span><br><span class="line">if [ $UID -ne 0 ];then</span><br><span class="line">    echo &quot;You are not support user,Please call root&quot;</span><br><span class="line">    exit 1;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">##Judge arg number</span><br><span class="line">if [ $# -ne 1 ];then</span><br><span class="line">    echo $&quot;Usage: $0 &#123;start|stop&#125;&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h4 id="case配置和使用"><a href="#case配置和使用" class="headerlink" title="case配置和使用"></a>case配置和使用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">function usage() &#123;</span><br><span class="line">    packge=$1</span><br><span class="line">    case $packge in</span><br><span class="line">    stop)</span><br><span class="line">       echo &quot;Stop Elk Cluster Service&quot;</span><br><span class="line">       elk_stop</span><br><span class="line">       ;;</span><br><span class="line">    start)</span><br><span class="line">       echo &quot;Start Elk Cluster Service&quot;</span><br><span class="line">       elk_start</span><br><span class="line">       ;;</span><br><span class="line">    status)</span><br><span class="line">       echo &quot;Elk Cluster Status&quot;</span><br><span class="line">       elk_status</span><br><span class="line">       ;;</span><br><span class="line">    *)</span><br><span class="line">       echo -e &quot;\033[41;30m Usage: $0 $1 Incorrect parameter \033[0m&quot;</span><br><span class="line">       echo $&quot;Usage: $0 &#123;start|stop|status&#125;&quot;</span><br><span class="line">       exit 0</span><br><span class="line">       ;;</span><br><span class="line">  esac</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for arg in &quot;$*&quot;</span><br><span class="line">do</span><br><span class="line">        usage $arg</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h4 id="文件追加"><a href="#文件追加" class="headerlink" title="文件追加"></a>文件追加</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;124567890&quot; | tee -a /tmp/1.txt  #往/tmp/1.txt</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /tmp/1.txt &lt;&lt; EOF  #往/tmp/1.txt</span><br><span class="line">1111111111</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt;/tmp/1.txt &lt;&lt; EOF   #覆盖/tmp/1.txt 原有文件内容</span><br><span class="line">11111</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; /tmp/1.txt  #覆盖/tmp/1.txt 原有文件内容</span><br><span class="line">&gt; 22222222</span><br><span class="line">&gt; EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF&gt;&gt;/tmp/1.txt  #往/tmp/1.txt 追加内容 </span><br><span class="line">&gt; 333333</span><br><span class="line">&gt; EOF</span><br></pre></td></tr></table></figure><h4 id="变量截取和替换"><a href="#变量截取和替换" class="headerlink" title="变量截取和替换"></a>变量截取和替换</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$&#123;变量#匹配规则&#125;从头开始匹配，最短删除</span><br><span class="line">$&#123;变量##匹配规则&#125;从头开始匹配，最长删除</span><br><span class="line">$&#123;变量%匹配规则&#125;从尾开始匹配，最短删除</span><br><span class="line">$&#123;变量%%匹配规则&#125;从尾开始匹配，最长删除</span><br><span class="line">$&#123;变量/旧字符/新字符&#125;替换变量内的旧字符为新字符，只替换第一个</span><br><span class="line">$&#123;变量//旧字符/新字符&#125;替换变量内的旧字符为新字符，全部替换</span><br><span class="line"></span><br><span class="line">案列:</span><br><span class="line">&quot;i love you, do you love me&quot;</span><br><span class="line">tmp=$&#123;var##*ove&#125;</span><br><span class="line">echo $tmp</span><br><span class="line">tmp=$&#123;var##*ove&#125;</span><br><span class="line">echo $tmp</span><br><span class="line">tmp=$&#123;var%ove*&#125;</span><br><span class="line">echo $tmp</span><br><span class="line">tmp=$&#123;var%%ove*&#125;</span><br><span class="line">echo $tmp</span><br><span class="line">tmp=$&#123;var/love/LOVE&#125;</span><br><span class="line">echo $tmp</span><br><span class="line">tmp=$&#123;var//love/LOVE&#125;</span><br><span class="line">echo $tmp</span><br></pre></td></tr></table></figure><h5 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">计算字符串长度</span><br><span class="line">1、$&#123;#string&#125;</span><br><span class="line">2、expr length $string</span><br><span class="line">var=&quot;i love you&quot;</span><br><span class="line">echo $&#123;#var&#125;</span><br><span class="line">expr length $&#123;var&#125;</span><br><span class="line"></span><br><span class="line">获取字符串中的子串</span><br><span class="line">1、$&#123;string:pos&#125;</span><br><span class="line">2、$&#123;string:pos:len&#125;</span><br><span class="line">3、$&#123;string:(-pos)&#125;</span><br><span class="line">4、expr substr $string $pos $len</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="案列"><a href="#案列" class="headerlink" title="案列"></a>案列</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!/bin/sh</span><br><span class="line">var=&quot;i love you&quot;</span><br><span class="line">tmp=$&#123;var:1&#125;</span><br><span class="line">echo &quot;$tmp&quot;</span><br><span class="line">tmp=$&#123;var:1:2&#125;   # 下标是从0开始的</span><br><span class="line">echo &quot;$&#123;tmp&#125;&quot;</span><br><span class="line">tmp=$&#123;var:(-5)&#125;</span><br><span class="line">echo &quot;$&#123;tmp&#125;&quot;</span><br><span class="line">tmp=`expr substr &quot;$&#123;var&#125;&quot; 1 10`  # 注意expr下标是从1开始的</span><br><span class="line">echo &quot;$&#123;tmp&#125;&quot;</span><br></pre></td></tr></table></figure><h5 id="一个完整字符串处理案例"><a href="#一个完整字符串处理案例" class="headerlink" title="一个完整字符串处理案例"></a>一个完整字符串处理案例</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env bash</span><br><span class="line">#</span><br><span class="line">string=&quot;Bigdata process framework is Hadoop,Hadoop is an open source project&quot;</span><br><span class="line">function tips_info</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;******************************************&quot;</span><br><span class="line">echo &quot;***  (1) 打印string长度&quot;</span><br><span class="line">echo &quot;***  (2) 在整个字符串中删除Hadoop&quot;</span><br><span class="line">echo &quot;***  (3) 替换第一个Hadoop为Mapreduce&quot;</span><br><span class="line">echo &quot;***  (4) 替换全部Hadoop为Mapreduce&quot;</span><br><span class="line">echo &quot;******************************************&quot;</span><br><span class="line">&#125;</span><br><span class="line">function print_len</span><br><span class="line">&#123;</span><br><span class="line"># -z表示判断字符串长度是否为0</span><br><span class="line">if [ -z &quot;$string&quot; ];then</span><br><span class="line">echo &quot;Error,string is null&quot;</span><br><span class="line">exit 1</span><br><span class="line">else</span><br><span class="line">echo &quot;$&#123;#string&#125;&quot;</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line">function del_hadoop</span><br><span class="line">&#123;</span><br><span class="line">if [ -z &quot;$string&quot; ];then</span><br><span class="line">echo &quot;Error,string is null&quot;</span><br><span class="line">exit 1</span><br><span class="line">else</span><br><span class="line">echo &quot;$&#123;string//Hadoop/&#125;&quot;</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line">function rep_hadoop_mapreduce_first</span><br><span class="line">&#123;</span><br><span class="line">if [ -z &quot;$string&quot; ];then</span><br><span class="line">echo &quot;Error,string is null&quot;</span><br><span class="line">exit 1</span><br><span class="line">else</span><br><span class="line">echo &quot;$&#123;string/Hadoop/Mapreduce&#125;&quot;</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line">function rep_hadoop_mapreduce_all</span><br><span class="line">&#123;</span><br><span class="line">        if [ -z &quot;$string&quot; ];then</span><br><span class="line">                echo &quot;Error,string is null&quot;</span><br><span class="line">                exit 1</span><br><span class="line">        else</span><br><span class="line">                echo &quot;$&#123;string//Hadoop/Mapreduce&#125;&quot;</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br><span class="line">while true</span><br><span class="line">do</span><br><span class="line">echo &quot;【string=\&quot;$string\&quot;】&quot;</span><br><span class="line">tips_info</span><br><span class="line">read -p &quot;Please Switch a Choice: &quot; choice</span><br><span class="line"># case, esac(反写esac); 相当于switch case break</span><br><span class="line">case &quot;$choice&quot; in</span><br><span class="line">1)</span><br><span class="line">echo</span><br><span class="line">echo &quot;Length Of String is: `print_len`&quot;</span><br><span class="line">echo</span><br><span class="line">continue</span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">echo</span><br><span class="line">echo &quot;删除Hadoop后的字符串为：`del_hadoop`&quot;</span><br><span class="line">echo</span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">echo </span><br><span class="line">echo &quot;替换第一个Hadoop的字符串为：`rep_hadoop_mapreduce_first`&quot;</span><br><span class="line">echo</span><br><span class="line">;;</span><br><span class="line">4)</span><br><span class="line">echo </span><br><span class="line">                echo &quot;替换第一个Hadoop的字符串为：`rep_hadoop_mapreduce_all`&quot;</span><br><span class="line">                echo</span><br><span class="line">;;</span><br><span class="line">q|Q)</span><br><span class="line">exit 0</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">echo &quot;error,unlegal input,legal input only in &#123; 1|2|3|4|q|Q &#125;&quot;</span><br><span class="line">continue</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">done</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h4 id=&quot;shell-判断当前用户和传参个数&quot;&gt;&lt;a href=&quot;#shell-判断当前用户和传参个数&quot; class=&quot;headerlink&quot; title=&quot;shell 判断当前用户和传参个数&quot;&gt;&lt;/a&gt;shell 判断当前用户和传参个数&lt;/h4&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;##Judge user root&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if [ $UID -ne 0 ];then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    echo &amp;quot;You are not support user,Please call root&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    exit 1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;##Judge arg number&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if [ $# -ne 1 ];then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    echo $&amp;quot;Usage: $0 &amp;#123;start|stop&amp;#125;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    exit 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fi&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;case配置和使用&quot;&gt;&lt;a href=&quot;#case配置和使用&quot; class=&quot;headerlink&quot; title=&quot;case配置和使用&quot;&gt;&lt;/a&gt;case配置和使用&lt;/h4&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;function usage() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    packge=$1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    case $packge in&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    stop)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       echo &amp;quot;Stop Elk Cluster Service&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       elk_stop&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    start)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       echo &amp;quot;Start Elk Cluster Service&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       elk_start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    status)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       echo &amp;quot;Elk Cluster Status&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       elk_status&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    *)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       echo -e &amp;quot;\033[41;30m Usage: $0 $1 Incorrect parameter \033[0m&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       echo $&amp;quot;Usage: $0 &amp;#123;start|stop|status&amp;#125;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       exit 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  esac&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;for arg in &amp;quot;$*&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;do&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        usage $arg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;done&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;文件追加&quot;&gt;&lt;a href=&quot;#文件追加&quot; class=&quot;headerlink&quot; title=&quot;文件追加&quot;&gt;&lt;/a&gt;文件追加&lt;/h4&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;echo &amp;quot;124567890&amp;quot; | tee -a /tmp/1.txt  #往/tmp/1.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cat &amp;gt;&amp;gt; /tmp/1.txt &amp;lt;&amp;lt; EOF  #往/tmp/1.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1111111111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;EOF&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cat &amp;gt;/tmp/1.txt &amp;lt;&amp;lt; EOF   #覆盖/tmp/1.txt 原有文件内容&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;EOF&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cat &amp;lt;&amp;lt; EOF &amp;gt; /tmp/1.txt  #覆盖/tmp/1.txt 原有文件内容&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; 22222222&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; EOF&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cat &amp;lt;&amp;lt;EOF&amp;gt;&amp;gt;/tmp/1.txt  #往/tmp/1.txt 追加内容 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; 333333&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; EOF&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;变量截取和替换&quot;&gt;&lt;a href=&quot;#变量截取和替换&quot; class=&quot;headerlink&quot; title=&quot;变量截取和替换&quot;&gt;&lt;/a&gt;变量截取和替换&lt;/h4&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$&amp;#123;变量#匹配规则&amp;#125;	从头开始匹配，最短删除&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$&amp;#123;变量##匹配规则&amp;#125;	从头开始匹配，最长删除&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$&amp;#123;变量%匹配规则&amp;#125;	从尾开始匹配，最短删除&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$&amp;#123;变量%%匹配规则&amp;#125;	从尾开始匹配，最长删除&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$&amp;#123;变量/旧字符/新字符&amp;#125;	替换变量内的旧字符为新字符，只替换第一个&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$&amp;#123;变量//旧字符/新字符&amp;#125;	替换变量内的旧字符为新字符，全部替换&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;案列:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;quot;i love you, do you love me&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tmp=$&amp;#123;var##*ove&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo $tmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tmp=$&amp;#123;var##*ove&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo $tmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tmp=$&amp;#123;var%ove*&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo $tmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tmp=$&amp;#123;var%%ove*&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo $tmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tmp=$&amp;#123;var/love/LOVE&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo $tmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tmp=$&amp;#123;var//love/LOVE&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo $tmp&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;字符串处理&quot;&gt;&lt;a href=&quot;#字符串处理&quot; class=&quot;headerlink&quot; title=&quot;字符串处理&quot;&gt;&lt;/a&gt;字符串处理&lt;/h5&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;计算字符串长度&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1、$&amp;#123;#string&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2、expr length $string&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;var=&amp;quot;i love you&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo $&amp;#123;#var&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;expr length $&amp;#123;var&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;获取字符串中的子串&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1、$&amp;#123;string:pos&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2、$&amp;#123;string:pos:len&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3、$&amp;#123;string:(-pos)&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4、expr substr $string $pos $len&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="shell" scheme="https://github.mansoncui.com/categories/shell/"/>
    
    
    <category term="shell 脚本总结" scheme="https://github.mansoncui.com/tags/shell-%E8%84%9A%E6%9C%AC%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>php7.3-install</title>
    <link href="https://github.mansoncui.com/2019/07/16/services/php7-3-install/"/>
    <id>https://github.mansoncui.com/2019/07/16/services/php7-3-install/</id>
    <published>2019-07-16T14:41:40.000Z</published>
    <updated>2021-07-14T05:03:41.769Z</updated>
    
    <content type="html"><![CDATA[<h2 id="php7-3"><a href="#php7-3" class="headerlink" title="php7.3"></a>php7.3</h2><h5 id="安装libzip-不然会报错"><a href="#安装libzip-不然会报错" class="headerlink" title="安装libzip 不然会报错"></a>安装libzip 不然会报错</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">wget https://nih.at/libzip/libzip-1.2.0.tar.gz</span><br><span class="line">tar -zxvf libzip-1.2.0.tar.gz</span><br><span class="line">cd libzip-1.2.0</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">错误信息:configure: error: off_t undefined; check your library configuration </span><br><span class="line">#解决方法</span><br><span class="line"># 添加搜索路径到配置文件</span><br><span class="line">echo &#x27;/usr/local/lib64</span><br><span class="line">/usr/local/lib</span><br><span class="line">/usr/lib</span><br><span class="line">/usr/lib64&#x27;&gt;&gt;/etc/ld.so.conf</span><br><span class="line"># 更新配置</span><br><span class="line">ldconfig -v</span><br><span class="line"></span><br><span class="line">#解决方法：手动复制过去</span><br><span class="line">cp /usr/local/lib/libzip/include/zipconf.h /usr/local/include/zipconf.h</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="php7-3-安装配置"><a href="#php7-3-安装配置" class="headerlink" title="php7.3 安装配置"></a>php7.3 安装配置</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">php下载地址:https://www.php.net/distributions/php-7.3.7.tar.gz</span><br><span class="line"></span><br><span class="line">wget https://www.php.net/distributions/php-7.3.7.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxvf  php-7.3.7.tar.gz</span><br><span class="line"></span><br><span class="line">cd  php-7.3.7</span><br><span class="line"></span><br><span class="line">./configure  --prefix=/usr/local/php7 --with-config-file-path=/usr/local/php7/etc --with-gd --with-jpeg-dir --with-png-dir --with-zlib --with-freetype-dir --with-libxml-dir --enable-shared  --with-iconv --without-pdo-sqlite --with-gettext=/usr --enable-soap --with-curl --enable-mbregex --enable-fpm --with-fpm-user=www --with-fpm-group=www --enable-mbstring --with-mhash --enable-pcntl --enable-sockets --enable-dom --with-xsl --enable-opcache --with-openssl --enable-simplexml --enable-zip --enable-shmop --enable-ftp --enable-bcmath --with-pdo_mysql --with-mysqli=mysqlnd</span><br><span class="line"></span><br><span class="line">make -j 4</span><br><span class="line"></span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h5 id="安装php7错误信息总结"><a href="#安装php7错误信息总结" class="headerlink" title="安装php7错误信息总结"></a>安装php7错误信息总结</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">configure: error: libxml2 not found. Please check your libxml2 installation.</span><br><span class="line">yum install -y  libxml2-devel</span><br><span class="line"></span><br><span class="line">configure: error: Please reinstall the BZip2 distribution</span><br><span class="line">yum install -y  bzip2-devel</span><br><span class="line"></span><br><span class="line">configure: error: cURL version 7.15.5 or later is required to compile php with cURL support</span><br><span class="line">yum install -y  curl-devel</span><br><span class="line"></span><br><span class="line">configure: error: jpeglib.h not found.</span><br><span class="line">yum install -y  libjpeg-devel</span><br><span class="line"></span><br><span class="line">configure: error: png.h not found.</span><br><span class="line">yum install -y libpng-devel</span><br><span class="line"></span><br><span class="line">configure: error: freetype-config not found.</span><br><span class="line">yum install -y freetype-devel</span><br><span class="line"></span><br><span class="line">configure: error: xslt-config not found. Please reinstall the libxslt &gt;= 1.1.0 distribution</span><br><span class="line">yum install -y libxslt-devel</span><br><span class="line"></span><br><span class="line">configure: error: Please reinstall the libzip distribution</span><br><span class="line">yum install -y libzip-devel</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;php7-3&quot;&gt;&lt;a href=&quot;#php7-3&quot; class=&quot;headerlink&quot; title=&quot;php7.3&quot;&gt;&lt;/a&gt;php7.3&lt;/h2&gt;&lt;h5 id=&quot;安装libzip-不然会报错&quot;&gt;&lt;a href=&quot;#安装libzip-不然会报错&quot; class=&quot;headerlink&quot; title=&quot;安装libzip 不然会报错&quot;&gt;&lt;/a&gt;安装libzip 不然会报错&lt;/h5&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;wget https://nih.at/libzip/libzip-1.2.0.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf libzip-1.2.0.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd libzip-1.2.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./configure&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;make &amp;amp;&amp;amp; make install&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;错误信息:configure: error: off_t undefined; check your library configuration &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#解决方法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 添加搜索路径到配置文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo &amp;#x27;/usr/local/lib64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/lib&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/lib&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/lib64&amp;#x27;&amp;gt;&amp;gt;/etc/ld.so.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 更新配置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ldconfig -v&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#解决方法：手动复制过去&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp /usr/local/lib/libzip/include/zipconf.h /usr/local/include/zipconf.h&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;php7-3-安装配置&quot;&gt;&lt;a href=&quot;#php7-3-安装配置&quot; class=&quot;headerlink&quot; title=&quot;php7.3 安装配置&quot;&gt;&lt;/a&gt;php7.3 安装配置&lt;/h5&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;php下载地址:https://www.php.net/distributions/php-7.3.7.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wget https://www.php.net/distributions/php-7.3.7.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf  php-7.3.7.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd  php-7.3.7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./configure  --prefix=/usr/local/php7 --with-config-file-path=/usr/local/php7/etc --with-gd --with-jpeg-dir --with-png-dir --with-zlib --with-freetype-dir --with-libxml-dir --enable-shared  --with-iconv --without-pdo-sqlite --with-gettext=/usr --enable-soap --with-curl --enable-mbregex --enable-fpm --with-fpm-user=www --with-fpm-group=www --enable-mbstring --with-mhash --enable-pcntl --enable-sockets --enable-dom --with-xsl --enable-opcache --with-openssl --enable-simplexml --enable-zip --enable-shmop --enable-ftp --enable-bcmath --with-pdo_mysql --with-mysqli=mysqlnd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;make -j 4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;make install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;安装php7错误信息总结&quot;&gt;&lt;a href=&quot;#安装php7错误信息总结&quot; class=&quot;headerlink&quot; title=&quot;安装php7错误信息总结&quot;&gt;&lt;/a&gt;安装php7错误信息总结&lt;/h5&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;configure: error: libxml2 not found. Please check your libxml2 installation.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y  libxml2-devel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;configure: error: Please reinstall the BZip2 distribution&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y  bzip2-devel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;configure: error: cURL version 7.15.5 or later is required to compile php with cURL support&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y  curl-devel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;configure: error: jpeglib.h not found.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y  libjpeg-devel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;configure: error: png.h not found.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y libpng-devel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;configure: error: freetype-config not found.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y freetype-devel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;configure: error: xslt-config not found. Please reinstall the libxslt &amp;gt;= 1.1.0 distribution&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y libxslt-devel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;configure: error: Please reinstall the libzip distribution&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y libzip-devel&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/spoiler.css&quot; type=&quot;text/css&quot;&gt;&lt;script src=&quot;/js/spoiler.js&quot; type=&quot;text/javascript&quot; async&gt;&lt;/script&gt;</summary>
    
    
    
    <category term="services" scheme="https://github.mansoncui.com/categories/services/"/>
    
    
    <category term="php7" scheme="https://github.mansoncui.com/tags/php7/"/>
    
  </entry>
  
  <entry>
    <title>centos6-7</title>
    <link href="https://github.mansoncui.com/2019/07/10/linux%E6%93%8D%E4%BD%9C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/centos6-7/"/>
    <id>https://github.mansoncui.com/2019/07/10/linux%E6%93%8D%E4%BD%9C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/centos6-7/</id>
    <published>2019-07-10T09:53:02.000Z</published>
    <updated>2021-07-14T05:03:41.753Z</updated>
    
    <content type="html"><![CDATA[<h2 id="centos6-和-7-服务进程关闭"><a href="#centos6-和-7-服务进程关闭" class="headerlink" title="centos6 和 7 服务进程关闭"></a>centos6 和 7 服务进程关闭</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">服务名称        功能                            默认 建议 备注说明</span><br><span class="line">NetworkManager    用于自动连接网络，常用在Laptop上开启关闭对服务器无用</span><br><span class="line">abrt-ccpp                                            开启自定对服务器无用</span><br><span class="line">abrt-oops                                            开启自定对服务器无用</span><br><span class="line">abrtd                                                开启自定对服务器无用</span><br><span class="line">acpid            电源的开关等检测管理，常用在Laptop上开启自定对服务器无用</span><br><span class="line">atd                在指定时间执行命令开启关闭如果用crond，则可关闭它</span><br><span class="line">auditd审核守护进程开启开启如果用selinux，需要开启它</span><br><span class="line">autofs文件系统自动加载和卸载开启自定只在需要时开启它，可以关闭</span><br><span class="line">avahi-daemon本地网络服务查找开启关闭对服务器无用</span><br><span class="line">bluetooth蓝牙无线通讯开启关闭对服务器无用</span><br><span class="line">certmonger关闭关闭</span><br><span class="line">cpuspeed调节cpu速度用来省电，常用在Laptop上开启关闭对服务器无用</span><br><span class="line">crond计划任务管理开启开启常用，开启</span><br><span class="line">cups通用unix打印服务开启关闭对服务器无用</span><br><span class="line">dnsmasqdns cache关闭关闭DNS缓存服务，无用</span><br><span class="line">firstboot系统安装后初始设定关闭关闭</span><br><span class="line">haldaemon硬件信息收集服务开启开启</span><br><span class="line">ip6tablesipv6防火墙开启关闭用到ipv6网络的就用，一般关闭</span><br><span class="line">iptablesipv4防火墙开启开启ipv4防火墙服务</span><br><span class="line">irqbalancecpu负载均衡开启自定多核cup需要</span><br><span class="line">kdump硬件变动检测关闭关闭服务器无用</span><br><span class="line">lvm2-monitorlvm监视开启自定如果使用LVM逻辑卷管理就开启</span><br><span class="line">matahari-broker关闭关闭此服务不清楚，我关闭</span><br><span class="line">matahari-host关闭关闭此服务不清楚，我关闭</span><br><span class="line">matahari-network关闭关闭此服务不清楚，我关闭</span><br><span class="line">matahari-service关闭关闭此服务不清楚，我关闭</span><br><span class="line">matahari-sysconfig关闭关闭此服务不清楚，我关闭</span><br><span class="line">mdmonitor软raid监视开启自定</span><br><span class="line">messagebus负责在各个系统进程之间传递消息开启开启如停用，haldaemon启动会失败</span><br><span class="line">netconsole关闭关闭</span><br><span class="line">netfs系统启动时自动挂载网络文件系统开启关闭如果使用nfs服务，就开启</span><br><span class="line">network系统启动时激活所有网络接口开启开启网络基础服务，必需！</span><br><span class="line">nfs网络文件系统关闭关闭nfs文件服务，用到就开启</span><br><span class="line">nfslocknfs相关开启关闭nfs相关服务，用到就开启</span><br><span class="line">ntpd自动对时工具关闭自定网络对时服务，用到就开启</span><br><span class="line">ntpdate自动对时工具关闭关闭</span><br><span class="line">oddjobd与D-BUS相关关闭关闭</span><br><span class="line">portreserveRPC 服务相关开启自定可以关闭</span><br><span class="line">postfix替代sendmail的邮件服务器开启自定如果无邮件服务，可关闭</span><br><span class="line">psacct负荷检测关闭关闭可以关闭</span><br><span class="line">qpidd消息通信开启开启</span><br><span class="line">quota_nld关闭关闭可以关闭</span><br><span class="line">rdisc    自动检测路由器关闭关闭</span><br><span class="line">restorecondselinux相关关闭关闭如果开启了selinux，就需开启</span><br><span class="line">rpcbind开启开启关键的基础服务，nfs服务和桌面环境都依赖此服务！相当于CentOS 5.x里面的portmap服务。</span><br><span class="line">rpcgssdNFS相关开启关闭NFS相关服务，可选</span><br><span class="line">rpcidmapdRPC name to UID/GID mapper开启关闭NFS相关服务，可选</span><br><span class="line">rpcsvcgssdNFS相关关闭关闭NFS相关服务，可选</span><br><span class="line">rsyslog提供系统的登录档案记录开启开启系统日志关键服务，必需！</span><br><span class="line">saslauthdsasl认证服务相关关闭关闭</span><br><span class="line">smartd硬盘自动检测守护进程关闭关闭</span><br><span class="line">spice-vdagentd开启开启</span><br><span class="line">sshdssh服务端，可提供安全的shell登录开启开启SSH远程登录服务，必需！</span><br><span class="line">sssd关闭关闭</span><br><span class="line">sysstat开启开启一组系统监控工具的服务，常用</span><br><span class="line">udev-post设备管理系统开启开启</span><br><span class="line">wdaemon关闭关闭</span><br><span class="line">wpa_supplicant无线认证相关关闭关闭</span><br><span class="line">ypbindnetwork information service客户端关闭关闭</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;centos6-和-7-服务进程关闭&quot;&gt;&lt;a href=&quot;#centos6-和-7-服务进程关闭&quot; class=&quot;headerlink&quot; title=&quot;centos6 和 7 服务进程关闭&quot;&gt;&lt;/a&gt;centos6 和 7 服务进程关闭&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;服务名称	        功能	                            		默认 	建议 	备注说明&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NetworkManager	    用于自动连接网络，常用在Laptop上			开启	关闭	对服务器无用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;abrt-ccpp	                                            		开启	自定	对服务器无用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;abrt-oops	                                            		开启	自定	对服务器无用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;abrtd	                                                		开启	自定	对服务器无用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;acpid	            电源的开关等检测管理，常用在Laptop上		开启	自定	对服务器无用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;atd	                在指定时间执行命令							开启	关闭	如果用crond，则可关闭它&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;auditd				审核守护进程								开启	开启	如果用selinux，需要开启它&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;autofs				文件系统自动加载和卸载						开启	自定	只在需要时开启它，可以关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;avahi-daemon		本地网络服务查找							开启	关闭	对服务器无用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bluetooth			蓝牙无线通讯								开启	关闭	对服务器无用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;certmonger														关闭	关闭	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cpuspeed			调节cpu速度用来省电，常用在Laptop上			开启	关闭	对服务器无用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;crond				计划任务管理								开启	开启	常用，开启&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cups				通用unix打印服务							开启	关闭	对服务器无用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dnsmasq	dns cache												关闭	关闭	DNS缓存服务，无用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;firstboot			系统安装后初始设定							关闭	关闭	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;haldaemon			硬件信息收集服务							开启	开启	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ip6tables			ipv6防火墙									开启	关闭	用到ipv6网络的就用，一般关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;iptables			ipv4防火墙									开启	开启	ipv4防火墙服务&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;irqbalance			cpu负载均衡									开启	自定	多核cup需要&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kdump				硬件变动检测								关闭	关闭	服务器无用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lvm2-monitor		lvm监视										开启	自定	如果使用LVM逻辑卷管理就开启&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;matahari-broker													关闭	关闭	此服务不清楚，我关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;matahari-host													关闭	关闭	此服务不清楚，我关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;matahari-network												关闭	关闭	此服务不清楚，我关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;matahari-service												关闭	关闭	此服务不清楚，我关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;matahari-sysconfig												关闭	关闭	此服务不清楚，我关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mdmonitor			软raid监视									开启	自定	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;messagebus			负责在各个系统进程之间传递消息				开启	开启	如停用，haldaemon启动会失败&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;netconsole														关闭	关闭	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;netfs				系统启动时自动挂载网络文件系统				开启	关闭	如果使用nfs服务，就开启&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;network				系统启动时激活所有网络接口					开启	开启	网络基础服务，必需！&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nfs					网络文件系统								关闭	关闭	nfs文件服务，用到就开启&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nfslock				nfs相关										开启	关闭	nfs相关服务，用到就开启&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ntpd				自动对时工具								关闭	自定	网络对时服务，用到就开启&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ntpdate				自动对时工具								关闭	关闭	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;oddjobd				与D-BUS相关									关闭	关闭	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;portreserve			RPC 服务相关								开启	自定	可以关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;postfix				替代sendmail的邮件服务器					开启	自定	如果无邮件服务，可关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;psacct				负荷检测									关闭	关闭	可以关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;qpidd				消息通信									开启	开启	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;quota_nld														关闭	关闭	可以关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rdisc			    自动检测路由器								关闭	关闭	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;restorecond			selinux相关									关闭	关闭	如果开启了selinux，就需开启&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rpcbind															开启	开启	关键的基础服务，nfs服务和桌面环境都依赖此服务！相当于CentOS 5.x里面的portmap服务。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rpcgssd				NFS相关										开启	关闭	NFS相关服务，可选&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rpcidmapd			RPC name to UID/GID mapper					开启	关闭	NFS相关服务，可选&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rpcsvcgssd			NFS相关										关闭	关闭	NFS相关服务，可选&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rsyslog				提供系统的登录档案记录						开启	开启	系统日志关键服务，必需！&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;saslauthd			sasl认证服务相关							关闭	关闭	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;smartd				硬盘自动检测守护进程						关闭	关闭	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;spice-vdagentd													开启	开启	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sshd				ssh服务端，可提供安全的shell登录			开启	开启	SSH远程登录服务，必需！&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sssd															关闭	关闭	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sysstat															开启	开启	一组系统监控工具的服务，常用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;udev-post			设备管理系统								开启	开启	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wdaemon															关闭	关闭	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wpa_supplicant		无线认证相关								关闭	关闭	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ypbind				network information service客户端			关闭	关闭	&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/spoiler.css&quot; type=&quot;text/css&quot;&gt;&lt;script src=&quot;/js/spoiler.js&quot; type=&quot;text/javascript&quot; async&gt;&lt;/script&gt;</summary>
    
    
    
    <category term="linux操作性能优化" scheme="https://github.mansoncui.com/categories/linux%E6%93%8D%E4%BD%9C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="centos6-7 服务进程优化" scheme="https://github.mansoncui.com/tags/centos6-7-%E6%9C%8D%E5%8A%A1%E8%BF%9B%E7%A8%8B%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>keepalived-lvs</title>
    <link href="https://github.mansoncui.com/2019/07/08/services/keepalived-lvs/"/>
    <id>https://github.mansoncui.com/2019/07/08/services/keepalived-lvs/</id>
    <published>2019-07-08T13:17:45.000Z</published>
    <updated>2021-07-30T03:37:30.933Z</updated>
    
    <content type="html"><![CDATA[<p>keepalived+lvs+nginx(DR)</p><span id="more"></span><h2 id="keepalived-lvs-工作原理"><a href="#keepalived-lvs-工作原理" class="headerlink" title="keepalived+lvs 工作原理"></a>keepalived+lvs 工作原理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">说起lvs，不得不说说关于lvs的工作原理，通常来说lvs的工作方式有三种：nat模式（LVS/NAT),直接路由模式（ LVS/DR），ip隧道模式(LVS/TUN),不过据说还有第四种模式（FULL NAT），下面我们来介绍介绍关于lvs常用的三种工作模式说明</span><br></pre></td></tr></table></figure><h3 id="LVS负载均衡模式—NAT模式原理"><a href="#LVS负载均衡模式—NAT模式原理" class="headerlink" title="LVS负载均衡模式—NAT模式原理"></a>LVS负载均衡模式—NAT模式原理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LVS-NAT模式:NAT用法本来是因为网络IP地址不足而把内部保留IP地址通过映射转换成公网地址的一种上网方式(原地址NAT)如果把NAT的过程稍微变化,就可以 成为负载均衡的一种方式原理其实就是把从客户端发来的IP包的IP头目的地址在DR上换成其中一台REALSERVER的IP地址并发至此 REALSERVER,而REALSERVER则在处理完成后把数据经过DR主机发回给客户端,DR在这个时候再把数据包的原IP地址改为DR接口上的 IP地址即可期间,无论是进来的流量,还是出去的流量,都必须经过DR</span><br></pre></td></tr></table></figure><p>如下为lvs nat模式的示意说明图：<br><img src="/images/service/keepalived/lvs_nat.png" width="100%" height="50%" align="left/"></p><h3 id="DR-路由"><a href="#DR-路由" class="headerlink" title="DR(路由)"></a>DR(路由)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LVS-DR模式：每个Real Server上都有两个IP：VIP和RIP，但是VIP是隐藏的，就是不能提高解析等功能，只是用来做请求回复的源IP的，Director上只需要一个网卡，然后利用别名来配置两个IP：VIP和DIP，在DIR接收到客户端的请求后，DIR根据负载算法选择一台rs sever的网卡mac作为客户端请求包中的目标mac，通过arp转交给后端rs serve处理，后端再通过自己的路由网关回复给客户端</span><br></pre></td></tr></table></figure><p>如下为lvs tun模式的示意说明图：<br><img src="/images/service/keepalived/lvs_tun.png" width="100%" height="50%" align="left/"></p><h3 id="TUN-隧道"><a href="#TUN-隧道" class="headerlink" title="TUN(隧道)"></a>TUN(隧道)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LVS-TUN模式：它的连接调度和管理与VS/NAT中的一样，利用ip隧道技术的原理，即在原有的客户端请求包头中再加一层IP Tunnel的包头ip首部信息，不改变原来整个请求包信息，只是新增了一层ip首部信息，再利用路由原理将请求发给RS server，不过要求的是所有的server必须支持&quot;IPTunneling&quot;或者&quot;IP Encapsulation&quot;协议</span><br></pre></td></tr></table></figure><h2 id="keepalived-lvs"><a href="#keepalived-lvs" class="headerlink" title="keepalived + lvs"></a>keepalived + lvs</h2><h3 id="主和从上安装keepalived"><a href="#主和从上安装keepalived" class="headerlink" title="主和从上安装keepalived"></a>主和从上安装keepalived</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install keepalived ipvsadm </span><br></pre></td></tr></table></figure><h3 id="keepalived-conf-配置master"><a href="#keepalived-conf-配置master" class="headerlink" title="keepalived.conf 配置master"></a>keepalived.conf 配置master</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id lvs01          #router_id 机器标识，通常为hostname，但不一定非得是hostname。故障发生时，邮件通知会用到。</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;            #vrrp实例定义部分</span><br><span class="line">    state MASTER               #设置lvs的状态，MASTER和BACKUP两种，必须大写 </span><br><span class="line">    interface ens160               #设置对外服务的接口</span><br><span class="line">    virtual_router_id 100        #设置虚拟路由标示，这个标示是一个数字，同一个vrrp实例使用唯一标示 </span><br><span class="line">    priority 100               #定义优先级，数字越大优先级越高，在一个vrrp——instance下，master的优先级必须大于backup</span><br><span class="line">    advert_int 1              #设定master与backup负载均衡器之间同步检查的时间间隔，单位是秒</span><br><span class="line">    nopreempt</span><br><span class="line">    authentication &#123;           #设置验证类型和密码</span><br><span class="line">        auth_type PASS         #主要有PASS和AH两种</span><br><span class="line">        auth_pass 1111         #验证密码，同一个vrrp_instance下MASTER和BACKUP密码必须相同</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;         #设置虚拟ip地址，可以设置多个，每行一个</span><br><span class="line">        192.168.3.199 </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.3.199 88 &#123;       #设置虚拟服务器，需要指定虚拟ip和服务端口</span><br><span class="line">    delay_loop 6                 #健康检查时间间隔</span><br><span class="line">    lb_algo wrr                  #负载均衡调度算法</span><br><span class="line">    lb_kind DR                   #负载均衡转发规则</span><br><span class="line">    persistence_timeout 50        #设置会话保持时间，对动态网页非常有用</span><br><span class="line">    protocol TCP               #指定转发协议类型，有TCP和UDP两种</span><br><span class="line">    real_server 192.168.3.105 88 &#123;    #配置服务器节点1，需要指定real server的真实IP地址和端口</span><br><span class="line">    weight 1               #设置权重，数字越大权重越高</span><br><span class="line">    TCP_CHECK &#123;              #realserver的状态监测设置部分单位秒</span><br><span class="line">       connect_timeout 10       #连接超时为10秒</span><br><span class="line">       retry 3             #重连次数</span><br><span class="line">       delay_before_retry 3        #重试间隔</span><br><span class="line">       connect_port 88         #连接端口为80，要和上面的保持一致</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     real_server 192.168.3.114 88 &#123;    #配置服务器节点1，需要指定real server的真实IP地址和端口</span><br><span class="line">     weight 1                  #设置权重，数字越大权重越高</span><br><span class="line">     TCP_CHECK &#123;               #realserver的状态监测设置部分单位秒</span><br><span class="line">       connect_timeout 10         #连接超时为10秒</span><br><span class="line">       retry 3               #重连次数</span><br><span class="line">       delay_before_retry 3        #重试间隔</span><br><span class="line">       connect_port 88          #连接端口为80，要和上面的保持一致</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="keepalived-配置backup"><a href="#keepalived-配置backup" class="headerlink" title="keepalived 配置backup"></a>keepalived 配置backup</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id lvs02          #router_id 机器标识，通常为hostname，但不一定非得是hostname。故障发生时，邮件通知会用到。</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;            #vrrp实例定义部分</span><br><span class="line">    state BACKUP              #设置lvs的状态，MASTER和BACKUP两种，必须大写</span><br><span class="line">    interface ens160           #设置对外服务的接口</span><br><span class="line">    virtual_router_id 100         #设置虚拟路由标示，这个标示是一个数字，同一个vrrp实例使用唯一标示</span><br><span class="line">    priority 99             #定义优先级，数字越大优先级越高，在一个vrrp——instance下，master的优先级必须大于backup</span><br><span class="line">    advert_int 1              #设定master与backup负载均衡器之间同步检查的时间间隔，单位是秒</span><br><span class="line">    authentication &#123;            #设置验证类型和密码</span><br><span class="line">        auth_type PASS         #主要有PASS和AH两种</span><br><span class="line">        auth_pass 1111         #验证密码，同一个vrrp_instance下MASTER和BACKUP密码必须相同</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;         #设置虚拟ip地址，可以设置多个，每行一个</span><br><span class="line">        192.168.3.199</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.3.199 88 &#123;      #设置虚拟服务器，需要指定虚拟ip和服务端口</span><br><span class="line">    delay_loop 6             #健康检查时间间隔</span><br><span class="line">    lb_algo wrr              #负载均衡调度算法</span><br><span class="line">    lb_kind DR               #负载均衡转发规则</span><br><span class="line">    #persistence_timeout 50          #设置会话保持时间，对动态网页非常有用</span><br><span class="line">    protocol TCP              #指定转发协议类型，有TCP和UDP两种</span><br><span class="line">    real_server 192.168.3.105 88 &#123;       #配置服务器节点1，需要指定real server的真实IP地址和端口</span><br><span class="line">    weight 1                #设置权重，数字越大权重越高</span><br><span class="line">    TCP_CHECK &#123;              #realserver的状态监测设置部分单位秒</span><br><span class="line">       connect_timeout 10         #连接超时为10秒</span><br><span class="line">       retry 3                #重连次数</span><br><span class="line">       delay_before_retry 3       #重试间隔</span><br><span class="line">       connect_port 88           #连接端口为80，要和上面的保持一致</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     real_server 192.168.3.114 88 &#123;   #配置服务器节点1，需要指定real server的真实IP地址和端口</span><br><span class="line">     weight 1                #设置权重，数字越大权重越高</span><br><span class="line">     TCP_CHECK &#123;              #realserver的状态监测设置部分单位秒</span><br><span class="line">       connect_timeout 10          #连接超时为10秒</span><br><span class="line">       retry 3             #重连次数</span><br><span class="line">       delay_before_retry 3        #重试间隔</span><br><span class="line">       connect_port 88         #连接端口为80，要和上面的保持一致</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service keepalived start </span><br><span class="line">观察系统日志</span><br></pre></td></tr></table></figure><h3 id="两台-real-server-部署一下脚本-放到-etc-init-d-下"><a href="#两台-real-server-部署一下脚本-放到-etc-init-d-下" class="headerlink" title="两台 real server 部署一下脚本(放到/etc/init.d/下 )"></a>两台 real server 部署一下脚本(放到/etc/init.d/下 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@192-168-3-105 init.d]# cat realserver </span><br><span class="line">#!/bin/bash</span><br><span class="line"># Script to start LVS DR real server.</span><br><span class="line"># description: LVS DR real server</span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line">VIP=192.168.3.199 #修改为VIP</span><br><span class="line">host=`/usr/bin/hostname`</span><br><span class="line">Ifconfig=`which ifconfig`</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start)</span><br><span class="line">        # Start LVS-DR real server on this machine.</span><br><span class="line">        $Ifconfig lo down</span><br><span class="line">        $Ifconfig lo up</span><br><span class="line">        echo 1 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">        echo 2 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">        echo 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">        echo 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">        /sbin/ifconfig lo:0 $VIP broadcast $VIP netmask 255.255.255.255 up</span><br><span class="line">        /sbin/route add -host $VIP dev lo:0</span><br><span class="line">        ;; </span><br><span class="line">    stop)</span><br><span class="line">        # Stop LVS-DR real server loopback device(s).</span><br><span class="line">        $Ifconfig lo:0 down</span><br><span class="line">        echo 0 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">        echo 0 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">        echo 0 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">        echo 0 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">        ;; </span><br><span class="line">    status)</span><br><span class="line"></span><br><span class="line">        # Status of LVS-DR real server.</span><br><span class="line">        islothere=`$Ifconfig lo:0 | grep $VIP`</span><br><span class="line">        isrothere=`netstat -rn | grep &quot;lo:0&quot; | grep $VIP`</span><br><span class="line">        if [ ! &quot;$islothere&quot; -o ! &quot;isrothere&quot; ];then</span><br><span class="line">            # Either the route or the lo:0 device</span><br><span class="line">            # not found.</span><br><span class="line">            echo &quot;LVS-DR real server Stopped.&quot; </span><br><span class="line">        else</span><br><span class="line">            echo &quot;LVS-DR real server Running.&quot; </span><br><span class="line">        fi</span><br><span class="line">        ;; </span><br><span class="line">    *) </span><br><span class="line">    # Invalid entry.</span><br><span class="line">    echo &quot;$0: Usage: $0 &#123;start|status|stop&#125;&quot;</span><br><span class="line">    exit 1</span><br><span class="line">    ;; </span><br><span class="line">esac</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /etc/init.d/realserver</span><br><span class="line"></span><br><span class="line">/etc/init.d/realserver start </span><br></pre></td></tr></table></figure><h3 id="两台真是服务器安装nginx"><a href="#两台真是服务器安装nginx" class="headerlink" title="两台真是服务器安装nginx"></a>两台真是服务器安装nginx</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nginx </span><br><span class="line"></span><br><span class="line">把两台相应IP写到index.html 文件中(有标识行)</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">关闭一台keepalived </span><br><span class="line"></span><br><span class="line">浏览器访问</span><br><span class="line">http://192.168.3.199:88</span><br></pre></td></tr></table></figure><h2 id="keepalived-lvs-nginx"><a href="#keepalived-lvs-nginx" class="headerlink" title="keepalived + lvs + nginx"></a>keepalived + lvs + nginx</h2><h3 id="配置描述"><a href="#配置描述" class="headerlink" title="配置描述"></a>配置描述</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keepalived和nginx部署在一台机器上</span><br><span class="line">环境:centos7 </span><br></pre></td></tr></table></figure><h3 id="安装keepalived-和-nginx"><a href="#安装keepalived-和-nginx" class="headerlink" title="安装keepalived 和 nginx"></a>安装keepalived 和 nginx</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nginx keepalived ipvsadm</span><br></pre></td></tr></table></figure><h3 id="keepalived-master"><a href="#keepalived-master" class="headerlink" title="keepalived master"></a>keepalived master</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id lvs01          #router_id 机器标识，通常为hostname，但不一定非得是hostname。故障发生时，邮件通知会用到。</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;            #vrrp实例定义部分</span><br><span class="line">    state MASTER               #设置lvs的状态，MASTER和BACKUP两种，必须大写</span><br><span class="line">    interface ens160               #设置对外服务的接口</span><br><span class="line">    virtual_router_id 100        #设置虚拟路由标示，这个标示是一个数字，同一个vrrp实例使用唯一标示</span><br><span class="line">    priority 100               #定义优先级，数字越大优先级越高，在一个vrrp——instance下，master的优先级必须大于backup</span><br><span class="line">    advert_int 1              #设定master与backup负载均衡器之间同步检查的时间间隔，单位是秒</span><br><span class="line">    nopreempt</span><br><span class="line">    authentication &#123;           #设置验证类型和密码</span><br><span class="line">        auth_type PASS         #主要有PASS和AH两种</span><br><span class="line">        auth_pass 1111         #验证密码，同一个vrrp_instance下MASTER和BACKUP密码必须相同</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;         #设置虚拟ip地址，可以设置多个，每行一个</span><br><span class="line">        192.168.3.199</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="keepalived-backup"><a href="#keepalived-backup" class="headerlink" title="keepalived backup"></a>keepalived backup</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id lvs02          #router_id 机器标识，通常为hostname，但不一定非得是hostname。故障发生时，邮件通知会用到。</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;            #vrrp实例定义部分</span><br><span class="line">    state BACKUP              #设置lvs的状态，MASTER和BACKUP两种，必须大写</span><br><span class="line">    interface ens160           #设置对外服务的接口</span><br><span class="line">    virtual_router_id 100         #设置虚拟路由标示，这个标示是一个数字，同一个vrrp实例使用唯一标示</span><br><span class="line">    priority 99             #定义优先级，数字越大优先级越高，在一个vrrp——instance下，master的优先级必须大于backup</span><br><span class="line">    advert_int 1              #设定master与backup负载均衡器之间同步检查的时间间隔，单位是秒</span><br><span class="line">    authentication &#123;            #设置验证类型和密码</span><br><span class="line">        auth_type PASS         #主要有PASS和AH两种</span><br><span class="line">        auth_pass 1111         #验证密码，同一个vrrp_instance下MASTER和BACKUP密码必须相同</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;         #设置虚拟ip地址，可以设置多个，每行一个</span><br><span class="line">        192.168.3.199</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nginx-配置-两台一样配置"><a href="#nginx-配置-两台一样配置" class="headerlink" title="nginx 配置(两台一样配置)"></a>nginx 配置(两台一样配置)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">upstream uni_gateway_8082 &#123;</span><br><span class="line">        ip_hash;</span><br><span class="line">        server 192.168.3.114:8082 weight=5 max_fails=3 fail_timeout=10;</span><br><span class="line">        server 192.168.3.105:8082 weight=5 max_fails=3 fail_timeout=10;</span><br><span class="line">&#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       8082;</span><br><span class="line">        access_log  /var/log/nginx/access-89.log  main;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass http://uni_gateway_8082;</span><br><span class="line">                proxy_redirect  off;</span><br><span class="line">                proxy_http_version 1.1;</span><br><span class="line">                proxy_set_header  Host  $host;</span><br><span class="line">                proxy_set_header  X-Real-IP $remote_addr;</span><br><span class="line">                proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="vip-测试"><a href="#vip-测试" class="headerlink" title="vip 测试"></a>vip 测试</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过关闭nginx 测试，漂移VIP</span><br></pre></td></tr></table></figure><h2 id="配置keepalived-日志"><a href="#配置keepalived-日志" class="headerlink" title="配置keepalived 日志"></a>配置keepalived 日志</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">修改rsyslog 配置:</span><br><span class="line">cat /etc/rsyslog.conf</span><br><span class="line">*.info;mail.none;authpriv.none;cron.none;local0.none    /var/log/messages #新增local0.none</span><br><span class="line">local0.*        /var/log/keepalived.log  #最下方新增这一行</span><br><span class="line"></span><br><span class="line">重启rsyslog 和 keepalived</span><br><span class="line">systemctl restart rsyslog </span><br><span class="line">systemctl restart keepalived </span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;keepalived+lvs+nginx(DR)&lt;/p&gt;
&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;h2 id=&quot;keepalived-lvs-工作原理&quot;&gt;&lt;a href=&quot;#keepalived-lvs-工作原理&quot; class=&quot;headerlink&quot; title=&quot;keepalived+lvs 工作原理&quot;&gt;&lt;/a&gt;keepalived+lvs 工作原理&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;说起lvs，不得不说说关于lvs的工作原理，通常来说lvs的工作方式有三种：nat模式（LVS/NAT),直接路由模式（ LVS/DR），ip隧道模式(LVS/TUN),不过据说还有第四种模式（FULL NAT），下面我们来介绍介绍关于lvs常用的三种工作模式说明&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;LVS负载均衡模式—NAT模式原理&quot;&gt;&lt;a href=&quot;#LVS负载均衡模式—NAT模式原理&quot; class=&quot;headerlink&quot; title=&quot;LVS负载均衡模式—NAT模式原理&quot;&gt;&lt;/a&gt;LVS负载均衡模式—NAT模式原理&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;LVS-NAT模式:NAT用法本来是因为网络IP地址不足而把内部保留IP地址通过映射转换成公网地址的一种上网方式(原地址NAT)如果把NAT的过程稍微变化,就可以 成为负载均衡的一种方式原理其实就是把从客户端发来的IP包的IP头目的地址在DR上换成其中一台REALSERVER的IP地址并发至此 REALSERVER,而REALSERVER则在处理完成后把数据经过DR主机发回给客户端,DR在这个时候再把数据包的原IP地址改为DR接口上的 IP地址即可期间,无论是进来的流量,还是出去的流量,都必须经过DR&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如下为lvs nat模式的示意说明图：&lt;br&gt;&lt;img src=&quot;/images/service/keepalived/lvs_nat.png&quot; width=&quot;100%&quot; height=&quot;50%&quot; align=&quot;left/&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;DR-路由&quot;&gt;&lt;a href=&quot;#DR-路由&quot; class=&quot;headerlink&quot; title=&quot;DR(路由)&quot;&gt;&lt;/a&gt;DR(路由)&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;LVS-DR模式：每个Real Server上都有两个IP：VIP和RIP，但是VIP是隐藏的，就是不能提高解析等功能，只是用来做请求回复的源IP的，Director上只需要一个网卡，然后利用别名来配置两个IP：VIP和DIP，在DIR接收到客户端的请求后，DIR根据负载算法选择一台rs sever的网卡mac作为客户端请求包中的目标mac，通过arp转交给后端rs serve处理，后端再通过自己的路由网关回复给客户端&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如下为lvs tun模式的示意说明图：&lt;br&gt;&lt;img src=&quot;/images/service/keepalived/lvs_tun.png&quot; width=&quot;100%&quot; height=&quot;50%&quot; align=&quot;left/&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="services" scheme="https://github.mansoncui.com/categories/services/"/>
    
    
    <category term="keepalived,lvs" scheme="https://github.mansoncui.com/tags/keepalived-lvs/"/>
    
  </entry>
  
  <entry>
    <title>v-p-n</title>
    <link href="https://github.mansoncui.com/2019/06/28/services/v-p-n/"/>
    <id>https://github.mansoncui.com/2019/06/28/services/v-p-n/</id>
    <published>2019-06-28T13:55:24.000Z</published>
    <updated>2021-07-14T05:03:41.775Z</updated>
    
    <content type="html"><![CDATA[<h2 id="vpn-安装"><a href="#vpn-安装" class="headerlink" title="vpn 安装"></a>vpn 安装</h2><h5 id="更换内核，安装锐速加速软件-可以跳过"><a href="#更换内核，安装锐速加速软件-可以跳过" class="headerlink" title="更换内核，安装锐速加速软件(可以跳过)"></a>更换内核，安装锐速加速软件(可以跳过)</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@vultr_test ~]# rpm -qa|grep kernel</span><br><span class="line">kernel-3.10.0-862.el7.x86_64</span><br><span class="line">kernel-tools-libs-3.10.0-862.14.4.el7.x86_64</span><br><span class="line">kernel-3.10.0-862.14.4.el7.x86_64</span><br><span class="line">kernel-tools-3.10.0-862.14.4.el7.x86_64</span><br><span class="line">[root@vultr_test ~]# rpm -ivh http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-3.10.0-229.1.2.el7.x86_64.rpm --force</span><br><span class="line">Retrieving http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-3.10.0-229.1.2.el7.x86_64.rpm</span><br><span class="line">Preparing...                          ################################# [100%]</span><br><span class="line">Updating / installing...</span><br><span class="line">   1:kernel-3.10.0-229.1.2.el7        ################################# [100%]</span><br><span class="line">[root@vultr_test ~]# rpm -qa|grep kernel</span><br><span class="line">kernel-3.10.0-862.el7.x86_64</span><br><span class="line">kernel-tools-libs-3.10.0-862.14.4.el7.x86_64</span><br><span class="line">kernel-3.10.0-862.14.4.el7.x86_64</span><br><span class="line">kernel-tools-3.10.0-862.14.4.el7.x86_64</span><br><span class="line">kernel-3.10.0-229.1.2.el7.x86_64</span><br><span class="line"></span><br><span class="line">降内核:</span><br><span class="line">rpm -ivh http://xz.wn789.com/CentOSkernel/kernel-3.10.0-229.1.2.el7.x86_64.rpm --force</span><br><span class="line"></span><br><span class="line">rpm -qa | grep kernel</span><br><span class="line"></span><br><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/wn789/serverspeeder/master/serverspeeder.sh  #锐锋加速VPN</span><br><span class="line"></span><br><span class="line">bash serverspeeder.sh</span><br></pre></td></tr></table></figure><hr><h5 id="安装工具"><a href="#安装工具" class="headerlink" title="安装工具"></a>安装工具</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@vultr_test ~]# yum -y install net-tools vim</span><br><span class="line">[root@vultr_test ~]# wget --no-check-certificate https://bootstrap.pypa.io/get-pip.py</span><br><span class="line">[root@vultr_test ~]# python2.7 get-pip.py`</span><br><span class="line"></span><br><span class="line">安装并配置ss</span><br><span class="line">(1)安装</span><br><span class="line">[root@vultr_test ~]# pip install shadowsocks</span><br><span class="line"></span><br><span class="line">(2)配置</span><br><span class="line">[root@vultr_test ~]# vim /etc/shadowsocks.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;server&quot;:&quot;0.0.0.0&quot;,</span><br><span class="line">    &quot;server_port&quot;:8765,</span><br><span class="line">    &quot;password&quot;:&quot;bd87d3600c6baffe20f0a03ebf17985f&quot;,</span><br><span class="line">    &quot;timeout&quot;:300,</span><br><span class="line">    &quot;method&quot;:&quot;rc4-md5&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;server&quot;:&quot;0.0.0.0&quot;,</span><br><span class="line">    &quot;server_port&quot;:8765,</span><br><span class="line">    &quot;password&quot;:&quot;ef487f64b19e581554564ab8635c8995&quot;,</span><br><span class="line">    &quot;timeout&quot;:60,</span><br><span class="line">    &quot;method&quot;:&quot;rc4-md5&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(3)启动</span><br><span class="line">[root@vultr_test ~]# ssserver -c /etc/shadowsocks.json -d start </span><br><span class="line">[root@vultr_test ~]# netstat -anpt |grep python</span><br><span class="line">tcp        0      0 0.0.0.0:8765            0.0.0.0:*               LISTEN      1162/python2.7  </span><br><span class="line"></span><br><span class="line">(4)关闭防火墙</span><br><span class="line">[root@vultr_test ~]# systemctl stop firewalld</span><br><span class="line">[root@vultr_test ~]# systemctl disable firewalld</span><br></pre></td></tr></table></figure><hr><h5 id="优化并添加monit监控"><a href="#优化并添加monit监控" class="headerlink" title="优化并添加monit监控"></a>优化并添加monit监控</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">### BEGIN INIT INFO</span><br><span class="line"># Provides:          ssserver</span><br><span class="line"># Required-Start:    $remote_fs $network</span><br><span class="line"># Required-Stop:     $remote_fs $network</span><br><span class="line"># Default-Start:     2 3 4 5</span><br><span class="line"># Default-Stop:      0 1 6</span><br><span class="line"># Short-Description: starts crontab-ui</span><br><span class="line"># Description:       starts the crond Process Manager daemon</span><br><span class="line">### END INIT INFO</span><br><span class="line"></span><br><span class="line">prefix=/usr/bin/ssserver</span><br><span class="line"></span><br><span class="line">case $1  in </span><br><span class="line">start)</span><br><span class="line">$&#123;prefix&#125; -c /etc/shadowsocks.json -d start  &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">if [ $? -eq 0 ];then</span><br><span class="line">echo &quot;start ssserver ....... ok&quot;</span><br><span class="line">else</span><br><span class="line">echo &quot;start ssserver ....... fail&quot;</span><br><span class="line">fi</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">stop)</span><br><span class="line">$&#123;prefix&#125; -c /etc/shadowsocks.json -d stop</span><br><span class="line">if [ $? -eq 0 ];then</span><br><span class="line">echo &quot;stop ssserver ....... ok&quot; </span><br><span class="line">else</span><br><span class="line">echo &quot;stop ssserver .......fail&quot;</span><br><span class="line">fi</span><br><span class="line">;;</span><br><span class="line">status)</span><br><span class="line">process=`pgrep -f &#x27;/usr/bin/ssserver&#x27; | wc -l` </span><br><span class="line">if [ $&#123;process&#125; -eq 1 ];then</span><br><span class="line">echo &quot;ssserver is running ........!!!&quot;</span><br><span class="line">else</span><br><span class="line">echo &quot;ssserver is not running ........!!!&quot;</span><br><span class="line">fi</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">*)</span><br><span class="line">echo &quot;Usage: $0 &#123;start|stop|status&#125;&quot;</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><hr><h5 id="monit-配置"><a href="#monit-配置" class="headerlink" title="monit 配置"></a>monit 配置</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">####ss</span><br><span class="line">check process ssserver with  matching &quot;/usr/bin/ssserver&quot;</span><br><span class="line">      start program = &quot;/etc/init.d/ss start&quot;</span><br><span class="line">      stop program = &quot;/etc/init.d/ss stop&quot;</span><br><span class="line"></span><br><span class="line">新版本安装ss</span><br><span class="line"></span><br><span class="line">参考链接:https://www.e-learn.cn/content/qita/838991</span><br><span class="line">CENTOS7安装ShadowSocksR与加速软件锐速</span><br></pre></td></tr></table></figure><h2 id="安装ssr"><a href="#安装ssr" class="headerlink" title="安装ssr"></a>安装ssr</h2><h5 id="下载安装脚本"><a href="#下载安装脚本" class="headerlink" title="下载安装脚本"></a>下载安装脚本</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@VPS ~]# wget –no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocksR.sh</span><br><span class="line">[root@VPS ~]# chmod +x shadowsocksR.sh</span><br><span class="line"></span><br><span class="line">安装ss</span><br><span class="line">[root@VPS ~]# ./shadowsocksR.sh 2&gt;&amp;1 | tee shadowsocksR.log</span><br><span class="line"></span><br><span class="line">安装完以后会有一点延迟。刚开始需要等一下看看</span><br><span class="line">ssr相关操作</span><br><span class="line">启动：/etc/init.d/shadowsocks start</span><br><span class="line">停止：/etc/init.d/shadowsocks stop</span><br><span class="line">重启：/etc/init.d/shadowsocks restart</span><br><span class="line">状态：/etc/init.d/shadowsocks status</span><br><span class="line"> </span><br><span class="line">配置文件路径：/etc/shadowsocks.json</span><br><span class="line">日志文件路径：/var/log/shadowsocks.log</span><br><span class="line">代码安装目录：/usr/local/shadowsocks</span><br></pre></td></tr></table></figure><hr><h5 id="安装锐速破解版"><a href="#安装锐速破解版" class="headerlink" title="安装锐速破解版"></a>安装锐速破解版</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1.一键拉取安装脚本</span><br><span class="line">[root@VPS ~]# wget -N --no-check-certificate https://raw.githubusercontent.com/wn789/serverspeeder/master/serverspeeder.sh</span><br><span class="line">注：锐速只支持kvm,不支持openvz </span><br><span class="line"></span><br><span class="line">2.运行脚本</span><br><span class="line">[root@California_VPS ~]# chmod +x serverspeeder.sh</span><br><span class="line">[root@California_VPS ~]# bash serverspeeder.sh</span><br><span class="line"></span><br><span class="line">注：如果内核不支持，转3 </span><br><span class="line">3.手动更换内核 </span><br><span class="line">(1) CentO S7.3的内核3.10.0-514.16.1.el7.x86_64暂不支持安装锐速，故更换为3.10.0-229.1.2.el7.x86_64</span><br><span class="line">rpm -ivh http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-3.10.0-229.1.2.el7.x86_64.rpm --force       ##更换内核</span><br><span class="line">rpm -qa | grep kernel</span><br><span class="line">如果看到上述箭头所示，代表内核安装成功。 </span><br><span class="line">以上转换内核安装不成功，下面亲测可以用：</span><br><span class="line">wget -N --no-check-certificate https://freed.ga/kernel/ruisu.sh &amp;&amp; bash ruisu.sh</span><br><span class="line"></span><br><span class="line">(2) 重启查看内核版本</span><br><span class="line">reboot</span><br><span class="line">uname -r</span><br><span class="line"></span><br><span class="line">(3) 重新安装锐速</span><br><span class="line"></span><br><span class="line">wget -N --no-check-certificate https://github.com/91yun/serverspeeder/raw/master/serverspeeder.sh &amp;&amp; bash serverspeeder.sh</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;vpn-安装&quot;&gt;&lt;a href=&quot;#vpn-安装&quot; class=&quot;headerlink&quot; title=&quot;vpn 安装&quot;&gt;&lt;/a&gt;vpn 安装&lt;/h2&gt;&lt;h5 id=&quot;更换内核，安装锐速加速软件-可以跳过&quot;&gt;&lt;a href=&quot;#更换内核，安装锐速加速软件-可以跳过&quot; class=&quot;headerlink&quot; title=&quot;更换内核，安装锐速加速软件(可以跳过)&quot;&gt;&lt;/a&gt;更换内核，安装锐速加速软件(可以跳过)&lt;/h5&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@vultr_test ~]# rpm -qa|grep kernel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kernel-3.10.0-862.el7.x86_64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kernel-tools-libs-3.10.0-862.14.4.el7.x86_64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kernel-3.10.0-862.14.4.el7.x86_64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kernel-tools-3.10.0-862.14.4.el7.x86_64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@vultr_test ~]# rpm -ivh http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-3.10.0-229.1.2.el7.x86_64.rpm --force&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Retrieving http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-3.10.0-229.1.2.el7.x86_64.rpm&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Preparing...                          ################################# [100%]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Updating / installing...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   1:kernel-3.10.0-229.1.2.el7        ################################# [100%]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@vultr_test ~]# rpm -qa|grep kernel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kernel-3.10.0-862.el7.x86_64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kernel-tools-libs-3.10.0-862.14.4.el7.x86_64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kernel-3.10.0-862.14.4.el7.x86_64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kernel-tools-3.10.0-862.14.4.el7.x86_64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kernel-3.10.0-229.1.2.el7.x86_64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;降内核:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rpm -ivh http://xz.wn789.com/CentOSkernel/kernel-3.10.0-229.1.2.el7.x86_64.rpm --force&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rpm -qa | grep kernel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wget -N --no-check-certificate https://raw.githubusercontent.com/wn789/serverspeeder/master/serverspeeder.sh  #锐锋加速VPN&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bash serverspeeder.sh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
&lt;h5 id=&quot;安装工具&quot;&gt;&lt;a href=&quot;#安装工具&quot; class=&quot;headerlink&quot; title=&quot;安装工具&quot;&gt;&lt;/a&gt;安装工具&lt;/h5&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@vultr_test ~]# yum -y install net-tools vim&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@vultr_test ~]# wget --no-check-certificate https://bootstrap.pypa.io/get-pip.py&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@vultr_test ~]# python2.7 get-pip.py`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;安装并配置ss&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(1)安装&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@vultr_test ~]# pip install shadowsocks&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(2)配置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@vultr_test ~]# vim /etc/shadowsocks.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;server&amp;quot;:&amp;quot;0.0.0.0&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;server_port&amp;quot;:8765,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;password&amp;quot;:&amp;quot;bd87d3600c6baffe20f0a03ebf17985f&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;timeout&amp;quot;:300,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;method&amp;quot;:&amp;quot;rc4-md5&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;server&amp;quot;:&amp;quot;0.0.0.0&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;server_port&amp;quot;:8765,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;password&amp;quot;:&amp;quot;ef487f64b19e581554564ab8635c8995&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;timeout&amp;quot;:60,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;method&amp;quot;:&amp;quot;rc4-md5&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(3)启动&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@vultr_test ~]# ssserver -c /etc/shadowsocks.json -d start &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@vultr_test ~]# netstat -anpt |grep python&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tcp        0      0 0.0.0.0:8765            0.0.0.0:*               LISTEN      1162/python2.7  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(4)关闭防火墙&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@vultr_test ~]# systemctl stop firewalld&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@vultr_test ~]# systemctl disable firewalld&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
&lt;h5 id=&quot;优化并添加monit监控&quot;&gt;&lt;a href=&quot;#优化并添加monit监控&quot; class=&quot;headerlink&quot; title=&quot;优化并添加monit监控&quot;&gt;&lt;/a&gt;优化并添加monit监控&lt;/h5&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#!/bin/sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;### BEGIN INIT INFO&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Provides:          ssserver&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Required-Start:    $remote_fs $network&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Required-Stop:     $remote_fs $network&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Default-Start:     2 3 4 5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Default-Stop:      0 1 6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Short-Description: starts crontab-ui&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Description:       starts the crond Process Manager daemon&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;### END INIT INFO&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;prefix=/usr/bin/ssserver&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;case $1  in &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	start)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	$&amp;#123;prefix&amp;#125; -c /etc/shadowsocks.json -d start  &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 &amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if [ $? -eq 0 ];then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		echo &amp;quot;start ssserver ....... ok&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		echo &amp;quot;start ssserver ....... fail&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	fi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	stop)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	$&amp;#123;prefix&amp;#125; -c /etc/shadowsocks.json -d stop&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if [ $? -eq 0 ];then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		echo &amp;quot;stop ssserver ....... ok&amp;quot; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		echo &amp;quot;stop ssserver .......fail&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	fi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	status)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	process=`pgrep -f &amp;#x27;/usr/bin/ssserver&amp;#x27; | wc -l` &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if [ $&amp;#123;process&amp;#125; -eq 1 ];then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		echo &amp;quot;ssserver is running ........!!!&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		echo &amp;quot;ssserver is not running ........!!!&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	fi	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;*)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	echo &amp;quot;Usage: $0 &amp;#123;start|stop|status&amp;#125;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;esac&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;</summary>
    
    
    
    <category term="services" scheme="https://github.mansoncui.com/categories/services/"/>
    
    
    <category term="v-p-n" scheme="https://github.mansoncui.com/tags/v-p-n/"/>
    
  </entry>
  
  <entry>
    <title>common_user</title>
    <link href="https://github.mansoncui.com/2019/06/28/common-user/"/>
    <id>https://github.mansoncui.com/2019/06/28/common-user/</id>
    <published>2019-06-28T13:44:04.000Z</published>
    <updated>2021-07-14T05:03:41.746Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="8af447a4842c32fdd8f67bc64fce82aec9b556ae311502b721a57e444f4e8d64">fc020fbef3a3cb538fbf8f71dd645adb37f2db4761a170d3d914d08d7e55c82175ef1be52cf22c490ee4b45bd47d8c5167595d37604225b0e00e1d491473fb6ee551ede2f10a976bd4672205999d5d4b6470c60ad383711a6f12228892d107d656499063ac9ef9a5eaed5aad68bf820e41b57c66a40c56beccd9788e5cd99e475cc1da149928f48ad3b632544bc9002e33c964150909adbf96adc97217dfbd9527b841a9fd7750cf198f0578b5efdb19dc33a685c61747f965759b9803cbe834729a124d440483b54035cf36f738db447c29dd2a425e51d2da8c39caa3da81c6776e694925fdcb1aa6313ed7bc88b6e6bc168bb606ef15f4e844ca9eb9fccedcaaef6c89184666199a787fb29ce37e000362fb523bf2037697744e5c3109f854544e0016cc2d15d3cfc819874a39286ff7e91f6f8b7822528256fb3ffb86b84d50d4d6560ec68df75dae6ebde59e99ce0b66cd7f0f5a5ccb18a382227c72b45b47b108d78430c925168a521b8e86ae4c866fe8f0e3692fa706e1a501605aad5825be51ea0d47b7614689a74bf0922c778a9c520715df05129332339549c90979fd54f04a1db769b389433e5a4d1284c4a381066f724695287a02baa7dfc37d4c4caee532e019878f26c436425901daaf9ab7c1037c12ebe24251d5a8626afd43906b9d49a224b50b3654280f74c3b6ca34dd623b05a1ef98e8b53f2cfdc439de6ad76a9de0ba673bfe740e65502c6bc5564b4e9248df3244ba53322758bdaf27d94ad69066d024b875c500aaabed0a9bef59e5bab3b240d39427cb78f0ea27765de0eb13cc538566607e670879bd69792d006130965fd1e54549924a4b06838f9d2c81def99408bb12cf04d6cd5e100e74b23da7185dcfeb8c4936786a600e9c9e9657b3c8db768d8fb50b555c876800a38b8b3ecc8d14ff703a7e759e7ecdfcf16a3c6b4dc20eac1eef33fbd0e4c06d88f867d8a663df4d97dd366760c352b24dfde75200526b632abb1003076daf6d02bff505fc984681a438aea1adda0bdf5c8e1b096c5011eba897569e264dca4cf82701d2dd9cb128065e1eca22a74452680dbbf0fb13c0a3287a73a2bac7c9c54c995a3b74b3382d22cf6a3020eaf706165d78d15f3fa9e63d63c7f6e11e922ee2e4158c734747e066aa8e7052f44d1e17a31cc3b70ac2548505e161b22a388808d2b873b94449244a76384b54b0ca49bd49512d3b4a36edec73365c2da7b0907c9244b429671d2ac1514c7b8afc0aea94088b7318d44431fe58b19dca043465863cc10d5b4d33662f14106ca16545918e9f37eac21a6879934c06eb6530fc1593477df5b0f905975c04e47727c317c03551472cbf1582e06bce0f14676e827dc82fd00cdd6ffaaf1d2a28a6bfa4f53403e585d310575f122744f7153af9fff7ea448cdd1c7d5a35af1cf16804c7bd4578dc1eaaba19e6bf5e7807f1b1d16362c5c44b45250578f1561ef65ac6999aad7a56c6483b894a028849b25e40231f055c831e2d211c3d2571a37f309c8b39867e7c3376ef9bc99361e64ce71587b08f3dae86aa3040fe8c87df7739d628ba9cffae9d614d9a69aff3a9e96c6e7ceb71cd3fdf857fe1ddcb3efbf6958f8fdc53ec1725fd1c5d2d762302e3d8390939b03a630e7a04557d50681c913f4b5bf2df300bb46397ab3f136213350f00f0ca47f7f0b26cfcb4a52e8a44f5bbd2a7af48a4bb48dee62bdc9adc633e4934380b796ea1290d00d76c43193ff09e3300c84d8919b00fa69e25016c8e2a2c47fef54e3cf26454df2333d4c5580fd3068d4810f7f8dc5204beaf973b58fe3e992d306593603ffcc24a0353e988a3f8fa371b6d3fafbe40d4a70ab726a3ffcfa4de2ff01dc9b66c6ccf3c0926cf2b3abac0b0c66d9656195bd8bcc62588ab0c00acbf2e6dac39242e883872b4d78a61d8754604e03ad55c82d9bd46a206dfd1fcac7209f5b7a4e388259d92fb009bfbad3431d97ba63cb639395df4ea4d47489f1614eac069ea941a1470b228194de841ce5b3f1b9fd63c9bdc38f5828d3faaea8561d065b2ad5f58abe6998973ef3d42a70f5ef0a4ed6a6a0512476bb265cbc1a7ce2841f225bce1677b7f29a4bb3add49f472bce07efe83fdf49ffa4428168bb803f233850a61a8ca9f28b7ddba95d1e1dead576c23fbb707d817b5649f289d24936a93e6014e834db3e007b7369a58f39d2b4355e4996cbd86320186e75599193ac9e6a2e588a8849fc8b2cb2a7ac414c49d1b0ca26014ba3eef263c9059b61955d86001f0e3b990271e3e890673d0ad03318d9477530b06092a6c9d89e600842cffdb7a15d1b35d9e27b810af24371d9950d2c3fe6421a68606d2ebff80053dfd1005c647b54ae47d5c15aae32ec9320dbdc8ebc074db0cdcf5bff5593fbf448ab1d30c1e13e33a756417f606cc4a5bb271f34e5da188f42043e0a35095b649bc34f6361f313936f1fe897017ab2412d98dd28a08366d3555fb6e6a4776bd73575d9e73932dc5aa97536ec5e2bbd71c2a26058254db561c28300104d500409006d1da124675584b374a6ad3add216027370e2c6e4bd8c153a00c4daf35cbc2e152a4c0ab2cde9ab502ef79aaffcf5ec92f3ceedaaa0b5202cce7e128d4a1bcda416799b4311f4c59a0cfe8b3e11b2e8546768fef1e37c87df712b3c41b3ffc733733c99b9b6ab1d37ac32972d27ffa9df286482987cd82acb7b8a6237423eba3ccd7abb49641799b0bce6dc2ba9b8da53b5e0b78280798e6a6dab5b142e38b4c6974ec56c149953bdeebe5928203cd4d9298e776b06c49e60190f222a0aacf61b2ba3b261a07af73b72a3dfd9f873c6414259b864931aa873d99b57f4bdd509c64712923a9569c4fd86e691156902a4ed07541a48aefd33e0aad3e0d95833eda041739377bd760df1956fc76a7fba7ec5b00fd59516f521940ba34ec7a44e5ad49a89b70960028208634b660978f73a7bacd9e34e0559d09301e2ec9551f38b2d311fea4ff07f44fa7c0ab777129aae5277101f7d623bede7fc4319afb3659a4751fc88dc47a75bf4cc260e83ff0a109e5c582aafaac21d6560be76689db3f5b2951a4d3a7d25eabe96923fefe1aa471a4a355bbf3198f00322dd563060237aca3b650331b1d148c68aa5f5f6e5bc06495d587c8b377ac4d5691da6c8bd03ca6e870bb9292acfa2eb66fe258dc199b1d2fd55a38b4560b78e28b02c33706ee5815d83763b090e031a19f87bb46c770317f835ab3da93913311a793ca822ef775d415d4cb67bf414b863b96d48d10f18cbe97a0ff85ee5bf6550d191ebb8abfc5358075f21ecd16178afd66f7a6a12111cd3657715545eca1f706b41159e3b22bb68ad02d627fe8092202919d360d551f4ccf227f52aef9c57000f071c8e828f628916803a5914ed23085fc1c649585d5de5cb6b15a1b9c9725916322c69a1c8856b5b78e46719b5aa46292f0ce2b8c1743146ad8674c9020f6628908db04a03644c11a472d973273179ce5328c5ddf4e8b5e66af5505f9c60cee244506dc38654816b1165f45761ae9a731490deac902958d27fa18668798500885b1a9c41acf55c9fea5da3044d2290c52a751875659de61347d98b817d799a7804b966721d2ed0cc64ca171e84e8f03fde3a10b0e06e42304a9a4c31596855716a8162a76aa031b2de1ed3c1238cd80b0a62360991e5c885496882e494455c61377a4846eec08b7f70f4926a97056a4c874cb81870cced488a99774b45a40aaf4ecba7f5c567c9eb0a344a303e324094f227b47a5cc43826ba453c03a6f68fd5aa101ab86149e859284ae98d980af432f2f90ad002bf1c80d015531f31b423303ec758f77fb727860a27e0d95cc3671010261e09b9fb5f</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">&lt;div class=&quot;hbe hbe-container&quot; id=&quot;hexo-blog-encrypt&quot; data-wpm=&quot;Oh, this is an invalid password. Check and try again, please.&quot; data-whm=&quot;OOPS, these decrypted content may changed, but you can still have a look.&quot;&gt;
  &lt;script id=&quot;hbeData&quot; type=&quot;hbeData&quot; data-hmacdigest=&quot;8af447a4842c32fdd8f67bc64fce82aec9b556ae311502b721a57e444f4e8d64&quot;&gt;fc020fbef3a3cb538fbf8f71dd645adb37f2db4761a170d3d914d08d7e55c82175ef1be52cf22c490ee4b45bd47d8c5167595d37604225b0e00e1d491473fb6ee551ede2f10a976bd4672205999d5d4b6470c60ad383711a6f12228892d107d656499063ac9ef9a5eaed5aad68bf820e41b57c66a40c56beccd9788e5cd99e475cc1da149928f48ad3b632544bc9002e33c964150909adbf96adc97217dfbd9527b841a9fd7750cf198f0578b5efdb19dc33a685c61747f965759b9803cbe834729a124d440483b54035cf36f738db447c29dd2a425e51d2da8c39caa3da81c6776e694925fdcb1aa6313ed7bc88b6e6bc168bb606ef15f4e844ca9eb9fccedcaaef6c89184666199a787fb29ce37e000362fb523bf2037697744e5c3109f854544e0016cc2d15d3cfc819874a39286ff7e91f6f8b7822528256fb3ffb86b84d50d4d6560ec68df75dae6ebde59e99ce0b66cd7f0f5a5ccb18a382227c72b45b47b108d78430c925168a521b8e86ae4c866fe8f0e3692fa706e1a501605aad5825be51ea0d47b7614689a74bf0922c778a9c520715df05129332339549c90979fd54f04a1db769b389433e5a4d1284c4a381066f724695287a02baa7dfc37d4c4caee532e019878f26c436425901daaf9ab7c1037c12ebe24251d5a8626afd43906b9d49a224b50b3654280f74c3b6ca34dd623b05a1ef98e8b53f2cfdc439de6ad76a9de0ba673bfe740e65502c6bc5564b4e9248df3244ba53322758bdaf27d94ad69066d024b875c500aaabed0a9bef59e5bab3b240d39427cb78f0ea27765de0eb13cc538566607e670879bd69792d006130965fd1e54549924a4b06838f9d2c81def99408bb12cf04d6cd5e100e74b23da7185dcfeb8c4936786a600e9c9e9657b3c8db768d8fb50b555c876800a38b8b3ecc8d14ff703a7e759e7ecdfcf16a3c6b4dc20eac1eef33fbd0e4c06d88f867d8a663df4d97dd366760c352b24dfde75200526b632abb1003076daf6d02bff505fc984681a438aea1adda0bdf5c8e1b096c5011eba897569e264dca4cf82701d2dd9cb128065e1eca22a74452680dbbf0fb13c0a3287a73a2bac7c9c54c995a3b74b3382d22cf6a3020eaf706165d78d15f3fa9e63d63c7f6e11e922ee2e4158c734747e066aa8e7052f44d1e17a31cc3b70ac2548505e161b22a388808d2b873b94449244a76384b54b0ca49bd49512d3b4a36edec73365c2da7b0907c9244b429671d2ac1514c7b8afc0aea94088b7318d44431fe58b19dca043465863cc10d5b4d33662f14106ca16545918e9f37eac21a6879934c06eb6530fc1593477df5b0f905975c04e47727c317c03551472cbf1582e06bce0f14676e827dc82fd00cdd6ffaaf1d2a28a6bfa4f53403e585d310575f122744f7153af9fff7ea448cdd1c7d5a35af1cf16804c7bd4578dc1eaaba19e6bf5e7807f1b1d16362c5c44b45250578f1561ef65ac6999aad7a56c6483b894a028849b25e40231f055c831e2d211c3d2571a37f309c8b39867e7c3376ef9bc99361e64ce71587b08f3dae86aa3040fe8c87df7739d628ba9cffae9d614d9a69aff3a9e96c6e7ceb71cd3fdf857fe1ddcb3efbf6958f8fdc53ec1725fd1c5d2d762302e3d8390939b03a630e7a04557d50681c913f4b5bf2df300bb46397ab3f136213350f00f0ca47f7f0b26cfcb4a52e8a44f5bbd2a7af48a4bb48dee62bdc9adc633e4934380b796ea1290d00d76c43193ff09e3300c84d8919b00fa69e25016c8e2a2c47fef54e3cf26454df2333d4c5580fd3068d4810f7f8dc5204beaf973b58fe3e992d306593603ffcc24a0353e988a3f8fa371b6d3fafbe40d4a70ab726a3ffcfa4de2ff01dc9b66c6ccf3c0926cf2b3abac0b0c66d9656195bd8bcc62588ab0c00acbf2e6dac39242e883872b4d78a61d8754604e03ad55c82d9bd46a206dfd1fcac7209f5b7a4e388259d92fb009bfbad3431d97ba63cb639395df4ea4d47489f1614eac069ea941a1470b228194de841ce5b3f1b9fd63c9bdc38f5828d3faaea8561d065b2ad5f58abe6998973ef3d42a70f5ef0a4ed6a6a0512476bb265cbc1a7ce2841f225bce1677b7f29a4bb3add49f472bce07efe83fdf49ffa4428168bb803f233850a61a8ca9f28b7ddba95d1e1dead576c23fbb707d817b5649f289d24936a93e6014e834db3e007b7369a58f39d2b4355e4996cbd86320186e75599193ac9e6a2e588a8849fc8b2cb2a7ac414c49d1b0ca26014ba3eef263c9059b61955d86001f0e3b990271e3e890673d0ad03318d9477530b06092a6c9d89e600842cffdb7a15d1b35d9e27b810af24371d9950d2c3fe6421a68606d2ebff80053dfd1005c647b54ae47d5c15aae32ec9320dbdc8ebc074db0cdcf5bff5593fbf448ab1d30c1e13e33a756417f606cc4a5bb271f34e5da188f42043e0a35095b649bc34f6361f313936f1fe897017ab2412d98dd28a08366d3555fb6e6a4776bd73575d9e73932dc5aa97536ec5e2bbd71c2a26058254db561c28300104d500409006d1da124675584b374a6ad3add216027370e2c6e4bd8c153a00c4daf35cbc2e152a4c0ab2cde9ab502ef79aaffcf5ec92f3ceedaaa0b5202cce7e128d4a1bcda416799b4311f4c59a0cfe8b3e11b2e8546768fef1e37c87df712b3c41b3ffc733733c99b9b6ab1d37ac32972d27ffa9df286482987cd82acb7b8a6237423eba3ccd7abb49641799b0bce6dc2ba9b8da53b5e0b78280798e6a6dab5b142e38b4c6974ec56c149953bdeebe5928203cd4d9298e776b06c49e60190f222a0aacf61b2ba3b261a07af73b72a3dfd9f873c6414259b864931aa873d99b57f4bdd509c64712923a9569c4fd86e691156902a4ed07541a48aefd33e0aad3e0d95833eda041739377bd760df1956fc76a7fba7ec5b00fd59516f521940ba34ec7a44e5ad49a89b70960028208634b660978f73a7bacd9e34e0559d09301e2ec9551f38b2d311fea4ff07f44fa7c0ab777129aae5277101f7d623bede7fc4319afb3659a4751fc88dc47a75bf4cc260e83ff0a109e5c582aafaac21d6560be76689db3f5b2951a4d3a7d25eabe96923fefe1aa471a4a355bbf3198f00322dd563060237aca3b650331b1d148c68aa5f5f6e5bc06495d587c8b377ac4d5691da6c8bd03ca6e870bb9292acfa2eb66fe258dc199b1d2fd55a38b4560b78e28b02c33706ee5815d83763b090e031a19f87bb46c770317f835ab3da93913311a793ca822ef775d415d4cb67bf414b863b96d48d10f18cbe97a0ff85ee5bf6550d191ebb8abfc5358075f21ecd16178afd66f7a6a12111cd3657715545eca1f706b41159e3b22bb68ad02d627fe8092202919d360d551f4ccf227f52aef9c57000f071c8e828f628916803a5914ed23085fc1c649585d5de5cb6b15a1b9c9725916322c69a1c8856b5b78e46719b5aa46292f0ce2b8c1743146ad8674c9020f6628908db04a03644c11a472d973273179ce5328c5ddf4e8b5e66af5505f9c60cee244506dc38654816b1165f45761ae9a731490deac902958d27fa18668798500885b1a9c41acf55c9fea5da3044d2290c52a751875659de61347d98b817d799a7804b966721d2ed0cc64ca171e84e8f03fde3a10b0e06e42304a9a4c31596855716a8162a76aa031b2de1ed3c1238cd80b0a62360991e5c885496882e494455c61377a4846eec08b7f70f4926a97056a4c874cb81870cced488a99774b45a40aaf4ecba7f5c567c9eb0a344a303e324094f227b47a5cc43826ba453c03a6f68fd5aa101ab86149e859284ae98d980af432f2f90ad002bf1c80d015531f31b423303ec758f77fb727860a27e0d95cc3671010261e09b9fb5f&lt;/script&gt;
  &lt;div class=&quot;hbe hbe-content&quot;&gt;
    &lt;div class=&quot;hbe hbe-input hbe-input-default&quot;&gt;
      &lt;input class=&quot;hbe hbe-input-field hbe-input-field-default&quot; type=&quot;password&quot; id=&quot;hbePass&quot;&gt;
      &lt;label class=&quot;hbe hbe-input-label hbe-input-label-default&quot; for=&quot;hbePass&quot;&gt;
        &lt;span class=&quot;hbe hbe-input-label-content hbe-input-label-content-default&quot;&gt;Hey, password is required here.&lt;/span&gt;
      &lt;/label&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;script data-pjax src=&quot;/lib/hbe.js&quot;&gt;&lt;/script&gt;&lt;link href=&quot;/css/hbe.style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;</summary>
    
    
    
    
    <category term="common" scheme="https://github.mansoncui.com/tags/common/"/>
    
  </entry>
  
  <entry>
    <title>zabbix</title>
    <link href="https://github.mansoncui.com/2019/06/26/monitor/zabbix/"/>
    <id>https://github.mansoncui.com/2019/06/26/monitor/zabbix/</id>
    <published>2019-06-25T17:36:16.000Z</published>
    <updated>2021-07-23T10:11:10.738Z</updated>
    
    <content type="html"><![CDATA[<h2 id="zabbix-部署"><a href="#zabbix-部署" class="headerlink" title="zabbix 部署"></a>zabbix 部署</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">环境：两台机器,搭建LAMP 平台</span><br><span class="line"></span><br><span class="line">yum -y install  gcc gcc-c++  php-*   net-snmp  net-snmp-utils</span><br><span class="line"></span><br><span class="line">rpm -ivh mysql-.........</span><br><span class="line"></span><br><span class="line">rpm -ivh mysql-server............</span><br><span class="line"></span><br><span class="line">修改数据库初始密码:mysql&gt;set password=password(&quot;123&quot;);</span><br><span class="line"></span><br><span class="line">yum -y install libcurl-devel  net-snmp-devel  mysql-devel</span><br><span class="line"></span><br><span class="line">/etc/init.d/httpd start;chkconfig httpd on</span><br><span class="line"></span><br><span class="line">/etc/init.d/httpd start;chkconfig httpd on</span><br></pre></td></tr></table></figure><h2 id="部署zabbix"><a href="#部署zabbix" class="headerlink" title="部署zabbix"></a>部署zabbix</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">1、配置和安装zabbix</span><br><span class="line"></span><br><span class="line">#useradd zabbix</span><br><span class="line"></span><br><span class="line">#tar -zxvf  zabbix-2.2.1.tar.gz</span><br><span class="line"></span><br><span class="line">#cd zabbix-2.2.1</span><br><span class="line"></span><br><span class="line">#vim config.sh</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr/local/zabbix/   --enable-proxy  --enable-server  --enable-agent  --with-libcurl  --with-net-snmp</span><br><span class="line"></span><br><span class="line">#sh  config.sh</span><br><span class="line"></span><br><span class="line">#make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">安bin  sbin   #命令</span><br><span class="line">share    #帮助文档</span><br><span class="line">lib    #库文件</span><br><span class="line">ext  #配置文件</span><br><span class="line">我们只需要修改配置文件即可:装成功:ls /usr/local/zabbix/有以下文件：bin  etc  lib  sbin  share</span><br><span class="line"></span><br><span class="line">#cp  misc/init.d/fedora/core/zabbix_*  /etc/init.d/    #*表示的是server和agentd</span><br><span class="line"></span><br><span class="line">#chmod  +x   /etc/init.d/zabbix_*</span><br><span class="line"></span><br><span class="line">#vim  /etc/init.d/zabbix_server</span><br><span class="line"></span><br><span class="line">BASEDIR=/usr/local/zabbix  #修改安装目录</span><br><span class="line"></span><br><span class="line">#vim  /etc/init.d/zabbix_agentd</span><br><span class="line"></span><br><span class="line">BASEDIR=/usr/local/zabbix  #修改安装目录</span><br><span class="line"></span><br><span class="line">service  zabbix_server  start</span><br><span class="line"></span><br><span class="line">service  zabbix_agentd  start</span><br><span class="line"></span><br><span class="line">chkconfig --add zabbix_server</span><br><span class="line"></span><br><span class="line">chkconfig --add zabbix_agentd</span><br><span class="line"></span><br><span class="line">2、拷贝zabbix网页目录到网站根目录下</span><br><span class="line"></span><br><span class="line">#cp  -rp  frontends/php/     /var/www/html/zabbix</span><br><span class="line"></span><br><span class="line">#chown apache:apache  -R   /var/www/html/zabbix/</span><br><span class="line"></span><br><span class="line">3、给zabbix用户授权并创建库,把zabbix数据导入到刚刚创建的库中</span><br><span class="line"></span><br><span class="line">#mysql -uroot -p密码</span><br><span class="line"></span><br><span class="line">mysql&gt;show create database mysql;  #查看字符集的关键字</span><br><span class="line"></span><br><span class="line">mysql&gt;create database zabbix  DEFAULT CHARACTER SET  utf8;  #创建zabbix库并指定字符集</span><br><span class="line"></span><br><span class="line">mysql&gt;grant all zabbix.*  to zabbix@localhost  identified by &quot;密码&quot;;</span><br><span class="line"></span><br><span class="line">cd  / root/zabbix-2.2.1/database/mysql/  #数据库目录下</span><br><span class="line"></span><br><span class="line">数据导入数据库是按照一下顺序的</span><br><span class="line"></span><br><span class="line"># mysql -uzabbix -pzabbix zabbix &lt; schema.sql</span><br><span class="line"></span><br><span class="line"># mysql -uzabbix -pzabbix zabbix &lt; images.sql</span><br><span class="line"></span><br><span class="line"># mysql -uzabbix -pzabbix zabbix &lt; data.sql</span><br><span class="line"></span><br><span class="line">4、vim /etc/php.ini</span><br><span class="line"></span><br><span class="line">post_max_size = 8M   #把8M改为16M</span><br><span class="line"></span><br><span class="line">max_input_time = 60  #把60改为300</span><br><span class="line"></span><br><span class="line">max_execution_time = 30  #把30改为300</span><br><span class="line"></span><br><span class="line">date.timezone = Asia/Shanghai</span><br><span class="line"></span><br><span class="line">service  httpd  restart</span><br><span class="line"></span><br><span class="line">#cd zabbix</span><br><span class="line"></span><br><span class="line">#rpm -ivh  --nodeps php-mbstring-5.3.3-22.el6.x86_64.rpm  </span><br><span class="line"></span><br><span class="line">#rpm -ivh  --nodeps  php-bcmath-5.3.3-22.el6.x86_64.rpm   #这两个包到网上下载</span><br><span class="line"></span><br><span class="line">http://localhost/zabbix  </span><br><span class="line"></span><br><span class="line">安装过程中:写监控端IP，数据库 名、用户名和密码都是zabbix，在数据库一起端口不要修改</span><br><span class="line"></span><br><span class="line">4、进入到登录界面:用户名:admin  密码:zabbix</span><br><span class="line"></span><br><span class="line">注释:</span><br><span class="line"></span><br><span class="line">监控页面显示连接不上数据库,查看日志:tailf /tmp/zabbix_server.log</span><br><span class="line"></span><br><span class="line">错误提示:23055:20160406:212209.070 [Z3001] connection to database &#x27;zabbix&#x27; failed: [1045] Access denied for user &#x27;root&#x27;@&#x27;localhost&#x27; (using password: YES)  23055:20160406:212209.071 Database is down. Reconnecting in 10 seconds</span><br><span class="line"></span><br><span class="line">连接不上数据库:修改zabbix_server主配置文件 vim  /usr/local/zabbix/etc/zabbix_server.conf</span><br><span class="line"></span><br><span class="line">103 DBUser=zabbix  #修改用户</span><br><span class="line"></span><br><span class="line">111 DBPassword=zabbix  #去掉注释，加上密码</span><br></pre></td></tr></table></figure><h2 id="在页面中配置监控"><a href="#在页面中配置监控" class="headerlink" title="在页面中配置监控:"></a>在页面中配置监控:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">1、管理(菜单最后一个)-》用户(users)-》创建用户主群（左面）选择用户（user）-》双击admin-》zh_CN  #页面改为中文</span><br><span class="line"></span><br><span class="line">2、配置本机监控本机:要运行/etc/init.d/zabbix_agentd start（谁被监控服务器监控谁就要起代理服务程序）</span><br><span class="line"></span><br><span class="line"># vim /usr/local/zabbix/etc/zabbix_agentd.conf</span><br><span class="line"></span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line"></span><br><span class="line">Logfile=/var/log/zabbix/zabbix_agentd.lg</span><br><span class="line"></span><br><span class="line">修改日志文件目录:mkdir /var/log/zabbix/ chown zabbix:zabbix  /var/log/zabbix/</span><br><span class="line"></span><br><span class="line">81 Server=127.0.0.1,192.168.1.254  #监控服务器的IP地址</span><br><span class="line"></span><br><span class="line">122 ServerActive=192.168.1.254:10051  #监控服务器的IP地址和端口号</span><br><span class="line"></span><br><span class="line">134 Hostname=Zabbix serve</span><br><span class="line"></span><br><span class="line">/etc/init.d/zabbix_agentd restart</span><br><span class="line"></span><br><span class="line">默认就是自己监控自己:组态-》主机-&gt;双击zabbix_server-&gt;主机—&gt;最下方修改受监测中-》save</span><br><span class="line"></span><br><span class="line">选择监测中—》最新组态-》</span><br><span class="line"></span><br><span class="line">2、监控远端某台服务器:（先配置被监控端） tar -zxvf  zabbix-2.2.1.tar.gz useradd zabbix cd zabbix-2.2.1</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr/local/zabbix --enable-agent make  &amp;&amp;  make install</span><br><span class="line"></span><br><span class="line">cp   misc/init.d/fedora/core/zabbix_agentd /etc/init.d/</span><br><span class="line"></span><br><span class="line">chmod +x  /etc/init.d/zabbix_agentd</span><br><span class="line"></span><br><span class="line">chkconfig --add zabbix_agentd</span><br><span class="line"></span><br><span class="line">chkconfig zabbix_agentd on</span><br><span class="line"></span><br><span class="line">vim /etc/init.d/zabbix_agentd</span><br><span class="line"></span><br><span class="line">BASEDIR=/usr/local/zabbix  #修改安装目录</span><br><span class="line"></span><br><span class="line">service  zabbix_agentd start</span><br><span class="line"></span><br><span class="line">vim /usr/local/zabbix/etc/zabbix_agentd.conf  #修改配置文件</span><br><span class="line"></span><br><span class="line">ServerActive=192.168.1.254:10051 #监控端服务器IP地址和端口</span><br><span class="line"></span><br><span class="line">Hostname=Zabbix client 100 Server=127.0.0.1,192.168.1.254</span><br><span class="line"></span><br><span class="line">service  zabbix_agentd  restart</span><br><span class="line"></span><br><span class="line">在监控端配置被自己监控服务器:192.168.1.100 组态-》主机-》创建主机（右面）-》主机名（server100）-》linuxserver-》被监控的IP地址，其他的默认-》状态（受监控中）-》save</span><br><span class="line"></span><br><span class="line">双击server100-》模板-》添加</span><br><span class="line"></span><br><span class="line">3、自定义监控项:监控192.168.1.101上面的用户数</span><br><span class="line"></span><br><span class="line">（1、）在客户端(被监控端)，定义监控命令 cd /usr/local/zabbix/etc/</span><br><span class="line"></span><br><span class="line">vim zabbix_agentd.conf</span><br><span class="line"></span><br><span class="line">255 UnsafeUserParameters=1  #开启允许自定义命令</span><br><span class="line"></span><br><span class="line">243 Include=/usr/local/zabbix/etc/zabbix_agentd.conf.d/</span><br><span class="line"></span><br><span class="line">定义命令格式:UserParameter=&lt;key&gt;,&lt;shell command&gt;</span><br><span class="line"></span><br><span class="line">cd  /usr/local/zabbix/etc/zabbix_agentd.conf.d/</span><br><span class="line"></span><br><span class="line">vim mon.user.numbers</span><br><span class="line"></span><br><span class="line">UserParameter=mon.user.num,wc -l  /etc/passwd  |  awk &#x27;&#123;print $1&#125;&#x27;</span><br><span class="line"></span><br><span class="line">service zabbix_agentd restart</span><br><span class="line"></span><br><span class="line">cd /usr/local/zabbix/</span><br><span class="line"></span><br><span class="line">./bin/zabbix_get  -s  127.0.0.1  -k mon.user.num   #测试上方是否正常使用</span><br><span class="line"></span><br><span class="line">（2）使用被监控端定义命令，对客户机做监控 在监控端调用该命令:在192.168.1.10操作 cd /usr/local/zabbix/bin/</span><br><span class="line"></span><br><span class="line">./zabbix_get  -s  192.168.1.101  -k mon.user.num</span><br><span class="line"></span><br><span class="line">创建监控模板： a、组态-&gt;模板-》创建模板（右上角）-》模板名（monitorusernum）-》可见名称（monitorusernum）-》linux server -》 一下默认-》保存</span><br><span class="line"></span><br><span class="line">b、应用集-》创建应用集-》名称（monusernum101） c、在应用集下面创建项目-》 创建监控项-》名称（monuserbig42）-&gt;类型（zabbix代理）-》键值mon.user.num(自己创建)-》十进制-》后面默认（使用自己创建应用集）-》save</span><br><span class="line"></span><br><span class="line">组态-》用户-》模板（刚刚自己自定义模板添加进去）</span><br><span class="line"></span><br><span class="line">d、在监控客户端4.101时使用刚才自己定义模板</span><br><span class="line"></span><br><span class="line">四、监控报警: 当监控到客户端192.168.4.205的用户数大于42个  报警  并发送报警邮件</span><br><span class="line"></span><br><span class="line">定义触发器: 点击触发器-》创建触发器-》名称（mon.user.big42）-&gt;表达式（添加） -》项目（自己刚刚创建的）       最末T值是&gt;N         N 值（插入）         选择严重</span><br><span class="line">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line"></span><br><span class="line">组态-》动作-&gt;创建动作-&gt;名称（to-mail自己定义、邮件主题、邮件正文）  </span><br><span class="line"></span><br><span class="line">  默认接收人:server100userbig42    默认信息不变</span><br><span class="line"></span><br><span class="line"> 条件   默认就可以不用设置</span><br><span class="line"></span><br><span class="line"> 操作    -新的     操作类型 ：送出信息         送到用户：admin     仅送到：  email     条件：  不用设置    添加   存档</span><br><span class="line"> +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line"></span><br><span class="line">定义邮件的用户(发件人) 管理-用户--用户（右上方 选择 ）--admin  ---  示警媒介----添加          </span><br><span class="line"></span><br><span class="line">　　　　　　　　　　　　　　   类型:email       收件人：root@localhost             </span><br><span class="line"></span><br><span class="line">　　　　　　　　　　　　  添加        存档</span><br><span class="line"></span><br><span class="line">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++      </span><br></pre></td></tr></table></figure><h2 id="配置邮件-或者直接用Python写个脚本来发送"><a href="#配置邮件-或者直接用Python写个脚本来发送" class="headerlink" title="配置邮件 (或者直接用Python写个脚本来发送)"></a>配置邮件 (或者直接用Python写个脚本来发送)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">指定邮件服务器 管理---示警媒介类型---Email--名称:Email        类型;电子邮件        邮件服务器名:localhost        SMTP  HELO:localhost        SMTP电邮:zabbix@localhost(发件人地址)</span><br><span class="line"></span><br><span class="line">在监控服务器 本机运行邮件服务（postfix \dovecot）</span><br><span class="line"></span><br><span class="line">yum -y install postfix  yum -y install dovecot /etc/init.d/postfix restart /etc/init.d/dovecot restart</span><br><span class="line"></span><br><span class="line">测试监控报警配置是否成功</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;zabbix-部署&quot;&gt;&lt;a href=&quot;#zabbix-部署&quot; class=&quot;headerlink&quot; title=&quot;zabbix 部署&quot;&gt;&lt;/a&gt;zabbix 部署&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;环境：两台机器,搭建LAMP 平台&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum -y install  gcc gcc-c++  php-*   net-snmp  net-snmp-utils&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rpm -ivh mysql-.........&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rpm -ivh mysql-server............&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;修改数据库初始密码:mysql&amp;gt;set password=password(&amp;quot;123&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum -y install libcurl-devel  net-snmp-devel  mysql-devel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/etc/init.d/httpd start;chkconfig httpd on&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/etc/init.d/httpd start;chkconfig httpd on&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;部署zabbix&quot;&gt;&lt;a href=&quot;#部署zabbix&quot; class=&quot;headerlink&quot; title=&quot;部署zabbix&quot;&gt;&lt;/a&gt;部署zabbix&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1、配置和安装zabbix&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#useradd zabbix&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#tar -zxvf  zabbix-2.2.1.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#cd zabbix-2.2.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#vim config.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./configure --prefix=/usr/local/zabbix/   --enable-proxy  --enable-server  --enable-agent  --with-libcurl  --with-net-snmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#sh  config.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#make &amp;amp;&amp;amp; make install&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;安bin  sbin   #命令&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;share    #帮助文档&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lib    #库文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ext  #配置文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;我们只需要修改配置文件即可:装成功:ls /usr/local/zabbix/有以下文件：bin  etc  lib  sbin  share&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#cp  misc/init.d/fedora/core/zabbix_*  /etc/init.d/    #*表示的是server和agentd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#chmod  +x   /etc/init.d/zabbix_*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#vim  /etc/init.d/zabbix_server&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BASEDIR=/usr/local/zabbix  #修改安装目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#vim  /etc/init.d/zabbix_agentd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BASEDIR=/usr/local/zabbix  #修改安装目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service  zabbix_server  start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service  zabbix_agentd  start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chkconfig --add zabbix_server&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chkconfig --add zabbix_agentd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2、拷贝zabbix网页目录到网站根目录下&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#cp  -rp  frontends/php/     /var/www/html/zabbix&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#chown apache:apache  -R   /var/www/html/zabbix/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3、给zabbix用户授权并创建库,把zabbix数据导入到刚刚创建的库中&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#mysql -uroot -p密码&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt;show create database mysql;  #查看字符集的关键字&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt;create database zabbix  DEFAULT CHARACTER SET  utf8;  #创建zabbix库并指定字符集&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt;grant all zabbix.*  to zabbix@localhost  identified by &amp;quot;密码&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd  / root/zabbix-2.2.1/database/mysql/  #数据库目录下&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;数据导入数据库是按照一下顺序的&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# mysql -uzabbix -pzabbix zabbix &amp;lt; schema.sql&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# mysql -uzabbix -pzabbix zabbix &amp;lt; images.sql&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# mysql -uzabbix -pzabbix zabbix &amp;lt; data.sql&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4、vim /etc/php.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;post_max_size = 8M   #把8M改为16M&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;max_input_time = 60  #把60改为300&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;max_execution_time = 30  #把30改为300&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;date.timezone = Asia/Shanghai&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service  httpd  restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#cd zabbix&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#rpm -ivh  --nodeps php-mbstring-5.3.3-22.el6.x86_64.rpm  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#rpm -ivh  --nodeps  php-bcmath-5.3.3-22.el6.x86_64.rpm   #这两个包到网上下载&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;http://localhost/zabbix  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;安装过程中:写监控端IP，数据库 名、用户名和密码都是zabbix，在数据库一起端口不要修改&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4、进入到登录界面:用户名:admin  密码:zabbix&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;注释:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;监控页面显示连接不上数据库,查看日志:tailf /tmp/zabbix_server.log&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;错误提示:23055:20160406:212209.070 [Z3001] connection to database &amp;#x27;zabbix&amp;#x27; failed: [1045] Access denied for user &amp;#x27;root&amp;#x27;@&amp;#x27;localhost&amp;#x27; (using password: YES)  23055:20160406:212209.071 Database is down. Reconnecting in 10 seconds&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;连接不上数据库:修改zabbix_server主配置文件 vim  /usr/local/zabbix/etc/zabbix_server.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103 DBUser=zabbix  #修改用户&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111 DBPassword=zabbix  #去掉注释，加上密码&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;在页面中配置监控&quot;&gt;&lt;a href=&quot;#在页面中配置监控&quot; class=&quot;headerlink&quot; title=&quot;在页面中配置监控:&quot;&gt;&lt;/a&gt;在页面中配置监控:&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1、管理(菜单最后一个)-》用户(users)-》创建用户主群（左面）选择用户（user）-》双击admin-》zh_CN  #页面改为中文&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2、配置本机监控本机:要运行/etc/init.d/zabbix_agentd start（谁被监控服务器监控谁就要起代理服务程序）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# vim /usr/local/zabbix/etc/zabbix_agentd.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LogFile=/tmp/zabbix_agentd.log&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Logfile=/var/log/zabbix/zabbix_agentd.lg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;修改日志文件目录:mkdir /var/log/zabbix/ chown zabbix:zabbix  /var/log/zabbix/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81 Server=127.0.0.1,192.168.1.254  #监控服务器的IP地址&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122 ServerActive=192.168.1.254:10051  #监控服务器的IP地址和端口号&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134 Hostname=Zabbix serve&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/etc/init.d/zabbix_agentd restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;默认就是自己监控自己:组态-》主机-&amp;gt;双击zabbix_server-&amp;gt;主机—&amp;gt;最下方修改受监测中-》save&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;选择监测中—》最新组态-》&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2、监控远端某台服务器:（先配置被监控端） tar -zxvf  zabbix-2.2.1.tar.gz useradd zabbix cd zabbix-2.2.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./configure --prefix=/usr/local/zabbix --enable-agent make  &amp;amp;&amp;amp;  make install&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp   misc/init.d/fedora/core/zabbix_agentd /etc/init.d/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chmod +x  /etc/init.d/zabbix_agentd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chkconfig --add zabbix_agentd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chkconfig zabbix_agentd on&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vim /etc/init.d/zabbix_agentd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BASEDIR=/usr/local/zabbix  #修改安装目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service  zabbix_agentd start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vim /usr/local/zabbix/etc/zabbix_agentd.conf  #修改配置文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ServerActive=192.168.1.254:10051 #监控端服务器IP地址和端口&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Hostname=Zabbix client 100 Server=127.0.0.1,192.168.1.254&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service  zabbix_agentd  restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;在监控端配置被自己监控服务器:192.168.1.100 组态-》主机-》创建主机（右面）-》主机名（server100）-》linuxserver-》被监控的IP地址，其他的默认-》状态（受监控中）-》save&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;双击server100-》模板-》添加&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3、自定义监控项:监控192.168.1.101上面的用户数&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;（1、）在客户端(被监控端)，定义监控命令 cd /usr/local/zabbix/etc/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vim zabbix_agentd.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;255 UnsafeUserParameters=1  #开启允许自定义命令&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;243 Include=/usr/local/zabbix/etc/zabbix_agentd.conf.d/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;定义命令格式:UserParameter=&amp;lt;key&amp;gt;,&amp;lt;shell command&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd  /usr/local/zabbix/etc/zabbix_agentd.conf.d/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vim mon.user.numbers&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;UserParameter=mon.user.num,wc -l  /etc/passwd  |  awk &amp;#x27;&amp;#123;print $1&amp;#125;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service zabbix_agentd restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd /usr/local/zabbix/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./bin/zabbix_get  -s  127.0.0.1  -k mon.user.num   #测试上方是否正常使用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;（2）使用被监控端定义命令，对客户机做监控 在监控端调用该命令:在192.168.1.10操作 cd /usr/local/zabbix/bin/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./zabbix_get  -s  192.168.1.101  -k mon.user.num&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;创建监控模板： a、组态-&amp;gt;模板-》创建模板（右上角）-》模板名（monitorusernum）-》可见名称（monitorusernum）-》linux server -》 一下默认-》保存&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;b、应用集-》创建应用集-》名称（monusernum101） c、在应用集下面创建项目-》 创建监控项-》名称（monuserbig42）-&amp;gt;类型（zabbix代理）-》键值mon.user.num(自己创建)-》十进制-》后面默认（使用自己创建应用集）-》save&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;组态-》用户-》模板（刚刚自己自定义模板添加进去）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;d、在监控客户端4.101时使用刚才自己定义模板&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;四、监控报警: 当监控到客户端192.168.4.205的用户数大于42个  报警  并发送报警邮件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;定义触发器: 点击触发器-》创建触发器-》名称（mon.user.big42）-&amp;gt;表达式（添加） -》项目（自己刚刚创建的）       最末T值是&amp;gt;N         N 值（插入）         选择严重&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;组态-》动作-&amp;gt;创建动作-&amp;gt;名称（to-mail自己定义、邮件主题、邮件正文）  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  默认接收人:server100userbig42    默认信息不变&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 条件   默认就可以不用设置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 操作    -新的     操作类型 ：送出信息         送到用户：admin     仅送到：  email     条件：  不用设置    添加   存档&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;定义邮件的用户(发件人) 管理-用户--用户（右上方 选择 ）--admin  ---  示警媒介----添加          &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;　　　　　　　　　　　　　　   类型:email       收件人：root@localhost             &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;　　　　　　　　　　　　  添加        存档&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++      &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;配置邮件-或者直接用Python写个脚本来发送&quot;&gt;&lt;a href=&quot;#配置邮件-或者直接用Python写个脚本来发送&quot; class=&quot;headerlink&quot; title=&quot;配置邮件 (或者直接用Python写个脚本来发送)&quot;&gt;&lt;/a&gt;配置邮件 (或者直接用Python写个脚本来发送)&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;指定邮件服务器 管理---示警媒介类型---Email--名称:Email        类型;电子邮件        邮件服务器名:localhost        SMTP  HELO:localhost        SMTP电邮:zabbix@localhost(发件人地址)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;在监控服务器 本机运行邮件服务（postfix \dovecot）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum -y install postfix  yum -y install dovecot /etc/init.d/postfix restart /etc/init.d/dovecot restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;测试监控报警配置是否成功&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/spoiler.css&quot; type=&quot;text/css&quot;&gt;&lt;script src=&quot;/js/spoiler.js&quot; type=&quot;text/javascript&quot; async&gt;&lt;/script&gt;</summary>
    
    
    
    <category term="monitor" scheme="https://github.mansoncui.com/categories/monitor/"/>
    
    
    <category term="zabbix" scheme="https://github.mansoncui.com/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>pxe</title>
    <link href="https://github.mansoncui.com/2019/06/26/services/pxe/"/>
    <id>https://github.mansoncui.com/2019/06/26/services/pxe/</id>
    <published>2019-06-25T17:23:21.000Z</published>
    <updated>2021-07-14T05:03:41.770Z</updated>
    
    <content type="html"><![CDATA[<h2 id="pxe批量部署服务器"><a href="#pxe批量部署服务器" class="headerlink" title="pxe批量部署服务器"></a>pxe批量部署服务器</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">环境:准备两台机器(在虚拟机中操作)，先关闭iptables、selinux和NetworkManager</span><br><span class="line"></span><br><span class="line">1、配置dhcp</span><br><span class="line"></span><br><span class="line">yum -y install dhcp</span><br><span class="line"></span><br><span class="line">cp /usr/share/doc/dhcp-4.1.1/dhcpd.conf.sample  /etc/dhcp/dhcpd.conf</span><br><span class="line"></span><br><span class="line">vim  /etc/dhcp/dhcpd.conf</span><br><span class="line"></span><br><span class="line">default-lease-time 600;</span><br><span class="line">max-lease-time 7200;</span><br><span class="line">subnet 192.168.1.0 netmask 255.255.255.0 &#123;</span><br><span class="line">  range 192.168.1.20 192.168.1.80;</span><br><span class="line">  option routers 192.168.1.254;</span><br><span class="line"> next-server 192.168.1.101;</span><br><span class="line">filename &quot;pxelinux.0&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/etc/init.d/dhcpd  start</span><br><span class="line"></span><br><span class="line">chkconfig dhcpd on</span><br><span class="line"></span><br><span class="line">2、yum  -y install tftp-server   tftp   syslinux</span><br><span class="line"></span><br><span class="line">rpm -ql syslinux   #查看syslinux安装目录</span><br><span class="line"></span><br><span class="line">cd  /usr/share/syslinux/</span><br><span class="line"></span><br><span class="line">cp  -p pxelinux.0  /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line">vim /etc/xinetd.d/conf</span><br><span class="line"></span><br><span class="line">disable                 = no  #启用</span><br><span class="line"></span><br><span class="line">cd /media/isolinux/</span><br><span class="line"></span><br><span class="line">cp  -p  vmlinuz initrd.img splash.jpg   /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line"> mkdir /var/lib/mysql/pxelinux.cfg</span><br><span class="line"></span><br><span class="line">cp -p isolinux.cfg /var/lib/mysql/pxelinux.cfg/default</span><br><span class="line"></span><br><span class="line">vim   /var/lib/mysql/pxelinux.cfg/default  #修改配置文件</span><br><span class="line"></span><br><span class="line">default linux</span><br><span class="line"></span><br><span class="line">append initrd=initrd.img  ks=ftp://192.168.1.101/pub/ks.cfg</span><br><span class="line"></span><br><span class="line">services  xinetd start ;chkconfig   xinetd on </span><br><span class="line"></span><br><span class="line">3、yum -y install  vsftpd</span><br><span class="line"></span><br><span class="line">service vsftpd on</span><br><span class="line"></span><br><span class="line">mkdir  /var/ftp/pub/iso/</span><br><span class="line"></span><br><span class="line">cp -rp /media/*   /var/ftp/pub/iso/</span><br><span class="line"></span><br><span class="line"> chmod 644 /var/lib/tftpboot/pxelinux.cfg/default</span><br><span class="line"></span><br><span class="line">4、yum -y install system-config-kickstart</span><br><span class="line"></span><br><span class="line">system-config-kickstart</span><br><span class="line"></span><br><span class="line">(1)基本配置中设置语言:中文简体  时区：shanghai    密码,高级配置:给安装后重新引导系统和在文本模式中执行安装(默认为图形安装)打上勾，后者可以不打勾；</span><br><span class="line"></span><br><span class="line">(2)安装方法:选择ftp或是http。列如ftp: 第一个是写服务器地址，第二个是共享光盘镜像文件目录</span><br><span class="line"></span><br><span class="line">(3)主引导记录、分区和磁盘标签都选第一个；新建 “/” ,&quot;boot&quot;和&quot;swap&quot;</span><br><span class="line"></span><br><span class="line">(4)网卡配置:添加eth0网卡</span><br><span class="line"></span><br><span class="line">(5)防火墙z选择禁用</span><br><span class="line"></span><br><span class="line">(6)软件包安装:默认是最小化安装，可以选择包:</span><br><span class="line"></span><br><span class="line">基本系统中:基本和网络文件系统</span><br><span class="line"></span><br><span class="line">桌面:X窗口系统、字体、桌面、输入法和通用桌面</span><br><span class="line"></span><br><span class="line">语言支持:中文</span><br><span class="line"></span><br><span class="line">把文件保存到:/var/ftp/pub/</span><br><span class="line"></span><br><span class="line">chmod   644  /var/ftp/pub/ks.cfg  </span><br></pre></td></tr></table></figure><h2 id="新建一台虚拟机-网络模式选为仅主机模式-测试看是否成功"><a href="#新建一台虚拟机-网络模式选为仅主机模式-测试看是否成功" class="headerlink" title="新建一台虚拟机(网络模式选为仅主机模式) 测试看是否成功"></a>新建一台虚拟机(网络模式选为仅主机模式) 测试看是否成功</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">ks文件：</span><br><span class="line"></span><br><span class="line">#platform=x86, AMD64, 或 Intel EM64T</span><br><span class="line">#version=DEVEL</span><br><span class="line"># Firewall configuration</span><br><span class="line">firewall --disabled</span><br><span class="line"># Install OS instead of upgrade</span><br><span class="line">install</span><br><span class="line"># Use network installation</span><br><span class="line">url --url=&quot;ftp://192.168.1.101/pub/iso/&quot;</span><br><span class="line"># Root password</span><br><span class="line">rootpw --iscrypted $1$KNdqC7g/$mVPG2RIICeyyECaglEkBy.</span><br><span class="line"># System authorization information</span><br><span class="line">auth  --useshadow  --passalgo=sha512</span><br><span class="line"># Use text mode install</span><br><span class="line">text</span><br><span class="line">firstboot --disable</span><br><span class="line"># System keyboard</span><br><span class="line">keyboard us</span><br><span class="line"># System language</span><br><span class="line">lang zh_CN</span><br><span class="line"># SELinux configuration</span><br><span class="line">selinux --disabled</span><br><span class="line"># Installation logging level</span><br><span class="line">logging --level=info</span><br><span class="line"># Reboot after installation</span><br><span class="line">reboot</span><br><span class="line"># System timezone</span><br><span class="line">timezone  Asia/Shanghai</span><br><span class="line"># Network information</span><br><span class="line">network  --bootproto=dhcp --device=eth0 --onboot=on</span><br><span class="line"># System bootloader configuration</span><br><span class="line">bootloader --location=mbr</span><br><span class="line"># Clear the Master Boot Record</span><br><span class="line">zerombr</span><br><span class="line"># Partition clearing information</span><br><span class="line">clearpart --all --initlabel</span><br><span class="line"># Disk partitioning information</span><br><span class="line"></span><br><span class="line">part / --fstype=&quot;ext4&quot; --size=50000 part /boot --fstype=&quot;ext4&quot; --size=200 part swap --fstype=&quot;swap&quot; --size=8129</span><br><span class="line"></span><br><span class="line">%packages @base @basic-desktop @chinese-support @fonts @general-desktop @input-methods @internet-browser @network-file-system-client @x11</span><br><span class="line"></span><br><span class="line">%end  </span><br></pre></td></tr></table></figure><h2 id="注释"><a href="#注释" class="headerlink" title="注释:"></a>注释:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">boot.msg （显示“[enter]”启动提示信息）</span><br><span class="line"></span><br><span class="line">initrd.img（这是一个初始化文件，一个最小的系统镜像）</span><br><span class="line"></span><br><span class="line">pxelinux.0     （这文件是为legcay启动，它是legcay的启动镜像）</span><br><span class="line"></span><br><span class="line">pxelinux.cfg（该文件夹下放的是启动菜单，手动创建）</span><br><span class="line"></span><br><span class="line">splash.jpg（背景图片，可以不要）</span><br><span class="line"></span><br><span class="line">vesamenu.c32（legacy BIOS引导菜单工具，可从光盘或/usr/share/syslinux/中找到）</span><br><span class="line"></span><br><span class="line">vmlinuz（内核文件）</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;pxe批量部署服务器&quot;&gt;&lt;a href=&quot;#pxe批量部署服务器&quot; class=&quot;headerlink&quot; title=&quot;pxe批量部署服务器&quot;&gt;&lt;/a&gt;pxe批量部署服务器&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;环境:准备两台机器(在虚拟机中操作)，先关闭iptables、selinux和NetworkManager&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1、配置dhcp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum -y install dhcp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp /usr/share/doc/dhcp-4.1.1/dhcpd.conf.sample  /etc/dhcp/dhcpd.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vim  /etc/dhcp/dhcpd.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;default-lease-time 600;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;max-lease-time 7200;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;subnet 192.168.1.0 netmask 255.255.255.0 &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  range 192.168.1.20 192.168.1.80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  option routers 192.168.1.254;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; next-server 192.168.1.101;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;filename &amp;quot;pxelinux.0&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/etc/init.d/dhcpd  start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chkconfig dhcpd on&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2、yum  -y install tftp-server   tftp   syslinux&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rpm -ql syslinux   #查看syslinux安装目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd  /usr/share/syslinux/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp  -p pxelinux.0  /var/lib/tftpboot/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vim /etc/xinetd.d/conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;disable                 = no  #启用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd /media/isolinux/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp  -p  vmlinuz initrd.img splash.jpg   /var/lib/tftpboot/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; mkdir /var/lib/mysql/pxelinux.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp -p isolinux.cfg /var/lib/mysql/pxelinux.cfg/default&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vim   /var/lib/mysql/pxelinux.cfg/default  #修改配置文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;default linux&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;append initrd=initrd.img  ks=ftp://192.168.1.101/pub/ks.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;services  xinetd start ;chkconfig   xinetd on &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3、yum -y install  vsftpd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service vsftpd on&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mkdir  /var/ftp/pub/iso/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp -rp /media/*   /var/ftp/pub/iso/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; chmod 644 /var/lib/tftpboot/pxelinux.cfg/default&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4、yum -y install system-config-kickstart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;system-config-kickstart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(1)基本配置中设置语言:中文简体  时区：shanghai    密码,高级配置:给安装后重新引导系统和在文本模式中执行安装(默认为图形安装)打上勾，后者可以不打勾；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(2)安装方法:选择ftp或是http。列如ftp: 第一个是写服务器地址，第二个是共享光盘镜像文件目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(3)主引导记录、分区和磁盘标签都选第一个；新建 “/” ,&amp;quot;boot&amp;quot;和&amp;quot;swap&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(4)网卡配置:添加eth0网卡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(5)防火墙z选择禁用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(6)软件包安装:默认是最小化安装，可以选择包:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;基本系统中:基本和网络文件系统&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;桌面:X窗口系统、字体、桌面、输入法和通用桌面&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;语言支持:中文&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;把文件保存到:/var/ftp/pub/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chmod   644  /var/ftp/pub/ks.cfg  &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;新建一台虚拟机-网络模式选为仅主机模式-测试看是否成功&quot;&gt;&lt;a href=&quot;#新建一台虚拟机-网络模式选为仅主机模式-测试看是否成功&quot; class=&quot;headerlink&quot; title=&quot;新建一台虚拟机(网络模式选为仅主机模式) 测试看是否成功&quot;&gt;&lt;/a&gt;新建一台虚拟机(网络模式选为仅主机模式) 测试看是否成功&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ks文件：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#platform=x86, AMD64, 或 Intel EM64T&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#version=DEVEL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Firewall configuration&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;firewall --disabled&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Install OS instead of upgrade&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;install&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Use network installation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;url --url=&amp;quot;ftp://192.168.1.101/pub/iso/&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Root password&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rootpw --iscrypted $1$KNdqC7g/$mVPG2RIICeyyECaglEkBy.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# System authorization information&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;auth  --useshadow  --passalgo=sha512&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Use text mode install&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;text&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;firstboot --disable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# System keyboard&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;keyboard us&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# System language&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lang zh_CN&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# SELinux configuration&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;selinux --disabled&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Installation logging level&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;logging --level=info&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Reboot after installation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;reboot&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# System timezone&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;timezone  Asia/Shanghai&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Network information&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;network  --bootproto=dhcp --device=eth0 --onboot=on&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# System bootloader configuration&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bootloader --location=mbr&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Clear the Master Boot Record&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;zerombr&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Partition clearing information&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;clearpart --all --initlabel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Disk partitioning information&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;part / --fstype=&amp;quot;ext4&amp;quot; --size=50000 part /boot --fstype=&amp;quot;ext4&amp;quot; --size=200 part swap --fstype=&amp;quot;swap&amp;quot; --size=8129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;%packages @base @basic-desktop @chinese-support @fonts @general-desktop @input-methods @internet-browser @network-file-system-client @x11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;%end  &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;注释&quot;&gt;&lt;a href=&quot;#注释&quot; class=&quot;headerlink&quot; title=&quot;注释:&quot;&gt;&lt;/a&gt;注释:&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;boot.msg （显示“[enter]”启动提示信息）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;initrd.img（这是一个初始化文件，一个最小的系统镜像）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pxelinux.0     （这文件是为legcay启动，它是legcay的启动镜像）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pxelinux.cfg（该文件夹下放的是启动菜单，手动创建）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;splash.jpg（背景图片，可以不要）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vesamenu.c32（legacy BIOS引导菜单工具，可从光盘或/usr/share/syslinux/中找到）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vmlinuz（内核文件）&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/spoiler.css&quot; type=&quot;text/css&quot;&gt;&lt;script src=&quot;/js/spoiler.js&quot; type=&quot;text/javascript&quot; async&gt;&lt;/script&gt;</summary>
    
    
    
    <category term="services" scheme="https://github.mansoncui.com/categories/services/"/>
    
    
    <category term="pxe" scheme="https://github.mansoncui.com/tags/pxe/"/>
    
  </entry>
  
  <entry>
    <title>squid</title>
    <link href="https://github.mansoncui.com/2019/06/26/services/squid/"/>
    <id>https://github.mansoncui.com/2019/06/26/services/squid/</id>
    <published>2019-06-25T17:19:18.000Z</published>
    <updated>2021-07-14T05:03:41.773Z</updated>
    
    <content type="html"><![CDATA[<h2 id="squid"><a href="#squid" class="headerlink" title="squid"></a>squid</h2><h5 id="squid-正向代理"><a href="#squid-正向代理" class="headerlink" title="squid 正向代理"></a>squid 正向代理</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">环境:准备三台服务器，一台web服务器，squid服务器，客户端。关闭selinux和iptables</span><br><span class="line"></span><br><span class="line">1、yum -y install squid   #squid代理服务器</span><br><span class="line"></span><br><span class="line">vim  /etc/squid/squid.conf</span><br><span class="line"></span><br><span class="line">visible_hostname   www.baidu.com  #(主机名没改，就不用写，改了就要写)</span><br><span class="line"></span><br><span class="line">cache_mem   64 MB    #高速缓存</span><br><span class="line"></span><br><span class="line"> cache_dir  ufs  /var/spool/squid  100 16 256  #缓存目录  ufs文件格式   100是缓存大小  16是一级子目录   256是二级子目录</span><br><span class="line"></span><br><span class="line">http_port 80   vhost    # 把端口改为80，把httpd服务关闭</span><br><span class="line"></span><br><span class="line">cache_peer 网站服务器的地址  parent  80 0 originserver   #定义网站服务器地址，当squid缓存中没有时，访问web网站服务器，并存储在squid代理服务器上</span><br><span class="line"></span><br><span class="line">service   squid   restart</span><br><span class="line"></span><br><span class="line">chkconfig squid on</span><br><span class="line"></span><br><span class="line">2、yum  -y install httpd  elinks     #web网站服务器</span><br><span class="line"></span><br><span class="line">service httpd start</span><br><span class="line"></span><br><span class="line">chkconfig httpd on</span><br><span class="line"></span><br><span class="line">echo &quot;1111&quot;   &gt;  /var/www/html/index.html</span><br><span class="line"></span><br><span class="line">elinks --dump http://localhost/     或   curl  http://localhost</span><br><span class="line"></span><br><span class="line">3、客户测试:http://squid服务器的IP地址</span><br></pre></td></tr></table></figure><h5 id="squid-反向代理"><a href="#squid-反向代理" class="headerlink" title="squid 反向代理"></a>squid 反向代理</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">环境:准备三台服务器，一台web服务器，squid服务器，客户端。关闭selinux和iptables</span><br><span class="line"></span><br><span class="line">1、yum -y install squid   #squid代理服务器</span><br><span class="line"></span><br><span class="line">vim  /etc/squid/squid.conf</span><br><span class="line"></span><br><span class="line">visible_hostname   www.baidu.com  #(主机名没改，就不用写，改了就要写)</span><br><span class="line"></span><br><span class="line">cache_mem   64 MB    #高速缓存</span><br><span class="line"></span><br><span class="line"> cache_dir  ufs  /var/spool/squid  100 16 256  #缓存目录  ufs文件格式   100是缓存大小  16是一级子目录   256是二级子目录</span><br><span class="line"></span><br><span class="line">http_port 80   vhost    # 把端口改为80，把httpd服务关闭</span><br><span class="line"></span><br><span class="line">cache_peer 网站服务器的地址  parent  80 0 originserver   #定义网站服务器地址，当squid缓存中没有时，访问web网站服务器，并存储在squid代理服务器上</span><br><span class="line"></span><br><span class="line">service   squid   restart</span><br><span class="line"></span><br><span class="line">chkconfig squid on</span><br><span class="line"></span><br><span class="line">2、yum  -y install httpd  elinks     #web网站服务器</span><br><span class="line"></span><br><span class="line">service httpd start</span><br><span class="line"></span><br><span class="line">chkconfig httpd on</span><br><span class="line"></span><br><span class="line">echo &quot;1111&quot;   &gt;  /var/www/html/index.html</span><br><span class="line"></span><br><span class="line">elinks --dump http://localhost/     或   curl  http://localhost</span><br><span class="line"></span><br><span class="line">3、客户测试:http://squid服务器的IP地址</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;squid&quot;&gt;&lt;a href=&quot;#squid&quot; class=&quot;headerlink&quot; title=&quot;squid&quot;&gt;&lt;/a&gt;squid&lt;/h2&gt;&lt;h5 id=&quot;squid-正向代理&quot;&gt;&lt;a href=&quot;#squid-正向代理&quot; class=&quot;headerlink&quot; title=&quot;squid 正向代理&quot;&gt;&lt;/a&gt;squid 正向代理&lt;/h5&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;环境:准备三台服务器，一台web服务器，squid服务器，客户端。关闭selinux和iptables&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1、yum -y install squid   #squid代理服务器&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vim  /etc/squid/squid.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;visible_hostname   www.baidu.com  #(主机名没改，就不用写，改了就要写)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cache_mem   64 MB    #高速缓存&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; cache_dir  ufs  /var/spool/squid  100 16 256  #缓存目录  ufs文件格式   100是缓存大小  16是一级子目录   256是二级子目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;http_port 80   vhost    # 把端口改为80，把httpd服务关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cache_peer 网站服务器的地址  parent  80 0 originserver   #定义网站服务器地址，当squid缓存中没有时，访问web网站服务器，并存储在squid代理服务器上&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service   squid   restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chkconfig squid on&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2、yum  -y install httpd  elinks     #web网站服务器&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service httpd start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chkconfig httpd on&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo &amp;quot;1111&amp;quot;   &amp;gt;  /var/www/html/index.html&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;elinks --dump http://localhost/     或   curl  http://localhost&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3、客户测试:http://squid服务器的IP地址&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h5 id=&quot;squid-反向代理&quot;&gt;&lt;a href=&quot;#squid-反向代理&quot; class=&quot;headerlink&quot; title=&quot;squid 反向代理&quot;&gt;&lt;/a&gt;squid 反向代理&lt;/h5&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;环境:准备三台服务器，一台web服务器，squid服务器，客户端。关闭selinux和iptables&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1、yum -y install squid   #squid代理服务器&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vim  /etc/squid/squid.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;visible_hostname   www.baidu.com  #(主机名没改，就不用写，改了就要写)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cache_mem   64 MB    #高速缓存&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; cache_dir  ufs  /var/spool/squid  100 16 256  #缓存目录  ufs文件格式   100是缓存大小  16是一级子目录   256是二级子目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;http_port 80   vhost    # 把端口改为80，把httpd服务关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cache_peer 网站服务器的地址  parent  80 0 originserver   #定义网站服务器地址，当squid缓存中没有时，访问web网站服务器，并存储在squid代理服务器上&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service   squid   restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chkconfig squid on&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2、yum  -y install httpd  elinks     #web网站服务器&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service httpd start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chkconfig httpd on&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo &amp;quot;1111&amp;quot;   &amp;gt;  /var/www/html/index.html&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;elinks --dump http://localhost/     或   curl  http://localhost&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3、客户测试:http://squid服务器的IP地址&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/spoiler.css&quot; type=&quot;text/css&quot;&gt;&lt;script src=&quot;/js/spoiler.js&quot; type=&quot;text/javascript&quot; async&gt;&lt;/script&gt;</summary>
    
    
    
    <category term="services" scheme="https://github.mansoncui.com/categories/services/"/>
    
    
    <category term="squid" scheme="https://github.mansoncui.com/tags/squid/"/>
    
  </entry>
  
  <entry>
    <title>mysql_proxy</title>
    <link href="https://github.mansoncui.com/2019/06/26/services/mysql-proxy/"/>
    <id>https://github.mansoncui.com/2019/06/26/services/mysql-proxy/</id>
    <published>2019-06-25T17:10:54.000Z</published>
    <updated>2021-07-14T05:03:41.760Z</updated>
    
    <content type="html"><![CDATA[<h2 id="mysql-读写分离"><a href="#mysql-读写分离" class="headerlink" title="mysql 读写分离"></a>mysql 读写分离</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">环境: 四台机器，两台数据库服务器，一台代理，一台客户端测试</span><br><span class="line"></span><br><span class="line">注意:先把代理建完并测试以后，再搭建主从数据库服务器</span><br><span class="line"></span><br><span class="line">一、搭建代理服务器</span><br><span class="line"></span><br><span class="line">1、下载mysql-proxy包，并解压到/usr/local/,重命名为mysqlproxy(重命名根据自己情况，不一定)</span><br><span class="line"></span><br><span class="line">-P  #指定代理服务器的ip地址和端口号</span><br><span class="line"></span><br><span class="line">-r  #指定从数据库服务器的IP地址和端口(读操作)</span><br><span class="line"></span><br><span class="line">-b  #指定主数据库服务器的IP地址和端口(写操作)</span><br><span class="line"></span><br><span class="line">-s  #指定lun脚本文件的路径</span><br><span class="line"></span><br><span class="line">--keepalive  #若进程奔溃，自动重启此进程（可写可不写)</span><br><span class="line"></span><br><span class="line">lun脚本存放的目录:/usr/local/share/doc/mysql-proxt/rw--splitting.lua   #区分读写操作的</span><br><span class="line"></span><br><span class="line">/usr/local/bin/mysqlproxy/bin/mysql-proxy     #启动命令</span><br><span class="line"></span><br><span class="line">/usr/local/bin/mysqlproxy/bin/mysql-proxy   -P 指定代理服务器的IP地址和端口  -r 从数据库服务器IP地址和端口  -b  主数据库的IP地址和端口   -s   /usr/local/share/doc/mysql-proxt/rw--splitting.lua    &amp;</span><br><span class="line"></span><br><span class="line">关闭命令端口: pkill  进程名或 kill -9 pid</span><br><span class="line"></span><br><span class="line">二、搭建主从数据库</span><br><span class="line"></span><br><span class="line">主从授权用同一个用户，建议为：proxyuser ，地址为:%(代表所有地址)</span><br><span class="line"></span><br><span class="line">主从数据库的搭建和之前一样</span><br><span class="line"></span><br><span class="line">三、客户端测试</span><br><span class="line"></span><br><span class="line">mysql -h代理IP   -u授权用户  -p授权密码</span><br><span class="line"></span><br><span class="line">注释:前5个终端读写操作都是在主数据库服务器上，超过五个时（不包括第五个）读写操作正常分开，除非重启该服务，否者读写永久生效</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;mysql-读写分离&quot;&gt;&lt;a href=&quot;#mysql-读写分离&quot; class=&quot;headerlink&quot; title=&quot;mysql 读写分离&quot;&gt;&lt;/a&gt;mysql 读写分离&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;环境: 四台机器，两台数据库服务器，一台代理，一台客户端测试&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;注意:先把代理建完并测试以后，再搭建主从数据库服务器&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;一、搭建代理服务器&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1、下载mysql-proxy包，并解压到/usr/local/,重命名为mysqlproxy(重命名根据自己情况，不一定)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-P  #指定代理服务器的ip地址和端口号&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-r  #指定从数据库服务器的IP地址和端口(读操作)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-b  #指定主数据库服务器的IP地址和端口(写操作)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-s  #指定lun脚本文件的路径&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--keepalive  #若进程奔溃，自动重启此进程（可写可不写)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lun脚本存放的目录:/usr/local/share/doc/mysql-proxt/rw--splitting.lua   #区分读写操作的&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/mysqlproxy/bin/mysql-proxy     #启动命令&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/mysqlproxy/bin/mysql-proxy   -P 指定代理服务器的IP地址和端口  -r 从数据库服务器IP地址和端口  -b  主数据库的IP地址和端口   -s   /usr/local/share/doc/mysql-proxt/rw--splitting.lua    &amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;关闭命令端口: pkill  进程名或 kill -9 pid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;二、搭建主从数据库&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;主从授权用同一个用户，建议为：proxyuser ，地址为:%(代表所有地址)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;主从数据库的搭建和之前一样&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;三、客户端测试&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysql -h代理IP   -u授权用户  -p授权密码&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;注释:前5个终端读写操作都是在主数据库服务器上，超过五个时（不包括第五个）读写操作正常分开，除非重启该服务，否者读写永久生效&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/spoiler.css&quot; type=&quot;text/css&quot;&gt;&lt;script src=&quot;/js/spoiler.js&quot; type=&quot;text/javascript&quot; async&gt;&lt;/script&gt;</summary>
    
    
    
    <category term="services" scheme="https://github.mansoncui.com/categories/services/"/>
    
    
    <category term="mysql读写分离" scheme="https://github.mansoncui.com/tags/mysql%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/"/>
    
  </entry>
  
</feed>
